"use strict";var app=angular.module("yara",["vcRecaptcha","ngRoute","Image-Upload","YaraService","YaraDirective","Credentails","ngMaterial","ngAnimate","ngAria","ngMaterialDatePicker","mdPickers"]);app.controller("CreateNewEventController",["$scope","APPService","fileReader","$location","$anchorScroll","$timeout","$http","YaraBaseUrl","$filter","GetDataService","$mdpDatePicker","$mdpTimePicker",function(e,t,a,n,i,s,o,r,l,d,c,u){function p(e){return/^-?[\d.]+(?:e-?\d+)?$/.test(e)}function v(){e.Teventph=e.eventph,e.TeventEmail=e.eventemail,e.Teventweb=e.eventweb,e.Teventfb=e.eventfb,e.Teventtwitter=e.eventtwitter}void 0!=localStorage.getItem("epData")&&(e.EPdata=localStorage.getItem("epData"),e.EPdata=angular.fromJson(e.EPdata).ep_code),e.eventtypes=t.typedata,e.selectedval=0,e.tabsel=1,e.eventdays="",e.isEventPrvt=!1,e.suggestShrtName=function(){if(e.eventshrtname="",""!=e.eventname&&void 0!=e.eventname){for(var t=e.eventname,a=t.split(" "),n=[],i="",s=0;s<a.length;s++)p(a[s])?n.push(a[s]):/^[a-zA-Z0-9- ]*$/.test(a[s])&&n.push(a[s].charAt(0));for(var o=n.length>4?4:n.length,s=0;s<o;s++)p(n[s])||(i+=n[s]);for(var r="",l="",d="",s=0;s<n.length;s++)p(n[s])&&(4==n[s].length?l=s:d=s);""!=l?r+="'"+n[l].charAt(2)+n[l].charAt(3):""!=d&&n[d].length>3?r+="-"+n[d].substring(0,3):""!=d&&(r+="-"+n[d]),1==a.length&&(i=a[0]),e.eventshrtname=i.toUpperCase()+r}},e.dates=[];var m=new Date;m.setDate(m.getDate()+1),e.currtdate=m,e.td=e,e.s=t,e.td.datetime={},e.td.eventstartdate=l("date")(e.currtdate,"dd-MM-yyyy"),e.dates.push(l("date")(e.currtdate,"dd-MM-yyyy")),$("#evntstarttime"+l("date")(e.currtdate,"dd-MM-yyyy")).val(""),e.getMinDate=function(e){return e=t.parseDate(e),l("date")(new Date,"dd-MM-yyyy")==l("date")(e,"dd-MM-yyyy")&&(e=new Date),e},e.td.datetime[l("date")(e.currtdate,"dd-MM-yyyy")]=e.getMinDate(l("date")(e.currtdate,"dd-MM-yyyy")),e.$watch("td.eventstartdate",function(t,a){if(void 0!=t){e.dates=[];var n=l("date")(t,"dd-MM-yyyy");e.dates.push(n),console.log(n),$("#evntstarttime"+l("date")(e.currtdate,"dd-MM-yyyy")).val(""),e.td.datetime[n]=e.getMinDate(n)}}),e.dissLabel=function(){console.log("ok")},e.showDatePicker=function(a){c(a,t.parseDate(e.eventstartdate),e.currtdate).then(function(t){e.eventstartdate=l("date")(t,"dd-MM-yyyy")})},e.addDay=function(){var a=e.dates.length;if(a>=0){var n=t.parseDate(e.dates[a-1]);n.setDate(n.getDate()+1);var i=l("date")(n,"dd-MM-yyyy");e.dates.push(i),e.td.datetime[i]=e.getMinDate(i),console.log(e.td.datetime)}},e.deleteDay=function(){e.dates.length>0&&e.dates.pop()},e.getevntdayjson=function(e){for(var t="{",a=0;a<e.length;a++)0!=a&&(t+=","),t+='"'+e[a]+'":{ "starttime":"'+document.getElementById("evntstarttime"+e[a]).value.toUpperCase()+'","endtime":"'+document.getElementById("evntendtime"+e[a]).value.toUpperCase()+'"}';return t+="}",console.log(t),console.log(angular.fromJson(t)),t},e.tabSelection=function(t){e.tabsel=t,i(0);var a={latitude:e.searchloc.latitude,longitude:e.searchloc.longitude},n={latitude:"",longitude:""};e.searchloc=n,s(function(){e.searchloc=a},1e3)},e.subtypelist=[],e.selectedtype=function(t){e.selectedval=t;for(var a=0;a<e.eventtypes.length;a++)if(t==e.eventtypes[a].type_id){e.subtypelist=e.eventtypes[a].sub_type,e.subtitle="select";break}},e.Teventph="",e.TeventEmail="",e.Teventweb="",e.Teventfb="",e.Teventtwitter="",e.eventph="",e.eventweb="",e.eventfb="",e.eventtwitter="",e.eventemail="",e.checkSocials=function(){var t=0;"company-website"==e.social_type&&0!=e.eventweb.length?t=1:"twitter"==e.social_type&&20!=e.eventtwitter.length?t=1:"facebook"==e.social_type&&25!=e.eventfb.length?t=1:"phone"==e.social_type&&void 0!=e.eventph&&0!=e.eventph.length?t=1:"message"==e.social_type&&void 0!=e.eventemail&&0!=e.eventemail.length&&(t=1),1==t?$("."+e.social_type).attr("src","../../../static/dashboard/images/"+e.social_type+".png"):$("."+e.social_type).attr("src","../../../static/dashboard/images/"+e.social_type+"-gray.png")},e.saveSocials=function(){e.eventph=e.Teventph,e.eventweb=e.Teventweb,e.eventfb=e.Teventfb,e.eventtwitter=e.Teventtwitter,e.eventemail=e.TeventEmail,e.checkSocials(),$("#myModal-social").modal("hide"),$("#myModal-social4").modal("hide")},$("#myModal-social").on("show.bs.modal",function(t){e.typeofchange=""}),$("#myModal-social4").on("show.bs.modal",function(t){e.typeofchange=""}),$("#myModal-social").on("hidden.bs.modal",function(t){"save"!=e.typeofchange&&(v(),e.checkSocials())}),$("#myModal-social4").on("hidden.bs.modal",function(t){"save"!=e.typeofchange&&(v(),e.checkSocials())}),e.getCountries=function(){o({method:"GET",url:"../countries_json"}).then(function(t){e.countries=t.data})},e.getCountries(),e.createform=function(t){if(e.eventdays=e.getevntdayjson(e.dates),e.eventenddate=e.dates[e.dates.length-1],t.$valid){var a=new FormData;a.append("name",e.eventname),a.append("short_name",e.eventshrtname),a.append("event_type_id",e.eventtypes[e.selectedval-1].type_title),a.append("description",e.eventdesc),a.append("start_date",e.eventstartdate),a.append("end_date",e.eventenddate),a.append("days",e.eventdays),a.append("venue",e.venu),a.append("address_line1",e.addrline1),a.append("address_line2",e.addrline2),a.append("city",e.venucity),a.append("state",e.state.name);var n=0;n=1==e.isEventPrvt?1:0,a.append("is_private",n),a.append("frequency",e.evntfreq),a.append("country",e.country.name),a.append("zip",e.venupincode),a.append("event_logo",e.evntlogo),a.append("agenda_image",e.coverimg),a.append("phone_number",e.eventph),a.append("website",e.eventweb),a.append("facebook",e.eventfb),a.append("twitter",e.eventtwitter),a.append("email",e.eventemail),a.append("longitude",l("number")(e.searchloc.longitude,7)),a.append("latitude",l("number")(e.searchloc.latitude,7)),a.append("ep_code",e.EPdata),e.errormsg=!1,console.log(a),o({method:"POST",url:r.url+"/event/",data:a,transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(t){e.data=t.data,console.log(e.data),0==e.data.result?e.errormsg=!0:window.location="/dashboard"})}},e.searchloc={latitude:"12.9290985",longitude:"77.6210238"},e.maploction=function(t){e.address="";for(var a=0;a<t.length;a++)void 0!=t[a]&&""!=t[a]&&(e.address=e.address+t[a]+",");""==e.address?e.searchloc={latitude:"12.9290985",longitude:"77.6210238"}:(e.geocoder=new google.maps.Geocoder,e.geocoder.geocode({address:e.address},function(t,a){a==google.maps.GeocoderStatus.OK&&(e.searchloc={latitude:t[0].geometry.location.lat(),longitude:t[0].geometry.location.lng()})}))},e.$watchCollection("[venu,addrline1,addrline2,venucity,state,country,venupincode]",function(t){void 0!=t[4]&&(t[4]=t[4].name),void 0!=t[5]&&(t[5]=t[5].name),e.maploction(t)}),e.eventfb="https://www.facebook.com/",e.eventtwitter="https://twitter.com/",e.getFile=function(){e.progress=0,e.file.type.indexOf("image")>=0&&(e.file.type.indexOf("jpeg")>=0||e.file.type.indexOf("png")>=0)&&a.readAsDataUrl(e.file,e).then(function(t){d.getImgDimensions(t,function(t,a){t>=1024&&a>=1024?(e.step2form.evntlogo.$setValidity("minDimension",!0),t==a?e.step2form.evntlogo.$setValidity("ratioval",!0):e.step2form.evntlogo.$setValidity("ratioval",!1)):e.step2form.evntlogo.$setValidity("minDimension",!1),e.$apply()}),e.imageSrc=t})},e.getFile1=function(){e.progress=0,e.file.type.indexOf("image")>=0&&(e.file.type.indexOf("jpeg")>=0||e.file.type.indexOf("png")>=0)&&a.readAsDataUrl(e.file,e).then(function(t){d.getImgDimensions(t,function(t,a){t>=2048&&a>=1024?(e.step3form.coverimg.$setValidity("minDimension",!0),t==2*a?e.step3form.coverimg.$setValidity("ratioval",!0):e.step3form.coverimg.$setValidity("ratioval",!1)):e.step3form.coverimg.$setValidity("minDimension",!1),e.$apply()}),e.imageSrc1=t})},e.getFile2=function(){e.progress=0,e.file.type.indexOf("image")>=0&&(e.file.type.indexOf("jpeg")>=0||e.file.type.indexOf("png")>=0)&&a.readAsDataUrl(e.file,e).then(function(t){d.getImgDimensions(t,function(t,a){t>=1024&&a>=1024?(e.step4form.evntlogo.$setValidity("minDimension",!0),t==a?e.step4form.evntlogo.$setValidity("ratioval",!0):e.step4form.evntlogo.$setValidity("ratioval",!1)):e.step4form.evntlogo.$setValidity("minDimension",!1),e.$apply()}),e.imageSrc=t})},e.getFile3=function(){e.progress=0,e.file.type.indexOf("image")>=0&&(e.file.type.indexOf("jpeg")>=0||e.file.type.indexOf("png")>=0)&&a.readAsDataUrl(e.file,e).then(function(t){d.getImgDimensions(t,function(t,a){t>=2048&&a>=1024?(e.step4form.coverimg.$setValidity("minDimension",!0),t==2*a?e.step4form.coverimg.$setValidity("ratioval",!0):e.step4form.coverimg.$setValidity("ratioval",!1)):e.step4form.coverimg.$setValidity("minDimension",!1),e.$apply()}),e.imageSrc1=t})}}]),app.controller("EventCouponController",["$scope","fileReader","YaraBaseUrl","$http","$location","$filter","APPService","GetDataService","$mdpTimePicker",function(e,t,a,n,i,s,o,r,l){function d(e){for(var t=e.length-1;t>0;t--){var a=Math.floor(Math.random()*(t+1)),n=e[t];e[t]=e[a],e[a]=n}return e}var c=localStorage.getItem("selectedEventId");void 0===c||null===c?window.location="/events":(e.selevntdata=localStorage.getItem("selEventsData"),e.currentval=angular.fromJson(e.selevntdata));var u=s("date")(e.currentval.start_date,"dd-MM-yyyy"),p=s("date")(e.currentval.end_date,"dd-MM-yyyy");e.dayscount=o.dateDiffInDays(o.parseDate(u),o.parseDate(p)),e.dates=o.Dateslist(u,e.dayscount),e.selval=e.EXselval=e.dates[0],e.displaytime=e.expirytime=o.parseDate(u),e.currentdate=new Date,e.showTimePicker=function(t){l(t,e.displaytime,e.displaytime).then(function(t){e.time=s("date")(t,"hh:mm a"),e.displaytime=t})},e.showTimePicker1=function(t){l(t,e.expirytime,e.expirytime).then(function(t){e.EXtime=s("date")(t,"hh:mm a"),e.expirytime=t})},e.getTickets=function(){r.getTickets(e.currentval.event_code).then(function(t){1==t.result?e.ticketlist=t.tickets:e.ticketlist=[]})},e.getFoodCoupon=function(){r.getFoodCoupon(e.currentval.event_code).then(function(e){console.log(e)})},e.getUsers=function(){n({method:"GET",url:"../user_json"}).then(function(t){e.userlist=t.data,e.totalpages=e.numberOfPages()})},e.getUsers(),e.getTickets();for(var v=new Array(e.dayscount),m=0;m<v.length;m++)v[m]=[];e.foodselect=function(e,t){v[e].indexOf(t)>=0?v[e].splice(v[e].indexOf(t),1):v[e].push(t)},e.FDtickets=[],e.foodtickets=function(t){e.FDtickets.indexOf(t)>=0?e.FDtickets.splice(e.FDtickets.indexOf(t),1):e.FDtickets.push(t)},e.Custtickets=[],e.custtickets=function(t){e.Custtickets.indexOf(t)>=0?e.Custtickets.splice(e.Custtickets.indexOf(t),1):e.Custtickets.push(t)},e.Custusers=[],e.custusers=function(t){e.Custusers.indexOf(t)>=0?e.Custusers.splice(e.Custusers.indexOf(t),1):e.Custusers.push(t),f("")},e.currentPage=0,e.pageSize=10,e.numberOfPages=function(){return void 0!=e.userlist?Math.ceil(e.userlist.length/e.pageSize):1};var f=function(t){"selected"==t||"selected"==e.filterlist?(e.currentPage=0,e.totalpages=Math.ceil(e.Custusers.length/e.pageSize)):"unselected"==t||"unselected"==e.filterlist?(e.currentPage=0,e.totalpages=Math.ceil((e.userlist.length-e.Custusers.length)/e.pageSize)):(e.currentPage=0,e.totalpages=e.numberOfPages())};e.genRandom=function(){var t=d(e.getUserCodes());t=t.splice(0,e.rVal),e.Custusers=t},e.getUserCodes=function(){for(var t=[],a=0;a<e.userlist.length;a++)t.push(e.userlist[a].user_code);return t},e.$watchCollection("[filterlist,Custusers]",function(e){f(e[0])}),e.filteruser=function(t){return"selected"==e.filterlist?e.Custusers.indexOf(t.user_code)>=0:"unselected"!=e.filterlist||!(e.Custusers.indexOf(t.user_code)>=0)},e.selectval=function(t){e.selval=t;var a=o.parseDate(t);a.setHours(e.displaytime.getHours()),a.setMinutes(e.displaytime.getMinutes()),e.displaytime=a,e.time=s("date")(a,"hh:mm a")},e.EXselectval=function(t){e.EXselval=t;var a=o.parseDate(t);a.setHours(e.expirytime.getHours()),a.setMinutes(e.expirytime.getMinutes()),e.expirytime=a,e.EXtime=s("date")(a,"hh:mm a")},e.FoodCoupon=function(){var t;if(0==e.FDAllDays){t="[";for(var i=0;i<v.length;i++)0!=i&&(t+=","),t+='{ "day":"'+e.dates[i]+'",',t+=' "breakfast":'+(v[i].indexOf("Breakfast")>=0)+",",t+=' "lunch":'+(v[i].indexOf("Lunch")>=0)+",",t+=' "coffe":'+(v[i].indexOf("Coffe")>=0)+",",t+=' "dinner":'+(v[i].indexOf("Dinner")>=0),t+="}";t+="]"}else t=[];1==e.forAll&&(e.FDtickets=[]),n({method:"POST",url:a.url+"/food_coupon/",data:{event_code:e.currentval.event_code,all_day_access:angular.fromJson(angular.toJson(e.FDAllDays)),access_days:t,for_all:e.forAll,tickets:e.FDtickets}}).then(function(e){console.log(e.data)})},e.CustCoupon=function(){var t=!1;"all"==e.couponfor&&(t=!0),n({method:"POST",url:a.url+"/custom_coupon/",data:{event_code:e.currentval.event_code,name:e.CPname,coupon_type:e.CPtype,display_time:s("date")(e.displaytime,"dd-MM-yyyy h:mm a"),expiry_time:s("date")(e.expirytime,"dd-MM-yyyy h:mm a"),for_all:t,users:e.Custusers,tickets:e.Custtickets}}).then(function(e){console.log(e.data)})}}]),app.filter("startFrom",function(){return function(e,t){return void 0==e||(t=+t,e.slice(t))}}),app.controller("TimelineController",["$scope","fileReader","YaraBaseUrl","$http","$location","$filter","APPService","GetDataService","$mdpTimePicker","$interval",function(e,t,a,n,i,s,o,r,l,d){var c=localStorage.getItem("selectedEventId");void 0!==c&&null!==c||(window.location="/events"),e.selevntdata=localStorage.getItem("selEventsData"),e.currentval=angular.fromJson(e.selevntdata);var u=s("date")(e.currentval.start_date,"dd-MM-yyyy"),p=s("date")(e.currentval.end_date,"dd-MM-yyyy");e.dayscount=o.dateDiffInDays(o.parseDate(u),o.parseDate(p)),e.dates=o.Dateslist(u,e.dayscount),e.currentZoom=30,e.selecttab=function(t){e.seltab="day"+t},e.currtab,e.hover=function(t){e.currtab=e.seltab,e.seltab="day"+t},e.hoverleave=function(){e.seltab=e.currtab},e.leavetab=function(){e.movement=!1};var v;e.tabMovement=function(t){"go-right"==t?($(".slider").diyslider("move","forth"),e.dbutton=e.dbutton-1):(e.dbutton=e.dbutton+1,$(".slider").diyslider("move","back"))},e.movetab=function(t){e.tabMovement(t),e.movement=!0,v=d(function(){0==e.movement?d.cancel(v):e.tabMovement(t)},2e3)},e.timeline=function(t,a){var n,i=(o.Dateslist(t,a),o.parseDate(t)),s=o.parseDate(t),r=i.getDate()+"-"+(i.getMonth()+1)+"-"+i.getFullYear(),l=angular.fromJson(angular.toJson(e.currentval.days));angular.forEach(l,function(e,t){var a=o.parseDate(t);a=a.getDate()+"-"+(a.getMonth()+1)+"-"+a.getFullYear(),r==a&&(n=e)});var d=n.starttime.split(" "),c=d[0].split(":");"PM"===d[1]&&(c[0]=Number(c[0])+12),i.setHours(c[0]),i.setMinutes(c[1]);var u=n.endtime.split(" "),p=u[0].split(":");"PM"==u[1]&&(p[0]=Number(p[0])+12),s.setHours(p[0]),s.setMinutes(p[1]);var v,m=moment.duration(moment(s).diff(moment(i))),f=m.asHours(),g=[],y={};if(f<0){var h=i;i=s,s=h,f*=-1}v=f>0&&f<=1?1:f>1&&f<=3?5:f>3&&f<=6?10:f>6&&f<=9?15:30;for(var D=new Date(i);D<=s;D.setMinutes(D.getMinutes()+1)){var M={};D.getMinutes()%v==0?(M.show=!0,0==D.getMinutes()?M.class="bar1":30==D.getMinutes()?M.class="bar2":15==D.getMinutes()||45==D.getMinutes()?(M.class="bar3",5!=v&&1!=v||(M.class="bar4")):(M.class="bar4",1==v&&D.getMinutes()%5!=0&&(M.class="min"))):(M.show=!1,M.class=""),M.time=new Date(D),M.interval=v,g.push(M)}return y.hours=f,y.times=g,y}}]);