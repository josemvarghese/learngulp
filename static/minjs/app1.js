var app=angular.module("yara",["vcRecaptcha","ngRoute","Image-Upload","YaraService","YaraDirective","Credentails","ngMaterial","ngAnimate","ngAria","ngMaterialDatePicker","mdPickers","ngDroplet","ngLocalize","ngMap"]);app.value("localeConf",{basePath:"/static/dashboard/languages",fileExtension:".lang.json"}),app.config(function(e,t){t.defaults.useXDomain=!0,t.defaults.withCredentials=!0;var o=function(e){if(1!=e.data.result&&0!=e.data.result){localStorage.clear(),sessionStorage.clear(),sessionStorage.setItem("authSession",e.data.message);var t={errorNum:"",heading:"",subHeading:e.data.message,description:""};localStorage.setItem("infoPageErrors",angular.toJson(t)),window.location="/info"}};t.interceptors.push(function(e){return{response:function(e){return null!=e.data&&void 0!=e.data.result&&4==e.data.result?(localStorage.clear(),sessionStorage.clear(),console.log("1"),window.location="/session-timeout"):null!=e.data&&void 0!=e.data.result&&14==e.data.result?(localStorage.clear(),sessionStorage.clear(),sessionStorage.setItem("authSession",e.data.message),console.log(e),window.location="/app-account-signin"):null!=e.data&&void 0!=e.data.result&&o(e),e},responseError:function(t){return null!=t.data&&void 0!=t.data.result&&4==t.data.result?(localStorage.clear(),sessionStorage.clear(),o(t)):null==t.data||void 0==t.data.result||6!=t.data.result&&7!=t.data.result&&8!=t.data.result||(localStorage.clear(),sessionStorage.clear(),sessionStorage.setItem("authSession",t.data.message),o(t)),e.reject(t)}}})}),app.run(["$window","$anchorScroll","$rootScope",function(e,t,o){$("html, body").animate({scrollTop:0}),function(){var e=document.createElement("div");e.innerHTML="&nbsp;",e.className="adsbox",document.body.appendChild(e),0===e.offsetHeight&&(window.location.href="content-blockers"),e.remove()}();var a,n,i,r=(navigator.appVersion,navigator.userAgent),s=navigator.appName,l=""+parseFloat(navigator.appVersion),d=parseInt(navigator.appVersion,10);(n=r.indexOf("OPR/"))!=-1?(s="Opera",l=r.substring(n+4)):(n=r.indexOf("Opera"))!=-1?(s="Opera",l=r.substring(n+6),(n=r.indexOf("Version"))!=-1&&(l=r.substring(n+8))):(n=r.indexOf("MSIE"))!=-1?(s="Microsoft Internet Explorer",l=r.substring(n+5)):(n=r.indexOf("Chrome"))!=-1?(s="Chrome",l=r.substring(n+7)):(n=r.indexOf("Safari"))!=-1?(s="Safari",l=r.substring(n+7),(n=r.indexOf("Version"))!=-1&&(l=r.substring(n+8))):(n=r.indexOf("Firefox"))!=-1?(s="Firefox",l=r.substring(n+8)):(a=r.lastIndexOf(" ")+1)<(n=r.lastIndexOf("/"))&&(s=r.substring(a,n),l=r.substring(n+1),s.toLowerCase()==s.toUpperCase()&&(s=navigator.appName)),(i=l.indexOf(";"))!=-1&&(l=l.substring(0,i)),(i=l.indexOf(" "))!=-1&&(l=l.substring(0,i)),d=parseInt(""+l,10),isNaN(d)&&(l=""+parseFloat(navigator.appVersion),d=parseInt(navigator.appVersion,10)),"Firefox"!=s&&"Safari"!=s&&"Chrome"!=s&&"Opera"!=s?window.location="/error":"Firefox"==s&&Number(d)<40?window.location="/error":"Safari"==s&&Number(d)<9?window.location="/error":"Chrome"==s&&Number(d)<45?window.location="/error":"Opera"==s&&Number(d)<35&&(window.location="/error"),screen.width<1024&&(window.location="/error"),navigator.userAgent.match(/android/i)&&(window.location="/error"),(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i))&&(window.location="/error"),o.online=navigator.onLine}]),app.controller("CreateNewEventController",["$scope","$document","APPService","fileReader","$location","$anchorScroll","$timeout","$http","YaraBaseUrl","$filter","GetDataService","$mdpDatePicker","$mdpTimePicker","$window","$rootScope",function(e,t,o,a,n,i,r,s,l,d,c,u,m,f,v){function p(e){return/^-?[\d.]+(?:e-?\d+)?$/.test(e)}function g(){e.Teventph=e.eventph,e.TeventEmail=e.eventemail,e.Teventweb=e.eventweb,e.Teventfb=e.eventfb,e.Teventtwitter=e.eventtwitter,e.$apply()}void 0!=localStorage.getItem("epData")&&""!=localStorage.getItem("epData")?(e.EPdata=localStorage.getItem("epData"),e.EPdata=angular.fromJson(e.EPdata).ep_code):window.location.replace("/packages"),i(),e.timeformat=localStorage.getItem("is_time_format_24"),"true"==e.timeformat?(e.is_time_format_24=!0,e.timeformaType="HH:mm"):(e.is_time_format_24=!1,e.timeformaType="hh:mm A");var y=angular.fromJson(localStorage.getItem("redirectionInfo"));e.timeZone=angular.fromJson(localStorage.getItem("timeZone")),e.eventPrivate=localStorage.getItem("isEventPrvt"),e.eventdays="",e.setOffset=function(e,t){return c.userOffsetTime(e,t)},e.suggestShrtName=function(){if(e.eventshrtname="",""!=e.eventname&&void 0!=e.eventname){for(var t=e.eventname,o=t.split(" "),a=[],n="",i=0;i<o.length;i++)p(o[i])?a.push(o[i]):/^[a-zA-Z0-9- ]*$/.test(o[i].charAt(0))&&a.push(o[i].charAt(0));for(var r=a.length>4?4:a.length,i=0;i<r;i++)p(a[i])||(n+=a[i]);for(var s="",l="",d="",i=0;i<a.length;i++)p(a[i])&&(4==a[i].length?l=i:d=i);""!=l?s+=" '"+a[l].charAt(2)+a[l].charAt(3):""!=d&&a[d].length>3?s+="-"+a[d].substring(0,3):""!=d&&(s+="-"+a[d]),1==o.length&&(n=o[0]),n.length>8&&(n=n.substring(0,8)),e.eventshrtname=n.toUpperCase()+s}},e.dates=[],e.dst=[],e.minDuration=[];var h=new Date(e.setOffset(e.timeZone.localTime,0));if(h.setDate(h.getDate()),null==y||!y.eventDetails||y.editeventDetails||y.eventInfo)if(null!=y&&y.eventDetails&&y.editeventDetails){e.eventEdit=!0,e.td=e,e.s=o,e.td.datetime={},e.td.starttime={},e.td.endtime={},e.td.maxtime={},e.td.mintime={},e.eventInformation=[],e.keyVal=[];var _=function(){e.timeInMs+=500,r(_,500)};r(_,500);var w=window.indexedDB.open("yaraDB9.db",1);w.onsuccess=function(t){e.db=t.target.result,e.getAllinfo()},w.onerror=function(e){console.log("error")},w.onupgradeneeded=function(t){e.db=t.target.result,e.db.createObjectStore("locInfo",{keyPath:"itemId"})}}else r(function(){$("#eventname").focus()},500),e.eventEdit=!1,e.currtdate=h,e.td=e,e.s=o,e.td.datetime={},e.td.starttime={},e.td.endtime={},e.td.maxtime={},e.td.mintime={},e.td.addingDay={},e.td.eventstartdate=d("date")(e.currtdate,"MMMM dd yyyy"),e.dates.push(d("date")(e.currtdate,"yyyy-MM-dd"));else window.location="/dashboard";e.getAllinfo=function(){var t=e.db.transaction(["locInfo"],"readonly");t.objectStore("locInfo").openCursor().onsuccess=function(t){var o=t.target.result;o&&(e.eventInformation.push(o.value),o.continue())},t.oncomplete=function(t){e.eventLoc=e.eventInformation[0].evntdetails,e.displayInfo()}},e.displayInfo=function(){e.td=e,e.s=o,e.td.datetime={},e.td.starttime={},e.td.endtime={},e.td.maxtime={},e.td.mintime={},e.uploadCoverimg=!1,e.uploadEventLogo=!1,e.dst=[];var t=localStorage.getItem("lat"),a=localStorage.getItem("lng");angular.forEach(e.eventLoc.dates,function(o,n){var i=d("date")(o,"yyyy-MM-dd"),r=Math.round(new Date(i).getTime()/1e3),s="https://maps.googleapis.com/maps/api/timezone/json?location="+t+","+a+"&timestamp="+r+"&key=AIzaSyDtW9biEk-bn7LFG-l9yO1ilKLLhRRv8Oo";$.getJSON(s,function(t){e.dst[i]=t.dstOffset})}),e.currtdate=e.eventLoc.dates[0],e.evntDate=e.eventLoc.evntDate,e.eventstartdate=d("date")(e.currtdate,"MMMM dd yyyy"),e.eventname=e.eventLoc.eventname,e.eventshrtname=e.eventLoc.eventshrtname,e.eventdesc=e.eventLoc.eventdesc,e.phDailCode=e.eventLoc.contact.dialcode,e.Teventph=e.eventLoc.contact.phone_no,e.TeventEmail=e.eventLoc.contact.eventemail,e.eventph=e.eventLoc.contact.phone_no,e.eventweb=e.eventLoc.contact.eventweb,e.eventfb=e.eventLoc.contact.eventfb,e.eventtwitter=e.eventLoc.contact.eventtwitter,e.eventemail=e.eventLoc.contact.eventemail,e.editimageSrc1=e.eventLoc.coverimg,e.editimageSrc=e.eventLoc.event_logo,""==e.editimageSrc1&&(e.uploadCoverimg=!0),e.td.starttime=e.eventLoc.strattimes,e.td.endtime=e.eventLoc.endtimes,e.dates=e.eventLoc.dates,window.setTimeout(function(){$("#create-event-details").height($("textarea")[1].scrollHeight)},500);var n=["company-website","twitter","facebook","phone","message"];e.validatetime(),angular.forEach(n,function(t,o){e.social_type=t,e.checkSocials()})},e.getMinDate=function(e){return e=new Date(e),d("date")(new Date,"yyyy-MM-dd")==d("date")(e,"yyyy-MM-dd")&&(e=new Date),e},e.td.datetime[d("date")(e.currtdate,"yyyy-MM-dd")]=e.getMinDate(d("date")(e.currtdate,"yyyy-MM-dd")),e.$watch("td.starttime",function(t,o){angular.forEach(t,function(t,a){void 0!=o[a]&&t!=o[a]&&t>e.td.endtime[a]&&(e.td.endtime[a]=t)})},!0),e.$watch("td.eventstartdate",function(t,o){if(void 0!=t&&0==e.eventEdit){e.dates=[],t=new Date(t);var a=d("date")(t,"yyyy-MM-dd");e.dates.push(a);var n=new Date(a);n.setHours(10),n.setMinutes(0);var i=new Date(a);i.setHours(16),i.setMinutes(0),e.td.starttime[a]=n,e.td.endtime[a]=i,e.td.maxtime[a]=!1,e.td.mintime[a]=!1,e.td.datetime[a]=e.getMinDate(a);var r=Math.round(new Date(n).getTime()/1e3),s=localStorage.getItem("lat"),l=localStorage.getItem("lng"),c="https://maps.googleapis.com/maps/api/timezone/json?location="+s+","+l+"&timestamp="+r+"&key=AIzaSyDtW9biEk-bn7LFG-l9yO1ilKLLhRRv8Oo";$.getJSON(c,function(t){e.dst[a]=t.dstOffset})}if(1==e.eventEdit&&void 0!=t&&void 0!=o){e.dates=[],t=new Date(t);var a=d("date")(t,"yyyy-MM-dd");e.dates.push(a);var n=new Date(a);n.setHours(10),n.setMinutes(0);var i=new Date(a);i.setHours(16),i.setMinutes(0),e.td.starttime[a]=n,e.td.endtime[a]=i,e.td.maxtime[a]=!1,e.td.mintime[a]=!1,e.td.datetime[a]=e.getMinDate(a);var r=Math.round(new Date(n).getTime()/1e3),s=localStorage.getItem("lat"),l=localStorage.getItem("lng"),c="https://maps.googleapis.com/maps/api/timezone/json?location="+s+","+l+"&timestamp="+r+"&key=AIzaSyDtW9biEk-bn7LFG-l9yO1ilKLLhRRv8Oo";$.getJSON(c,function(t){e.dst[a]=t.dstOffset})}},!0),e.editStartdate=function(t){if(1==e.eventEdit){e.dates=[],t=new Date(t);var o=d("date")(t,"yyyy-MM-dd"),a=Math.round(new Date(o).getTime()/1e3),n=localStorage.getItem("lat"),i=localStorage.getItem("lng"),r="https://maps.googleapis.com/maps/api/timezone/json?location="+n+","+i+"&timestamp="+a+"&key=AIzaSyDtW9biEk-bn7LFG-l9yO1ilKLLhRRv8Oo";$.getJSON(r,function(t){e.dst[o]=t.dstOffset}),e.dates.push(o);var s=new Date(o);s.setHours(10),s.setMinutes(0);var l=new Date(o);l.setHours(16),l.setMinutes(0),e.td.starttime[o]=s,e.td.endtime[o]=l,e.td.maxtime[o]=!1,e.td.mintime[o]=!1,e.td.datetime[o]=e.getMinDate(o)}},e.datepop=!0,e.showDatePicker=function(t){e.datepop=!1,u(t,new Date(e.eventstartdate),e.currtdate).then(function(t){e.eventstartdate=d("date")(t,"MMMM dd yyyy"),e.datepop=!0})},e.checkEventminDuration=function(){return e.eventDurationMin=!1,angular.forEach(e.dates,function(t,o){e.minDuration[e.dates[o]]=!1,e.td.endtime[e.dates[o]].getHours()-e.td.starttime[e.dates[o]].getHours()<2?(e.minDuration[e.dates[o]]=!0,e.eventDurationMin=!0):e.td.endtime[e.dates[o]].getHours()-e.td.starttime[e.dates[o]].getHours()==2&&Math.abs(e.td.endtime[e.dates[o]].getMinutes()-e.td.starttime[e.dates[o]].getMinutes())<0&&(e.minDuration[e.dates[o]]=!0,e.eventDurationMin=!0)}),e.eventDurationMin&&1==e.submitted2&&r(function(){o.scrollJquery("dateScroll")},100),e.eventDurationMin},e.timeInvalid=!1,e.addingDay=!1,e.addDay=function(){var t=e.dates.length,o=e.validatetime();if(console.log(o+"--- length--"+t),1==o&&void 0!=o)e.timeInvalid=!0,e.addingDay=!1;else if(0==o&&void 0!=o&&(e.timeInvalid=!1,t>=0&&t<20)){var a=new Date(e.dates[t-1]);a.setDate(a.getDate()+1);var n=new Date(e.dates[t-1]);n.setDate(n.getDate()+1);var i=d("date")(a,"yyyy-MM-dd"),r=Math.round(new Date(a).getTime()/1e3);e.dstCheck(i,r);var s=e.dates[e.dates.length-1];a.setHours(e.td.starttime[s].getHours()),a.setMinutes(e.td.starttime[s].getMinutes()),e.dates.push(i),e.td.starttime[i]=a,n.setHours(e.td.endtime[s].getHours()),n.setMinutes(e.td.endtime[s].getMinutes()),e.td.endtime[i]=n,e.td.datetime[i]=e.getMinDate(i),e.addingDay=!1,console.log("inside---"+o+"--- length--"+t)}},e.dstCheck=function(t,o){var a=localStorage.getItem("lat"),n=localStorage.getItem("lng"),i="https://maps.googleapis.com/maps/api/timezone/json?location="+a+","+n+"&timestamp="+o+"&key=AIzaSyDtW9biEk-bn7LFG-l9yO1ilKLLhRRv8Oo";$.getJSON(i,function(o){e.dst[t]=o.dstOffset})},e.validatetime=function(){return(null==y||!y.eventDetails||!y.editeventDetails)&&(!!e.detailsform["evntstarttime"+e.dates[0]].$untouched||!!e.detailsform["evntendtime"+e.dates[0]].$untouched)},e.timeValiadtion=function(){return"single"==e.evntDate&&e.td.endtime[e.dates[0]].getHours()-e.td.starttime[e.dates[0]].getHours()<2},e.deleteDay=function(){e.dates.length>0&&e.dates.pop(),$("#loadingDate").hide()},e.getevntdayjson=function(t){for(var o=[],a=0;a<t.length;a++){dateTime=moment(e.td.endtime[t[a]]).format("YYYY-MM-DD HH:mm");var n={day_name:"Day "+(a+1),start_time:moment(e.td.starttime[t[a]]).format("YYYY-MM-DD HH:mm"),end_time:moment(e.td.endtime[t[a]]).format("YYYY-MM-DD HH:mm")};o.push(n)}return o},e.getevntdays=function(t){for(var o="{",a=0;a<t.length;a++)0!=a&&(o+=","),o+='"'+t[a]+'":{ "starttime":"'+e.td.starttime[t[a]].getHours()+":"+e.td.starttime[t[a]].getMinutes()+'","endtime":"'+e.td.endtime[t[a]].getHours()+":"+e.td.endtime[t[a]].getMinutes()+'","day_name":"Day '+(a+1)+'"}';return o+="}"},e.pad=function(e){return e<10?"0"+e.toString():e.toString()},e.removeCoverimg=function(){e.uploadCoverimg=!0},e.evnetDetailsValidation=function(){$("#loading").show();var t=new Date(e.eventstartdate);t.getDate(),t.getMonth(),t.getFullYear();e.eventdays=e.getevntdayjson(e.dates);var o=new FormData;o.append("name",e.eventname),o.append("description",e.eventdesc),o.append("start_date",e.eventdays[0].start_time),o.append("c_code",e.phDailCode),o.append("phone_no",e.eventph),o.append("event_days",e.dates),o.append("short_name",e.eventshrtname),o.append("email",e.eventemail),o.append("end_date",e.eventdays[e.eventdays.length-1].end_time),o.append("timezone",e.timeZone.timezone),e.eventEdit?(e.uploadEventLogo?e.imgSrc&&o.append("event_logo",c.dataURItoBlob(e.imgSrc)):o.append("event_logo",c.dataURItoBlob(e.eventLoc.event_logo)),e.uploadCoverimg&&!e.imgSrc1&&o.append("c_img",""),e.uploadCoverimg?e.imgSrc1&&o.append("c_img",c.dataURItoBlob(e.imgSrc1)):o.append("c_img",c.dataURItoBlob(e.eventLoc.coverimg))):(e.imageSrc&&o.append("event_logo",c.dataURItoBlob(e.imageSrc)),void 0==e.imageSrc1?o.append("c_img",""):o.append("c_img",c.dataURItoBlob(e.imageSrc1))),s({method:"POST",url:l.url+"/event/validate/",data:o,transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(t){1==t.data.result?e.saveEventdetails():0==t.data.result&&(e.errormsg=!0,e.showerror=t.data.message,$("#loading").hide(),$("#container").fadeIn())},function(t){e.data={},e.errormsg=!0,(t.status==-1||null==t.data)&&0==v.online?e.showerror=c.errorMsg[0]:e.showerror=c.errorMsg[1]})},e.saveEventdetails=function(){function t(){i.transaction(["locInfo"],"readonly").objectStore("locInfo").openCursor().onsuccess=function(e){var t=e.target.result;t?t.continue():console.log("no more results")}}function o(e){i.transaction(["locInfo"],"readwrite").objectStore("locInfo").put({itemId:"evntdetails",evntdetails:e}).onsuccess=function(e){y.eventDetails=!0,y.editlocPlace=!1,y.locmanualPlace=!1,y.editeventInfo=!1,y.editeventDetails=!1,localStorage.setItem("redirectionInfo",angular.toJson(y)),window.location="/create-event-confirm"}}var a,n;e.eventEdit?(e.uploadEventLogo?e.imgSrc&&(a=e.imgSrc):a=e.eventLoc.event_logo,e.uploadCoverimg&&!e.imgSrc1&&(n=""),e.uploadCoverimg?e.imgSrc1&&(n=e.imgSrc1):n=e.eventLoc.coverimg):(e.imageSrc&&(a=e.imageSrc),n=e.imageSrc1?e.imageSrc1:""),e.eventdays=e.getevntdayjson(e.dates),e.eventtimes=e.getevntdays(e.dates),e.eventenddate=e.dates[e.dates.length-1];var i,r={dialcode:e.phDailCode,phone_no:e.eventph,phone_number:e.phDailCode+" "+e.eventph,eventweb:e.eventweb,eventfb:e.eventfb,eventtwitter:e.eventtwitter,eventemail:e.eventemail},s={eventname:e.eventname,eventshrtname:e.eventshrtname,eventdesc:e.eventdesc,evntDate:e.evntDate,eventstartdate:e.eventdays[0].start_time,eventenddate:e.eventdays[e.eventdays.length-1].end_time,event_logo:a,coverimg:n,eventdays:e.eventdays,contact:r,dates:e.dates,eventtime:e.eventtimes,strattimes:e.td.starttime,endtimes:e.td.endtime},l=window.indexedDB.open("yaraDB9.db",1);l.onsuccess=function(e){i=e.target.result,o(s),t()},l.onerror=function(e){console.log("error")},l.onupgradeneeded=function(e){i=e.target.result,i.createObjectStore("locInfo",{keyPath:"itemId"})}},e.Teventph="",e.TeventEmail="",e.Teventweb="",e.Teventfb="",e.Teventtwitter="",e.eventph="",e.eventweb="",e.eventfb="",e.eventtwitter="",e.eventemail="",e.checkSocials=function(){var t=0;"company-website"==e.social_type&&e.eventweb.length>7?t=1:"twitter"==e.social_type&&20!=e.eventtwitter.length?t=1:"facebook"==e.social_type&&25!=e.eventfb.length?t=1:"phone"==e.social_type&&void 0!=e.eventph&&0!=e.eventph.length?t=1:"message"==e.social_type&&void 0!=e.eventemail&&0!=e.eventemail.length&&(t=1);var o=c.getSocailId(e.social_type);1==t?$("."+o).removeClass("bootstrap-font-icon-gray").addClass("bootstrap-font-icon-black"):$("."+o).removeClass("bootstrap-font-icon-black").addClass("bootstrap-font-icon-gray")},e.saveSocials=function(){e.eventph=e.Teventph,e.eventweb=e.Teventweb,e.eventfb=e.Teventfb,e.eventtwitter=e.Teventtwitter,e.eventemail=e.TeventEmail,e.checkSocials(),$("#myModal-social").modal("hide"),$("#myModal-social4").modal("hide")},$("#myModal-social").on("show.bs.modal",function(t){e.typeofchange=""}),$("#myModal-social4").on("show.bs.modal",function(t){e.typeofchange=""}),$("#myModal-social").on("hidden.bs.modal",function(t){"save"!=e.typeofchange&&(g(),e.checkSocials())}),$("#myModal-social4").on("hidden.bs.modal",function(t){"save"!=e.typeofchange&&(g(),e.checkSocials())}),e.setFocus=function(t){"phone"!=t||null!=e.phDailCode&&void 0!=e.phDailCode?setTimeout(function(){$("#"+e.social_type+"_id").focus();var t=$("#"+e.social_type+"_id").val().length;void 0!=t&&t>0&&$("#"+e.social_type+"_id")[0].setSelectionRange(t,t)},1e3):setTimeout(function(){$("#country_code").focus()},1e3)},e.getDialCode=function(){s({method:"GET",url:"../dial_code_json"}).then(function(t){e.dailcode=t.data})},e.phDailCode="",e.phDailCode="",e.phdialreq=!0,e.startsWith=function(e,t){return 0===(e+"").toLowerCase().indexOf(t.toLowerCase())},e.phoneInfo=function(){var t=angular.fromJson(localStorage.getItem("phonInfo"));void 0==t.phDailCode||null==t.phDailCode||(e.phDailCode=t.phDailCode),e.phdialreq=t.phdialreq},e.errorScroll=function(){null!=y&&y.eventDetails&&y.editeventDetails?(e.uploadEventLogo&&(e.detailsform.evntlogoChange.$invalid&&(e.detailsform.evntlogoChange.$setValidity("minsizeval",!0),e.detailsform.evntlogoChange.$setValidity("minDimension",!0),e.detailsform.evntlogoChange.$setValidity("ratioval",!0)),e.imageSrc||r(function(){o.scrollJquery("evntlogoerredit")},100)),e.detailsform["evntstarttime"+e.dates[0]].$untouched=!1,e.detailsform["evntendtime"+e.dates[0]].$untouched=!1):void 0!=e.eventname&&void 0!=e.eventshrtname&&void 0!=e.eventdesc&&(void 0==e.imageSrc||""==e.imageSrc||null==e.imageSrc?r(function(){o.scrollJquery("evntlogoerr")},100):e.detailsform.evntlogo.$invalid?(e.detailsform.evntlogo.$setValidity("minsizeval",!0),e.detailsform.evntlogo.$setValidity("minDimension",!0),e.detailsform.evntlogo.$setValidity("ratioval",!0),e.imageSrc1=""):e.detailsform["evntstarttime"+e.dates[0]].$untouched?r(function(){o.scrollJquery("evntstarttime"+e.dates[0])},100):e.detailsform["evntendtime"+e.dates[0]].$untouched?r(function(){o.scrollJquery("evntendtime"+e.dates[0])},100):""==e.TeventEmail||void 0==e.TeventEmail?r(function(){o.scrollJquery("socialErremail")},100):""!=e.Teventph&&void 0!=e.Teventph||r(function(){o.scrollJquery("socialErr")},100))},e.invalidImage=function(){return e.eventEdit?e.uploadEventLogo?e.imgSrc?void 0:(r(function(){o.scrollJquery("evntlogoerr")},100),!0):""==e.editimageSrc:void 0==e.imageSrc||""==e.imageSrc||null==e.imageSrc},e.eventfb="https://www.facebook.com/",e.eventtwitter="https://twitter.com/",e.setCropImg=function(){var t=$(".image-editor").cropit("export"),o=c.dataURItoBlob(t);"evntlogo"==e.cropType?(e.imageSrc=t,angular.forEach(e.evntlogo.getFiles(e.evntlogo.FILE_TYPES.VALID),function(e,t){e.file=o})):"coverimg"==e.cropType?(e.imageSrc1=t,angular.forEach(e.coverimg.getFiles(e.coverimg.FILE_TYPES.VALID),function(e,t){e.file=o})):"evntlogoChange"==e.cropType?(console.log("reach crop"),e.imgSrc=t,angular.forEach(e.evntlogoChange.getFiles(e.evntlogoChange.FILE_TYPES.VALID),function(e,t){e.file=o})):"coverimgChange"==e.cropType&&(e.imgSrc1=t,angular.forEach(e.coverimgChange.getFiles(e.coverimgChange.FILE_TYPES.VALID),function(e,t){e.file=o})),$("#crop-image").modal("hide"),$(".image-editor").cropit("imageSrc","")},e.resetCropImg=function(){"evntlogo"==e.cropType?(e.imageSrc="",angular.forEach(e.evntlogo.getFiles(e.evntlogo.FILE_TYPES.VALID),function(e,t){e.setType(4)})):"coverimg"==e.cropType?(e.imageSrc1="",angular.forEach(e.coverimg.getFiles(e.coverimg.FILE_TYPES.VALID),function(e,t){e.setType(4)})):"evntlogoChange"==e.cropType?(e.imgSrc="",angular.forEach(e.evntlogoChange.getFiles(e.evntlogoChange.FILE_TYPES.VALID),function(e,t){e.setType(4)})):"coverimgChange"==e.cropType&&(e.imgSrc1="",angular.forEach(e.coverimgChange.getFiles(e.coverimgChange.FILE_TYPES.VALID),function(e,t){e.setType(4)})),$(".image-editor").cropit("imageSrc","")},e.$on("$dropletReady",function(){e.evntlogo.allowedExtensions(["png","jpg","jpeg"]),e.coverimg.allowedExtensions(["png","jpg","jpeg"]),e.evntlogoChange.allowedExtensions(["png","jpg","jpeg"]),e.coverimgChange.allowedExtensions(["png","jpg","jpeg"])}),e.$on("$dropletInvalid",function(){$("#myModal-invalid").modal("show")}),e.$on("$dropletFileAdded",function(t,o){e.lodinghide=!1;var n=e.evntlogo.getFiles(e.evntlogo.FILE_TYPES.VALID).length;n>0&&angular.forEach(e.evntlogo.getFiles(e.evntlogo.FILE_TYPES.VALID),function(t,o){o!=n-1?t.setType(4):t.file.size>5242880?(e.detailsform.evntlogo.$setValidity("minsizeval",!1),t.setType(4),e.imageSrc=""):(e.detailsform.evntlogo.$setValidity("minsizeval",!0),a.readAsDataUrl(t.file,e).then(function(o){c.getImgDimensions(o,function(a,n){a>=1024&&n>=1024?(e.detailsform.evntlogo.$setValidity("minDimension",!0),1024==a&&1024==n?e.imageSrc=o:(e.cropType="evntlogo",$(".image-editor").cropit({imageBackground:!0,imageBackgroundBorderWidth:20,imageState:{src:o}}),$(".image-editor").cropit("imageSrc",o),$(".image-editor").cropit("previewSize",{width:250,height:250}),$(".image-editor").cropit("exportZoom",4.096),$("#crop-image").modal("show"),r(function(){e.lodinghide=!0},2e3))):(e.detailsform.evntlogo.$setValidity("minDimension",!1),t.setType(4),e.imageSrc=""),e.$apply()})}))}),n=e.coverimg.getFiles(e.coverimg.FILE_TYPES.VALID).length,n>0&&angular.forEach(e.coverimg.getFiles(e.coverimg.FILE_TYPES.VALID),function(t,o){o!=n-1?t.setType(4):t.file.size>5242880?(e.detailsform.coverimg.$setValidity("minsizeval",!1),e.imageSrc1="",t.setType(4)):(e.detailsform.coverimg.$setValidity("minsizeval",!0),a.readAsDataUrl(t.file,e).then(function(o){c.getImgDimensions(o,function(a,n){a>=1024&&n>=1024?(e.detailsform.coverimg.$setValidity("minDimension",!0),1024==a&&1024==n?e.imageSrc1=o:(e.cropType="coverimg",$(".image-editor").cropit({imageBackground:!0,imageBackgroundBorderWidth:20,imageState:{src:o}}),$(".image-editor").cropit("imageSrc",o),$(".image-editor").cropit("previewSize",{width:250,height:250}),$(".image-editor").cropit("exportZoom",4.096),$("#crop-image").modal("show"),r(function(){e.lodinghide=!0},2e3))):(e.detailsform.coverimg.$setValidity("minDimension",!1),t.setType(4),e.imageSrc1=""),e.$apply()})}))}),n=e.evntlogoChange.getFiles(e.evntlogoChange.FILE_TYPES.VALID).length,n>0&&angular.forEach(e.evntlogoChange.getFiles(e.evntlogoChange.FILE_TYPES.VALID),function(t,o){o!=n-1?t.setType(4):t.file.size>5242880?(e.detailsform.evntlogoChange.$setValidity("minsizeval",!1),e.imgSrc="",t.setType(4)):(e.detailsform.evntlogoChange.$setValidity("minsizeval",!0),a.readAsDataUrl(t.file,e).then(function(o){c.getImgDimensions(o,function(a,n){a>=1024&&n>=1024?(e.detailsform.evntlogoChange.$setValidity("minDimension",!0),1024==a&&1024==n?e.imgSrc=o:(e.cropType="evntlogoChange",$(".image-editor").cropit({imageBackground:!0,imageBackgroundBorderWidth:20,imageState:{src:o}}),$(".image-editor").cropit("imageSrc",o),$(".image-editor").cropit("previewSize",{width:250,height:250}),$(".image-editor").cropit("exportZoom",4.096),$("#crop-image").modal("show"),r(function(){e.lodinghide=!0},2e3))):(e.detailsform.evntlogoChange.$setValidity("minDimension",!1),t.setType(4),e.imgSrc=""),e.$apply()})}))}),(n=e.coverimgChange.getFiles(e.coverimgChange.FILE_TYPES.VALID).length)>0&&angular.forEach(e.coverimgChange.getFiles(e.coverimgChange.FILE_TYPES.VALID),function(t,o){o!=n-1?t.setType(4):t.file.size>5242880?(e.detailsform.coverimgChange.$setValidity("minsizeval",!1),e.imgSrc1="",t.setType(4)):(e.detailsform.coverimgChange.$setValidity("minsizeval",!0),a.readAsDataUrl(t.file,e).then(function(o){c.getImgDimensions(o,function(a,n){a>=1024&&n>=1024?(e.detailsform.coverimgChange.$setValidity("minDimension",!0),1024==a&&1024==n?e.imgSrc1=o:(e.cropType="coverimgChange",$(".image-editor").cropit({imageBackground:!0,imageBackgroundBorderWidth:20,imageState:{src:o}}),$(".image-editor").cropit("imageSrc",o),$(".image-editor").cropit("previewSize",{width:250,height:250}),$(".image-editor").cropit("exportZoom",4.096),$("#crop-image").modal("show"),r(function(){e.lodinghide=!0},2e3))):(e.detailsform.coverimgChange.$setValidity("minDimension",!1),t.setType(4),e.imgSrc1=""),e.$apply()})}))})}),e.$on("$dropletFileDeleted",function(){var t=e.evntlogo.getFiles(e.evntlogo.FILE_TYPES.VALID).length;t<=0&&(e.imageSrc=""),t=e.coverimg.getFiles(e.coverimg.FILE_TYPES.VALID).length,t<=0&&(e.imageSrc1=""),t=e.evntlogoChange.getFiles(e.evntlogoChange.FILE_TYPES.VALID).length,t<=0&&(e.imgSrc=""),(t=e.coverimgChange.getFiles(e.coverimgChange.FILE_TYPES.VALID).length)<=0&&(e.imgSrc1="")}),e.$on("$dropletError",function(){}),0==v.online&&alert("You are not connected to internet")}]),app.controller("EventInfoController",["$scope","$document","APPService","fileReader","$location","$anchorScroll","$timeout","$http","YaraBaseUrl","$filter","GetDataService","$mdpDatePicker","$mdpTimePicker","$window","$rootScope",function(e,t,o,a,n,i,r,s,l,d,c,u,m,f,v){void 0!=localStorage.getItem("epData")&&""!=localStorage.getItem("epData")?(e.EPdata=localStorage.getItem("epData"),e.EPdata=angular.fromJson(e.EPdata).ep_code):window.location.replace("/packages"),$("#loading").show(),i();var p=angular.fromJson(localStorage.getItem("redirectionInfo"));e.latlan=function(){var t={lat:localStorage.getItem("lat"),long:localStorage.getItem("lng")};c.eventLocalTz(t).then(function(t){1==t.result&&(localStorage.setItem("timeZone",JSON.stringify({timezone:t.timezone,localTime:t.local_time_now})),e.getEventTypes())})},e.latlan(),e.selectedval=0,e.evntfreq="Annually",e.tabsel=1,e.eventdays="",e.isEventPrvt=!1,e.s=o,e.datepop=!0,e.subtypelist=[],e.getEventTypes=function(){c.getEventTypes().then(function(t){if(1==t.result){if(e.eventtypes=t.event_types,null==p||!p.eventInfo||p.editeventInfo||p.locPlace&&p.locManual){if(null!=p&&p.eventInfo&&p.editeventInfo){e.eventInformation=[],e.keyVal=[];var o=function(){e.timeInMs+=500,r(o,500)};r(o,500);var a=window.indexedDB.open("yaraDB9.db",1);a.onsuccess=function(t){e.db=t.target.result,e.getAllinfo()},a.onerror=function(e){console.log("error")},a.onupgradeneeded=function(t){e.db=t.target.result,e.db.createObjectStore("locInfo",{keyPath:"itemId",autoIncrement:!0})}}}else window.location="/dashboard";$("#loading").hide(),$("#container").fadeIn()}})},e.selectedtype=function(t){$(".subtitle").text("Select Type"),$(".subtitlesearch").val(""),e.subtitlesearch="",e.selectedval=t;for(var o=0;o<e.eventtypes.length;o++)if(t==e.eventtypes[o].type_id){e.subtypelist=e.eventtypes[o].sub_type,e.subtitle="";break}},e.subtitle="",e.changeSubtype=function(t){$(".subtype_dropdown .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".subtitlesearch").hide(),$(".subtitle").show(),""==t?(e.subtitle=t,$(".subtitle").text("Select Type"),$(".subtitlesearch").val(""),e.subtitlesearch=""):(e.subtitle=t,$(".subtitle").text(e.subtitle),$(".subtitlesearch").val(e.subtitle))},$(document).on("click",".country_dropdown .primary_nav_wrap ul li",function(){$(".menutitlesearch").show(),$(".menutitle").hide(),$(".menutitlesearch").focus(),$(".country_dropdown img").removeClass(),$(".country_dropdown img").addClass("caret02"),$(".country_dropdown .primary_nav_wrap ul li ul").css({display:"list-item",color:"#000","z-index":100})}),$(document).on("click",".subtype_dropdown .primary_nav_wrap ul li",function(){$(".subtitlesearch").show(),$(".subtitle").hide(),$(".subtitlesearch").focus(),$(".subtype_dropdown img").removeClass(),$(".subtype_dropdown img").addClass("caret02"),$(".subtype_dropdown .primary_nav_wrap ul li ul").css({display:"list-item",color:"#000","z-index":100})}),$(document).on("click",".state_dropdown .primary_nav_wrap ul li",function(){$(".menutitlestatesearch").show(),$(".menutitlestate").hide(),$(".menutitlestatesearch").focus(),$(".state_dropdown img").removeClass(),$(".state_dropdown img").addClass("caret02"),$(".state_dropdown  .primary_nav_wrap ul li ul").css({display:"list-item",color:"#000","z-index":100})}),t.on("click",function(t){var o=$(".country_dropdown .primary_nav_wrap ul li");o===t.target||o.has(t.target).length||"none"==$(".menutitlesearch").css("display")||($(".country_dropdown .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".menutitlesearch").hide(),$(".menutitle").show(),"Select Country"!=$("#menutitle.menutitle").text()&&($(".menutitlesearch").val($("#menutitle.menutitle").text()),e.countrysearch=$("#menutitle.menutitle").text(),e.countrydata=d("custom")(e.countries,e.countrysearch),e.$apply()),$(".menutitlesearch").trigger("input"),$(".country_dropdown img").removeClass(),$(".country_dropdown img").addClass("caret01"));var o=$(".state_dropdown .primary_nav_wrap ul li");o===t.target||o.has(t.target).length||"none"==$(".menutitlestatesearch").css("display")||($(".state_dropdown .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".menutitlestatesearch").hide(),$(".menutitlestate").show(),"Select State/Province"!=$("#menutitlestate.menutitlestate").text()&&($(".menutitlestatesearch").val($("#menutitlestate.menutitlestate").text()),e.statesearch=$("#menutitlestate.menutitlestate").text(),e.statedata=d("custom")(e.states,e.statesearch),e.$apply()),$(".state_dropdown img").removeClass(),$(".state_dropdown img").addClass("caret01"));var o=$(".subtype_dropdown .primary_nav_wrap ul li");o===t.target||o.has(t.target).length||"none"==$(".subtitlesearch").css("display")||($(".subtype_dropdown .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".subtitlesearch").hide(),$(".subtitle").show(),"Select Type"!=$("#subtitle.subtitle").text()&&($(".subtitlesearch").val($("#subtitle.subtitle").text()),e.subtitlesearch=$("#subtitle.subtitle").text(),e.subtypedata=d("filter")(e.subtypelist,e.subtitlesearch),e.$apply()),$(".subtitlesearch").trigger("input"),$(".subtype_dropdown img").removeClass(),$(".subtype_dropdown img").addClass("caret01"))}),e.saveEventInfo=function(){function t(){a.transaction(["locInfo"],"readonly").objectStore("locInfo").openCursor().onsuccess=function(e){var t=e.target.result;t&&(console.log(t.value),t.continue())}}function o(t){a.transaction(["locInfo"],"readwrite").objectStore("locInfo").put({itemId:"evntinfo",evntinfo:t}).onsuccess=function(t){p.eventInfo=!0,null!=p&&p.eventInfo&&p.editeventInfo&&(p.editeventDetails=!0),localStorage.setItem("isEventPrvt",e.isEventPrvt),localStorage.setItem("redirectionInfo",angular.toJson(p)),window.location.href="/create-event-details"}}var a,n={type_title:e.eventtypes[e.selectedval-1].type_title,type_id:e.eventtypes[e.selectedval-1].type_id,subtitle:e.subtitle,isEventPrvt:e.isEventPrvt,evntfreq:e.evntfreq,selectedval:e.selectedval},i=window.indexedDB.open("yaraDB9.db",1);i.onsuccess=function(e){
a=e.target.result,console.log("db created success"),console.log(e),o(n),t()},i.onerror=function(e){console.log("error")},i.onupgradeneeded=function(e){console.log("new db"),a=e.target.result,a.createObjectStore("locInfo",{keyPath:"itemId"})}},e.errorScroll=function(){r(function(){0==e.selectedval?o.scrollJquery("selectedvalerr"):""==e.subtitle&&o.scrollJquery("subtitleerr")},100)},e.getAllinfo=function(){console.log("calling index db");var t=e.db.transaction(["locInfo"],"readonly");t.objectStore("locInfo").openCursor().onsuccess=function(t){var o=t.target.result;o&&(e.eventInformation.push(o.value),o.continue())},t.oncomplete=function(t){e.eventLoc=e.eventInformation[1].evntinfo,e.displayInfo()}},e.displayInfo=function(){e.isEventPrvt=e.eventLoc.isEventPrvt,e.evntfreq=e.eventLoc.evntfreq,e.selectedval=e.eventLoc.selectedval,e.selectedtype(e.eventLoc.selectedval),e.changeSubtype(e.eventLoc.subtitle)},0==v.online&&alert("You are not connected to internet")}]),app.controller("EventCouponController",["$scope","$document","APPService","fileReader","$location","$anchorScroll","$timeout","$http","YaraBaseUrl","$filter","GetDataService","$mdpDatePicker","$mdpTimePicker","$window","$rootScope",function(e,t,o,a,n,i,r,s,l,d,c,u,m,f,v){function p(e){for(var t=e.length-1;t>0;t--){var o=Math.floor(Math.random()*(t+1)),a=e[t];e[t]=e[o],e[o]=a}return e}function g(e){$(e).css({height:"auto","overflow-y":"hidden"}).height(e.scrollHeight)}e.headerTitle="Coupons",e.dashboardsUrl=c.dashboardUrl();var y=localStorage.getItem("selectedEventId"),h=angular.fromJson(localStorage.getItem("Logininfo"));console.log(h.exhibiting_days),void 0!=h.exhibiting_days&&"Exhibitor"==h.user_type&&(e.exhibitingDays=h.exhibiting_days,e.isExhibitor=!0),e.timeformat=localStorage.getItem("is_time_format_24"),"true"==e.timeformat?(e.is_time_format_24=!0,e.timeformaType="HH:mm"):(e.is_time_format_24=!1,e.timeformaType="hh:mm A"),e.locationHref=window.location.pathname,"Admin"==c.getPrivilege()?e.privilege=!0:e.privilege=!1,e.cuponsearch="",void 0===y||null===y?window.location.replace("/events"):(e.selevntdata=localStorage.getItem("selEventsData"),e.currentval=angular.fromJson(e.selevntdata),document.title="YARA - "+e.currentval.short_name+" - Coupon"),e.setOffset=function(e,t){return c.userOffsetTime(e,t)},e.urlvalid=!0,e.mainurl=!1,e.urlvalidation=function(){e.couponUrl.length>7&&(/^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,253}(:[0-9]{1,5})?(\/.*)?$/.test(e.couponUrl)?e.urlvalid=e.mainurl=!1:e.urlvalid=e.mainurl=!0)};var _=e.setOffset(e.currentval.start_date,e.currentval.eo),w=e.setOffset(e.currentval.end_date,e.currentval.eo),I=d("date")(_,"yyyy-MM-dd");d("date")(w,"yyyy-MM-dd");e.dates={},e.dayscount=Object.keys(e.currentval.days).length;var S=o.Dateslist(I,e.dayscount);e.service=o,e.speakerEngage=!0,e.notimeDiff=!1,e.showTime=!1,e.eventDaysInfo=[],1==e.isExhibitor?angular.forEach(e.currentval.days,function(t,o){var a={dayID:e.currentval.days[o].dayID,dayTitle:e.currentval.days[o].dayTitle,dstOffset:e.currentval.days[o].dstOffset,isDayActive:e.currentval.days[o].is_day_active,endTime:e.setOffset(e.currentval.days[o].endTime,e.currentval.eo),startTime:e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),date:d("date")(e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),"yyyy-MM-dd"),dayAvailableForCoupon:!1};e.eventDaysInfo.push(a),angular.forEach(e.exhibitingDays,function(t,a){e.currentval.days[o].dayID==e.exhibitingDays[a]&&(e.eventDaysInfo[o].dayAvailableForCoupon=!0)})}):angular.forEach(e.currentval.days,function(t,o){var a={dayID:e.currentval.days[o].dayID,dayTitle:e.currentval.days[o].dayTitle,dstOffset:e.currentval.days[o].dstOffset,isDayActive:e.currentval.days[o].is_day_active,endTime:e.setOffset(e.currentval.days[o].endTime,e.currentval.eo),startTime:e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),date:d("date")(e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),"yyyy-MM-dd"),dayAvailableForCoupon:!0};e.eventDaysInfo.push(a)}),console.log(e.eventDaysInfo),angular.forEach(S,function(t){angular.forEach(e.eventDaysInfo,function(o,a){t==e.eventDaysInfo[a].date&&(e.dates[t]=e.eventDaysInfo[a])})}),e.expirationDayid=e.eventDaysInfo[e.eventDaysInfo.length-1].dayID,e.maxCouponTime=e.eventDaysInfo[e.eventDaysInfo.length-1].endTime,e.selval=e.EXselval=e.dates[0],e.displaytime=e.expirytime=new Date(I),e.currentdate=new Date,e.s=o,e.subtitle="",e.edit_custom=!1,e.couponfor="all",e.changeSubtype=function(t){if($(".subtype_dropdown .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".subtitle").show(),""==t||void 0==t)e.subtitle=t,$(".subtitle").text("Select Date"),e.subtitlevalue=!0;else{e.selectedDayinfo=t,e.subtitlevalue=!1,1==e.isExhibitor?e.isExpiry=!0:e.isExpiry=!1;var o=e.checkTimeNow(t.startTime);if(e.minTime=new Date(o),console.log(e.minTime),e.subtitle=o,$(".subtitle").text(d("date")(o,"MMM dd, yyyy")),e.time=new Date(o),e.selectexperydate=!1,e.reachEndDate=!1,e.mindatecoupon=o,1==e.editCoupon)for(var a=e.eventDaysInfo.length-1;a>=0;a--)e.eventDaysInfo[a].dayID==e.editCouponInfo.expiry_day_id&&(e.changeEDate(e.eventDaysInfo[a]),e.selectexperydate=!0);0==e.selectexperydate&&e.changeEDate(""),e.avilabileTickets()}},$(document).on("click",".subtype_dropdown .primary_nav_wrap ul li",function(){$(".subtype_dropdown img").removeClass(),$(".subtype_dropdown img").addClass("caret02"),$(".subtype_dropdown .primary_nav_wrap ul li ul").css({display:"list-item",color:"#000","z-index":100})}),e.eDatetitle="",e.changeEDate=function(t){if(console.log(t),$(".eDate_dropdown .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".eDatetitle").show(),""==t)e.eDatetitle=t,$(".eDatetitle").text("Select Date");else{if(e.eDateInfo=t,e.selectedDayinfo.dayID==e.eDateInfo.dayID){var o=new Date(e.time);o.setMinutes(o.getMinutes()+30),e.eDatetitle=o,$(".eDatetitle").text(d("date")(o,"MMM dd, yyyy")),e.Etime=new Date(o)}else e.eDatetitle=t.startTime,$(".eDatetitle").text(d("date")(t.startTime,"MMM dd, yyyy")),e.Etime=new Date(t.startTime);e.avilabileTickets()}},$(document).on("click",".eDate_dropdown .primary_nav_wrap ul li",function(){$(".eDate_dropdown img").removeClass(),$(".eDate_dropdown img").addClass("caret02"),$(".eDate_dropdown .primary_nav_wrap ul li ul").css({display:"list-item",color:"#000","z-index":100})}),t.on("click",function(e){var t=$(".subtype_dropdown .primary_nav_wrap ul li");t===e.target||t.has(e.target).length||"none"==$(".subtitlesearch").css("display")||($(".subtype_dropdown .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".subtype_dropdown img").removeClass(),$(".subtype_dropdown img").addClass("caret01")),(t=$(".eDate_dropdown .primary_nav_wrap ul li"))===e.target||t.has(e.target).length||"none"==$(".subtitlesearch").css("display")||($(".eDate_dropdown .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".eDate_dropdown img").removeClass(),$(".eDate_dropdown img").addClass("caret01"))}),e.$watch("Etime",function(t,o){e.Etime>e.maxCouponTime&&(e.Etime=e.maxCouponTime)},!0),e.addcup=function(){e.couponUrl=e.couponCode=e.CPname=e.CPdesc="",e.isExpiry=!1,e.CustSubmit=!1,e.couponfor,e.Custtickets=[],e.isOnlineCoupon=!0,e.attende=0,e.spoLocation="",i(),r(function(){$("textarea").each(function(){g(this)})},100),e.changeSubtype(),e.changeEDate("")},e.getTickets=function(){c.getTickets(e.currentval.event_code).then(function(t){1==t.result?e.ticketlist=t.tickets:e.ticketlist=[]})},e.avilabileTickets=function(){1==e.isExpiry&&void 0!=e.eDateInfo&&(e.expirationDayid=e.eDateInfo.dayID),$("#loading").show(),s({method:"POST",url:l.url+"/custom_coupon/tickets/",data:{display_day_id:e.selectedDayinfo.dayID,expiry_day_id:e.expirationDayid,event_code:e.currentval.event_code}}).then(function(t){1==t.data.result?(e.ticketlist=t.data.ticket_data,$("#loading").hide(),$("#container").fadeIn()):0==t.data.result&&(e.errormsg=!0,e.showerror=t.data.message,$("#loading").hide(),$("#container").fadeIn())},function(t){e.data={},e.errormsg=!0,(t.status==-1||null==t.data)&&0==v.online?e.showerror=c.errorMsg[0]:e.showerror=c.errorMsg[1]})},e.getCustomCoupon=function(){$("#loading").show(),c.getCustomCoupon(e.currentval.event_code).then(function(t){1==t.result&&(e.CUSTdata=t.custom_coupons,e.offsetEo=t.eo,$("#loading").hide(),$("#container").fadeIn())})},e.checkTimeNow=function(t){var o=((new Date).getTime()-e.localTimeNow.getTime())/1e3;o/=60;var a=e.setOffset(e.timeNow,Math.abs(Math.round(o))+5);return a>t?(console.log(a),a):(console.log(a),t)},c.eventLocalTz({tz:e.currentval.event_timezone}).then(function(t){1==t.result&&(e.timeNow=t.local_time_now,e.localTimeNow=new Date,e.getCustomCoupon())}),e.getTickets(),e.removeCouponModal=function(t,o){e.cuoponTitle=t,e.cuoponCode=o},e.removeCoupon=function(){$("#loading").show(),s({method:"POST",url:l.url+"/custom_coupon_edit/",data:{coupon_code:e.cuoponCode,opp:"delete"}}).then(function(t){1==t.data.result?($("#adspace-delete").modal("hide"),e.getCustomCoupon()):0==t.data.result&&(e.errormsg=!0,e.showerror=t.data.message,$("#loading").hide(),$("#container").fadeIn())},function(t){e.data={},e.errormsg=!0,(t.status==-1||null==t.data)&&0==v.online?e.showerror=c.errorMsg[0]:e.showerror=c.errorMsg[1]})},e.editCoupon=!1,e.editCustomCoupon=function(t){if(e.Custtickets=[],e.editCoupon=!0,e.mainurl=!1,e.urlvalid=!1,e.editCouponInfo=t,e.couponId=t.coupon_code,1==t.coupon_type){e.isOnlineCoupon=!1;for(var o=e.evtLoc.length-1;o>=0;o--)e.evtLoc[o].location_code==t.location.location_code&&e.locationClick(e.evtLoc[o])}else e.isOnlineCoupon=!0,e.couponUrl=t.coupon_url,e.couponCode=t.coupon_url_code;if(e.CPname=t.name,e.CPdesc=t.description,1==t.for_all)e.couponfor;else if(t.tickets.length>0){e.couponfor="ticket";for(var o=t.tickets.length-1;o>=0;o--)e.custtickets(t.tickets[o])}else null!=t.random&&(e.couponfor="users",e.attende=t.random);for(var o=e.eventDaysInfo.length-1;o>=0;o--)e.eventDaysInfo[o].dayID==t.display_day_id&&e.changeSubtype(e.eventDaysInfo[o]);e.time=e.setOffset(t.display_time,e.currentval.eo),void 0==t.expiry_time&&null==t.expiry_time||(e.Etime=e.setOffset(t.expiry_time,e.currentval.eo),e.isExpiry=!0),e.edit_custom=!0,e.add_custom=!0,r(function(){$("textarea").each(function(){g(this)})},100)},e.addCoupon=function(){e.edit_custom=!0,e.add_custom=!0,e.add_food=!0},e.eventLocations=function(){e.showLoc=!1,c.getEventlocations(e.currentval.event_code).then(function(t){1==t.result?(e.evtLoc=t.data,e.evtLoc.length>0&&(console.log(e.evtLoc),e.showLoc=!0)):e.showLoc=!1})},e.eventLocations(),e.locationClick=function(t){e.spoLocation=t.location,e.showLoclist=!1},e.isValidLoc=!1,e.locValidation=function(t){e.req=!1,e.isValidLoc=!1,e.isValidLoc=c.validateLocation(t)},e.reachEndDate=!1,e.fromCouponDay=function(){return function(t){if(void 0!=e.selectedDayinfo&&t.dayID>=e.selectedDayinfo.dayID){if(console.log(t),1!=e.isExhibitor)return t;if(t.dayID==e.selectedDayinfo.dayID&&(e.reachEndDate=!1),1==t.dayAvailableForCoupon&&0==e.reachEndDate)return console.log(t),t;e.reachEndDate=!0}}},e.Custtickets=[],e.custtickets=function(t){e.Custtickets.indexOf(t)>=0?e.Custtickets.splice(e.Custtickets.indexOf(t),1):e.Custtickets.push(t)},e.Custusers=[],e.custusers=function(t){e.Custusers.indexOf(t)>=0?e.Custusers.splice(e.Custusers.indexOf(t),1):e.Custusers.push(t),k("")},e.currentPage=0,e.pageSize=10,e.numberOfPages=function(){return void 0!=e.userlist?Math.ceil(e.userlist.length/e.pageSize):1};var k=function(t){"selected"==t||"selected"==e.filterlist?(e.currentPage=0,e.totalpages=Math.ceil(e.Custusers.length/e.pageSize)):"unselected"==t||"unselected"==e.filterlist?(e.currentPage=0,e.totalpages=Math.ceil((e.userlist.length-e.Custusers.length)/e.pageSize)):(e.currentPage=0,e.totalpages=e.numberOfPages())};e.genRandom=function(){var t=p(e.getUserCodes());t=t.splice(0,e.rVal),e.Custusers=t},e.getUserCodes=function(){for(var t=[],o=0;o<e.userlist.length;o++)t.push(e.userlist[o].user_code);return t},e.$watchCollection("[filterlist,Custusers]",function(e){k(e[0])}),e.filteruser=function(t){return"selected"==e.filterlist?e.Custusers.indexOf(t.user_code)>=0:"unselected"!=e.filterlist||!(e.Custusers.indexOf(t.user_code)>=0)},e.selectval=function(t){e.selval=t;var o=new Date(t);o.setHours(e.displaytime.getHours()),o.setMinutes(e.displaytime.getMinutes()),e.displaytime=o,e.time=d("date")(o,"hh:mm a")},e.EXselectval=function(t){e.EXselval=t;var o=new Date(t);o.setHours(e.expirytime.getHours()),o.setMinutes(e.expirytime.getMinutes()),e.expirytime=o,e.EXtime=d("date")(o,"hh:mm a")},e.errorScroll=function(){0!=e.isOnlineCoupon||void 0!=e.spoLocation&&""!=e.spoLocation&&null!=e.spoLocation?!e.CPform.$valid||void 0!=e.selectedDayinfo&&null!=e.selectedDayinfo&&""!=e.selectedDayinfo?e.CPform.$valid&&void 0!=e.selectedDayinfo&&null!=e.selectedDayinfo&&""!=e.selectedDayinfo&&e.isExpiry&&(void 0==e.eDateInfo||null==e.eDateInfo||""==e.eDateInfo)&&r(function(){o.scrollJquery("expiryid")},100):r(function(){o.scrollJquery("deliverytimeid")},100):r(function(){o.scrollJquery("locationid")},100),"users"==e.couponfor&&e.currentval.number_of_attendee<e.attende&&o.scrollJquery("attendeError"),"ticket"==e.couponfor&&e.Custtickets.length<=0&&o.scrollJquery("ticketError")},e.CustCoupon=function(){var t=1,o=null,a=null,n=null;e.existLocation="",e.isOnlineCoupon?(t=2,o=e.couponUrl,void 0!=e.couponCode&&(a=e.couponCode)):(n=e.spoLocation,e.existLocation=!1,e.showLoc&&angular.forEach(e.evtLoc,function(t,o){e.evtLoc[o].location.toLowerCase()===e.spoLocation.toLowerCase()&&(e.existLocation=!0,n=e.evtLoc[o].location_code)}));var i=!1;"all"==e.couponfor?(i=!0,e.Custtickets=[],e.attende=0):"ticket"==e.couponfor?e.attende=0:e.Custtickets=[];var r=null,u=null;void 0!=e.eDateInfo&&e.isExpiry?(r=e.eDateInfo.dayID,u=d("date")(e.Etime,"yyyy-MM-dd HH:mm")):(r=null,u=null),0==e.editCoupon?s({method:"POST",url:l.url+"/custom_coupon/",data:{event_code:e.currentval.event_code,name:e.CPname,coupon_type:t,description:e.CPdesc,display_time:d("date")(e.time,"yyyy-MM-dd HH:mm"),for_all:i,random:e.attende,tickets:e.Custtickets,expiry_time:u,is_location_exist:e.existLocation,location:n,coupon_url:o,coupon_url_code:a,expiry_day_id:r,display_day_id:e.selectedDayinfo.dayID}}).then(function(t){console.log(t),1==t.data.result?window.location="/event/coupon":0==t.data.result&&(e.errormsg=!0,e.showerror=t.data.message)},function(t){e.data={},console.log(t),e.errormsg=!0,(t.status==-1||null==t.data)&&0==v.online?e.showerror=c.errorMsg[0]:e.showerror=c.errorMsg[1]}):e.editCoupon&&s({method:"POST",url:l.url+"/custom_coupon_edit/",data:{event_code:e.currentval.event_code,opp:"edit",name:e.CPname,coupon_type:t,description:e.CPdesc,display_time:d("date")(e.time,"yyyy-MM-dd HH:mm"),for_all:i,random:e.attende,tickets:e.Custtickets,expiry_time:u,is_location_exist:e.existLocation,location:n,coupon_url:o,coupon_url_code:a,expiry_day_id:r,display_day_id:e.selectedDayinfo.dayID,coupon_code:e.couponId}}).then(function(t){console.log(t),1==t.data.result?window.location="/event/coupon":0==t.data.result&&(e.errormsg=!0,e.showerror=t.data.message)},function(t){e.data={},console.log(t),e.errormsg=!0,(t.status==-1||null==t.data)&&0==v.online?e.showerror=c.errorMsg[0]:e.showerror=c.errorMsg[1]})},$("textarea").each(function(){g(this)}).on("input",function(){g(this)})}]),app.controller("EventVoteController",["$scope","fileReader","YaraBaseUrl","$http","$location","$filter","APPService","GetDataService","$timeout","$document","$rootScope","$anchorScroll",function(e,t,o,a,n,i,r,s,l,d,c,u){function m(e){$(e).css({height:"auto","overflow-y":"hidden"}).height(e.scrollHeight)}e.dashboardsUrl=s.dashboardUrl(),e.headerTitle="Vote";var f=localStorage.getItem("selectedEventId");e.timeformat=localStorage.getItem("is_time_format_24"),"true"==e.timeformat?(e.is_time_format_24=!0,e.timeformaType="HH:mm"):(e.is_time_format_24=!1,e.timeformaType="hh:mm A"),e.locationHref=window.location.pathname,"Admin"==s.getPrivilege()?e.privilege=!0:e.privilege=!1,e.votesearch="",e.searchonvore=function(t){for(var o=0;o<t.options.length;o++)return(t.question.toLowerCase()+t.options[o].option.toLowerCase()).indexOf(e.votesearch)>=0},void 0===f||null===f?window.location.replace("/events"):(e.selevntdata=localStorage.getItem("selEventsData"),e.currentval=angular.fromJson(e.selevntdata),document.title="YARA - "+e.currentval.short_name+" - Vote"),e.setOffset=function(e,t){return s.userOffsetTime(e,t)};var v=e.setOffset(e.currentval.start_date,e.currentval.eo),p=e.setOffset(e.currentval.end_date,e.currentval.eo),g=i("date")(v,"yyyy-MM-dd"),y=i("date")(p,"yyyy-MM-dd");e.dayscount=r.dateDiffInDays(new Date(g),new Date(y)),e.dates=r.Dateslist(g,e.dayscount),e.days={},e.eventDaysInfo=[],angular.forEach(e.currentval.days,function(t,o){var a={dayID:e.currentval.days[o].dayID,dayTitle:e.currentval.days[o].dayTitle,dstOffset:e.currentval.days[o].dstOffset,isDayActive:e.currentval.days[o].is_day_active,endTime:e.setOffset(e.currentval.days[o].endTime,e.currentval.eo),startTime:e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),date:i("date")(e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),"yyyy-MM-dd")};e.eventDaysInfo.push(a)}),e.minTime=e.eventDaysInfo[0].startTime,e.time=e.eventDaysInfo[0].startTime,e.SelDate=e.eventDaysInfo[0].dayID,e.expday=e.eventDaysInfo[0].isDayActive,e.dbutton=e.eventDaysInfo.length-3,l(function(){$(".slider").length>0&&$(".slider").diyslider({width:"100%",height:"51px",minSlides:2,loop:!1,moveSlides:1})},100),e.dates=e.eventDaysInfo,e.voteBtn="Create",e.selectDate=function(t){console.log(e.voteData),$("#loading").show(),e.voteData=[],console.log(e.voteData),s.eventLocalTz({tz:e.currentval.event_timezone}).then(function(o){if(1==o.result)if(e.timeNow=e.setOffset(o.local_time_now,0),$(".timeline-event-day .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".subtitle").show(),""==t)e.subtitle=t,$(".subtitle").text("Select Event Day");else{if(e.SelDate=t.dayID,e.timeNow>t.startTime){var a=new Date(e.timeNow).setMinutes(e.timeNow.getMinutes()+5);a=new Date(a),"Update"==e.voteBtn?(e.minTime=a,e.time=e.setOffset(e.displayTime,e.currentval.eo)):(e.minTime=a,e.time=a)}else"Update"==e.voteBtn?(e.minTime=t.startTime,e.time=e.setOffset(e.displayTime,e.currentval.eo)):(e.minTime=t.startTime,e.time=t.startTime);e.expday=t.isDayActive,e.getVotes(),$(".subtitle").text(t.dayTitle),$(".tracktitle").text("Select Track")}})},e.selectDate(e.eventDaysInfo[0]),$(document).on("click",".timeline-event-day .primary_nav_wrap ul li",function(){$(".timeline-event-day img").removeClass(),$(".timeline-event-day img").addClass("caret02"),$(".timeline-event-day .primary_nav_wrap ul li ul").css({display:"list-item",color:"#000","z-index":100})}),d.on("click",function(e){var t=$(".timeline-event-day .primary_nav_wrap ul li");t===e.target||t.has(e.target).length||"none"==$(".subtitlesearch").css("display")||($(".timeline-event-day .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".timeline-event-day img").removeClass(),$(".timeline-event-day img").addClass("caret01"))}),e.voteData=[],e.Smart_delivery=!1,e.SD_show=!1,e.subtitle="",e.timeslots=[],e.time=moment().hours(0).minutes(0),e.changeSubtype=function(t){$(".subtype_dropdown .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".subtitle").show(),""==t?(e.subtitle=t,$(".subtitle").text("Select Event Day")):(e.subtitle=t,$(".subtitle").text(i("date")(t,"MMM dd, yyyy")),e.time=moment(t).hours(0).minutes(0))},$(document).on("click",".subtype_dropdown .primary_nav_wrap ul li",function(){$(".subtype_dropdown img").removeClass(),$(".subtype_dropdown img").addClass("caret02"),$(".subtype_dropdown .primary_nav_wrap ul li ul").css({display:"list-item",color:"#000","z-index":100})}),d.on("click",function(e){var t=$(".subtype_dropdown .primary_nav_wrap ul li");t===e.target||t.has(e.target).length||"none"==$(".subtitlesearch").css("display")||($(".subtype_dropdown .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".subtype_dropdown img").removeClass(),$(".subtype_dropdown img").addClass("caret01"))}),e.timeInminutes=function(e,t){var o=0,a=e.split(" ");if(void 0!=a[1])var n=a[1].split(":");if(void 0!=a[1]){var o=60*parseInt(n[0]);o+=parseInt(n[1]),o+=t}return o},e.getVotes=function(){e.voteData=[],"Update"==e.voteBtn&&1!=e.checkstatus||$("#loading").show(),s.getVote({day_id:e.SelDate,event_code:e.currentval.event_code}).then(function(t){1==t.result&&(e.voteData=t.votes,e.eo=t.eo,e.voteData.length>0&&angular.forEach(e.voteData,function(t,o){e.voteData[o].displayMinutes=e.timeInminutes(e.voteData[o].display_time,e.eo)}),console.log(e.voteData),l(function(){$(".progressbars").jprogress(),$(".progressbarsone").jprogress({background:"#FF2D55"}),$("#loading").hide(),$("#container").fadeIn()},500),e.checkstatus=!1)})},e.votecancel=function(){e.vote=e.errormsg=!1,u()},e.changepollQues=function(){e.errormsg=!1},e.checkDisplayTime=function(){console.log(e.time),e.createNewVote=!1;var t=e.timeInminutes(moment(e.time).format("YYYY-MM-DD HH:mm"),0);return angular.forEach(e.voteData,function(o,a){0==e.createNewVote&&"Create"==e.voteBtn?e.voteData[a].displayMinutes==t?e.createNewVote=!0:e.voteData[a].displayMinutes<t&&e.voteData[a].displayMinutes+30>t?e.createNewVote=!0:e.voteData[a].displayMinutes>t&&e.voteData[a].displayMinutes-30<t&&(e.createNewVote=!0):0==e.createNewVote&&e.voteData[a].vote_code!=e.vote_code&&(e.voteData[a].displayMinutes==t?e.createNewVote=!0:e.voteData[a].displayMinutes<t&&e.voteData[a].displayMinutes+30>t?e.createNewVote=!0:e.voteData[a].displayMinutes>t&&e.voteData[a].displayMinutes-30<t&&(e.createNewVote=!0))}),e.createNewVote},e.removeVoteInfo=function(t){e.removeVote=t,console.log(t)},e.deleteVote=function(){a({method:"POST",url:o.url+"/vote_edit/",data:{vote_code:e.removeVote.vote_code,day_id:e.removeVote.day_id,opp:"delete"}}).then(function(t){1==t.data.result?($("#myModal-vote").modal("hide"),$("#loading").modal("hide"),$("#container").fadeIn(),e.getVotes()):0==t.data.result&&(e.errormsg=!0,e.showerror=t.data.message,$("#myModal-vote").modal("hide"))},function(t){e.data={},console.log(t),e.errormsg=!0,(t.status==-1||null==t.data)&&0==c.online?e.showerror=s.errorMsg[0]:e.showerror=s.errorMsg[1]})},e.duplicates=[],e.checkVote=function(){e.duplicateVote=!1;var t=[];angular.forEach(e.vote_scope.optarray,function(o,a){if(console.log(e.vote_scope.optarray[a]),void 0!=e.vote_scope.optarray[a]&&""!=e.vote_scope.optarray[a]&&null!=e.vote_scope.optarray[a]){var n={vote:e.vote_scope.optarray[a],key:a};t.push(n),e.duplicates[a]=!1}}),t=t.sort(function(e,t){var o=e.vote.toLowerCase(),a=t.vote.toLowerCase();return o<a?-1:o>a?1:0});for(var o=t,a=0;a<t.length-1;a++)o[a+1].vote.toLowerCase()==o[a].vote.toLowerCase()&&(e.duplicates[o[a+1].key]=!0,e.duplicateVote=!0)},e.createVote=function(){e.vote=!0,e.voteBtn="Create",e.pollQues="",e.displayTime="",e.duplicateVote=!1,e.duplicates=[],e.vote_scope.optarray=[],setTimeout(function(){$("#voteId").focus()},1e3),u(),$("textarea").each(function(){m(this)})},e.editVote=function(t){e.voteBtn="Update",e.vote=!0,e.duplicateVote=!1,e.duplicates=[],e.vote_code=t.vote_code,e.displayTime=t.display_time,e.pollQues=t.question,e.SelDate=t.day_id,angular.forEach(e.eventDaysInfo,function(o,a){e.eventDaysInfo[a].dayID==t.day_id&&e.selectDate(e.eventDaysInfo[a])}),e.vote_scope.optarray=[],angular.forEach(t.options,function(o,a){e.vote_scope.optarray.push(t.options[a].option)}),e.time=e.setOffset(t.display_time,e.eo),l(function(){$("textarea").each(function(){m(this)})},100)},e.getVotes(),e.vote_scope=e,e.vote_scope.optarray=[],e.optRequired=!0,e.$watch("vote_scope.optarray",function(t){if(console.log(t),t.length>0){var o=0;angular.forEach(t,function(e){void 0!=e&&""!=e&&null!=e&&o++}),e.optRequired=!(o>=3)}else e.optRequired=!0},!0),e.addopt=function(){e.opt=e.opt+1,e.optarray.push(e.opt)},e.errorScroll=function(){e.duplicateVote&&r.scrollJquery("optionRepeat"),e.voteform.$valid&&e.optRequired&&r.scrollJquery("optionError")},e.addpoll=function(t){e.checkstatus=!0,console.log(e.SelDate),e.optvalues=[],angular.forEach(e.vote_scope.optarray,function(t){void 0!=t&&""!=t&&null!=t&&e.optvalues.push(t)}),e.displaytime="","time"==e.Dtype&&(console.log(e.time),e.displaytime=i("date")(e.time,"yyyy-MM-dd HH:mm")),"Create"==e.voteBtn?a({method:"POST",url:o.url+"/vote/",data:{event_code:e.currentval.event_code,question:e.pollQues,options:e.optvalues,display_time:moment(e.time).format("YYYY-MM-DD HH:mm"),day_id:e.SelDate}}).then(function(t){console.log(t),1==t.data.result?(e.pollQues="",e.submitted=!1,e.optvalues=[],e.vote_scope.optarray=[],e.vote=!1,e.getVotes()):0==t.data.result&&(e.errormsg=!0,e.showerror=t.data.message)},function(t){e.data={},console.log(t),e.errormsg=!0,(t.status==-1||null==t.data)&&0==c.online?e.showerror=s.errorMsg[0]:e.showerror=s.errorMsg[1]}):"Update"==e.voteBtn&&a({method:"POST",url:o.url+"/vote_edit/",data:{question:e.pollQues,options:e.optvalues,display_time:moment(e.time).format("YYYY-MM-DD HH:mm"),day_id:e.SelDate,vote_code:e.vote_code,opp:"edit"}}).then(function(t){1==t.data.result?(e.pollQues="",e.submitted=!1,e.optvalues=[],e.vote_scope.optarray=[],e.vote=!1,e.getVotes()):0==t.data.result&&(e.errormsg=!0,e.showerror=t.data.message)})},$("textarea").each(function(){m(this)}).on("input",function(){m(this)}),0==c.online&&alert("You are not connected to internet")}]),app.filter("startFrom",function(){return function(e,t){return void 0==e||(t=+t,e.slice(t))}}),app.controller("TimelineController",["$scope","fileReader","YaraBaseUrl","$http","$location","$filter","APPService","GetDataService","$mdpDatePicker","$mdpTimePicker","$interval","$timeout","$rootScope","$anchorScroll",function(e,t,o,a,n,i,r,s,l,d,c,u,m,f){e.dashboardsUrl=s.dashboardUrl(),e.headerTitle="Schedule";var v=localStorage.getItem("selectedEventId");e.timeformat=localStorage.getItem("is_time_format_24"),"true"==e.timeformat?e.is_time_format_24=!0:e.is_time_format_24=!1,void 0!==v&&null!==v||window.location.replace("/events"),e.selevntdata=localStorage.getItem("selEventsData"),e.currentval=angular.fromJson(e.selevntdata),e.checkdate=function(e,t,o){return s.startend(e,t,o)},localStorage.removeItem("sessId"),localStorage.removeItem("editSession"),e.setTitle=function(t){document.title="YARA - "+e.currentval.short_name+" - "+t},e.setOffset=function(e,t){return s.userOffsetTime(e,t)},e.getLocaltime=function(){s.eventLocalTz({tz:e.currentval.event_timezone}).then(function(t){1==t.result&&(e.localTimeNow=t.local_time_now)})},e.getLocaltime();var p=e.setOffset(e.currentval.start_date,e.currentval.eo),g=e.setOffset(e.currentval.end_date,e.currentval.eo),y=i("date")(p,"yyyy-MM-dd"),h=i("date")(g,"yyyy-MM-dd");e.dayscount=r.dateDiffInDays(new Date(y),new Date(h)),e.dates=r.Dateslist(y,e.dayscount),e.days={},e.eventDaysInfo=[],angular.forEach(e.currentval.days,function(t,o){var a={dayID:e.currentval.days[o].dayID,dayTitle:e.currentval.days[o].dayTitle,dstOffset:e.currentval.days[o].dstOffset,is_day_active:e.currentval.days[o].is_day_active,endTime:e.setOffset(e.currentval.days[o].endTime,e.currentval.eo),startTime:e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),date:i("date")(e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),"yyyy-MM-dd")};e.eventDaysInfo.push(a)}),e.dbutton=e.eventDaysInfo.length-3,u(function(){$(".slider").length>0&&$(".slider").diyslider({width:"100%",height:"51px",minSlides:2,loop:!1,moveSlides:1})},100),e.setDayInfo=function(){angular.forEach(e.dates,function(t){angular.forEach(e.eventDaysInfo,function(o,a){t==e.eventDaysInfo[a].date&&(e.days[t]=e.eventDaysInfo[a])})})},e.setDayInfo(),e.dates={},e.dayscount=Object.keys(e.currentval.days).length;var _=r.Dateslist(y,e.dayscount);if(e.service=r,angular.forEach(_,function(t){e.dates[t]=e.currentval.days[t]}),e.sessionData=[],e.exScope=e,e.listallSessions=function(){$("#loading").show();var t={bs:1,event_code:e.currentval.event_code};s.getallSessions(t).then(function(t){if(e.sessionList=[],1==t.result){e.eo=t.eo;var o=t.sessions;angular.forEach(o,function(t,a){if(1==o[a].session_type){var n={created_at:o[a].created_at,created_by:o[a].created_by,day_id:o[a].day_id,description:o[a].description,end_time:o[a].end_time,eo:o[a].eo,file_bank:o[a].file_bank,is_speaker_engage:o[a].is_speaker_engage,like_count:o[a].like_count,location:o[a].location,session_code:o[a].session_code,session_type:o[a].session_type,speakers:o[a].speakers,sponsors:o[a].sponsors,start_time:o[a].start_time,tittle:o[a].tittle,is_started:o[a].is_started,track:o[a].track,uploaded_file_size:o[a].uploaded_file_size,sDate:i("date")(e.setOffset(o[a].start_time,e.currentval.eo),"EEEE,  MMMM d  y"),timeFrom:e.is_time_format_24?i("date")(e.setOffset(o[a].start_time,e.currentval.eo),"H:mm"):i("date")(e.setOffset(o[a].start_time,e.currentval.eo),"h:mm a"),timeTo:e.is_time_format_24?i("date")(e.setOffset(o[a].end_time,e.currentval.eo),"H:mm"):i("date")(e.setOffset(o[a].end_time,e.currentval.eo),"h:mm a")};e.sessionList.push(n)}else{var n={created_at:o[a].created_at,created_by:o[a].created_by,day_id:o[a].day_id,end_time:o[a].end_time,include_coupon:o[a].include_coupon,location:o[a].location,session_code:o[a].session_code,session_type:o[a].session_type,speakers:o[a].speakers,sponsors:o[a].sponsors,start_time:o[a].start_time,tittle:o[a].tittle,is_started:o[a].is_started,sDate:i("date")(e.setOffset(o[a].start_time,e.currentval.eo),"EEEE,  MMMM d  y"),timeFrom:e.is_time_format_24?i("date")(e.setOffset(o[a].start_time,e.currentval.eo),"H:mm"):i("date")(e.setOffset(o[a].start_time,e.currentval.eo),"h:mm a"),timeTo:e.is_time_format_24?i("date")(e.setOffset(o[a].end_time,e.currentval.eo),"H:mm"):i("date")(e.setOffset(o[a].end_time,e.currentval.eo),"h:mm a")};e.sessionList.push(n)}}),$("#loading").hide(),$("#container").fadeIn()}})},e.listallSessions(),e.sort="",e.sorting=function(t){0==t?(e.sort="",f()):(e.sort="tittle",f())},e.popUp=function(t,o){e.sessionInfo=t,e.sType=o},e.sessiondelete=function(t,o,a){e.sessioncode=t,e.sessiontype=o,e.sessiontitle=a},e.breaksession=function(t,o,a){e.sessioncode=t,e.sessiontype=o,e.sessiontitle=a},e.removeSession=function(){1==e.sessiontype?($("#loading").show(),a({method:"POST",url:o.url+"/session_edit/",data:{session_code:e.sessioncode,opp:"Delete"}}).then(function(t){console.log(t),1==t.data.result?($("#schedule-revoke").modal("hide"),e.listallSessions(),$("#loading").hide(),$("#container").fadeIn()):t.data.result},function(t){e.data={},e.errormsg=!0,(t.status==-1||null==t.data)&&0==m.online?e.showerror=s.errorMsg[0]:e.showerror=s.errorMsg[1]})):0==e.sessiontype&&($("#loading").show(),a({method:"POST",url:o.url+"/break_session_edit/",data:{session_code:e.sessioncode,opp:"Delete"}}).then(function(t){1==t.data.result?($("#loading").hide(),$("#container").fadeIn(),e.listallSessions(),$("#schedule-revoke").modal("hide")):t.data.result},function(t){e.data={},e.errormsg=!0,(t.status==-1||null==t.data)&&0==m.online?e.showerror=s.errorMsg[0]:e.showerror=s.errorMsg[1]}),$("#loading").hide(),$("#container").fadeIn())},e.selecttab=function(t){$("#loading").show(),e.seltab=t.dayID,e.expday=t.is_day_active,localStorage.setItem("eventdayid",JSON.stringify(t)),u(function(){$("#loading").hide(),$("#container").fadeIn()},1500)},e.hideLoading=function(){},void 0!=localStorage.getItem("eventdayid")){var w=JSON.parse(localStorage.getItem("eventdayid"));e.seldat=!1;for(var I=0;I<e.eventDaysInfo.length;I++)e.eventDaysInfo[I].dayID==w.dayID&&(e.selecttab(w),e.seldat=!0,e.movebutton=I);u(function(){if(e.ddbt=e.movebutton+1,e.ddbt>3){e.forl=e.ddbt-3
;for(var t=0;t<e.forl;t++)$(".slider").diyslider("move","forth"),e.dbutton--}},100),(e.seldat=!1)&&(e.seltab=e.eventDaysInfo[0].dayID,e.expday=e.eventDaysInfo[0].is_day_active)}else e.seltab=e.eventDaysInfo[0].dayID,e.expday=e.eventDaysInfo[0].is_day_active,localStorage.setItem("eventdayid",JSON.stringify(e.eventDaysInfo[0]));e.editSessionInfo=function(e,t){localStorage.setItem("sessId",e.session_code),localStorage.setItem("editSession",!0),1==t?(localStorage.setItem("session",!0),window.location="/event/schedule-session"):0==t&&(localStorage.setItem("bsession",!0),window.location="/event/schedule-break-session")},e.getTracks=function(){s.getTracks().then(function(t){1==t.result&&(e.tracks=t.tracks)})},e.sessionAdd=function(e){1==e?(localStorage.removeItem("bsession"),localStorage.setItem("session",!0),window.location="/event/schedule-session"):(localStorage.removeItem("session"),localStorage.setItem("bsession",!0),window.location="/event/schedule-break-session")},e.getTickets=function(){s.getTickets(e.currentval.event_code).then(function(t){1==t.result&&(e.ticketsdata=t.tickets,e.firsTicketname=e.ticketsdata[0].name)})},e.getTickets(),0==m.online&&alert("You are not connected to internet")}]),app.controller("CreateTimelineCtrl",["$scope","fileReader","YaraBaseUrl","$http","$location","$filter","APPService","GetDataService","$mdpTimePicker","$interval","$timeout","$document","$rootScope",function(e,t,o,a,n,i,r,s,l,d,c,u,m){void 0==localStorage.getItem("session")&&(window.location="/events");var f=localStorage.getItem("selectedEventId");void 0!==f&&null!==f||window.location.replace("/events"),e.selevntdata=localStorage.getItem("selEventsData"),e.currentval=angular.fromJson(e.selevntdata),e.btnName="Add Session",e.timeformat=localStorage.getItem("is_time_format_24"),"true"==e.timeformat?(e.is_time_format_24=!0,e.timeformaType="HH:mm"):(e.is_time_format_24=!1,e.timeformaType="hh:mm A"),e.setOffset=function(e,t){return s.userOffsetTime(e,t)},e.specPeople=e.currentval.sp_people,e.convertingPeoplelist=e.specPeople,document.title="YARA - "+e.currentval.short_name+" - Schedule";var v=e.setOffset(e.currentval.start_date,e.currentval.eo),p=e.setOffset(e.currentval.end_date,e.currentval.eo),g=i("date")(v,"yyyy-MM-dd");i("date")(p,"yyyy-MM-dd");e.dates={},e.dayscount=Object.keys(e.currentval.days).length;var y=r.Dateslist(g,e.dayscount);e.service=r,e.speakerEngage=!1,e.notimeDiff=!1,e.showTime=!1,e.eventDaysInfo=[],angular.forEach(e.currentval.days,function(t,o){var a={dayID:e.currentval.days[o].dayID,dayTitle:e.currentval.days[o].dayTitle,dstOffset:e.currentval.days[o].dstOffset,endTime:e.setOffset(e.currentval.days[o].endTime,e.currentval.eo),startTime:e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),date:i("date")(e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),"yyyy-MM-dd")};e.eventDaysInfo.push(a)}),angular.forEach(y,function(t){angular.forEach(e.eventDaysInfo,function(o,a){t==e.eventDaysInfo[a].date&&(e.dates[t]=e.eventDaysInfo[a])})});var h,_;angular.forEach(e.currentval.days,function(t,o){e.currentval.start_date==e.currentval.days[o].startTime&&(h=e.currentval.days[o].startTime,_=e.currentval.days[o].endTime)}),e.EvtStart=e.setOffset(h,e.currentval.eo),e.EvtEnd=e.setOffset(_,e.currentval.eo),e.subtitle="",e.tracktitle="",e.trackSelected=!1,e.changeTrack=function(t){$(".timeline-event-track .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".tracktitle").show(),""==t?(e.tracktitle=t,$(".tracktitle").text("Select Track")):(e.tracktitle=t.track_code,e.trackInfo=t,e.trackSelected=!0,$(".tracktitle").text(t.name))},$(document).on("click",".timeline-event-track .primary_nav_wrap ul li",function(){$(".timeline-event-track img").removeClass(),$(".timeline-event-track img").addClass("caret02"),$(".timeline-event-track .primary_nav_wrap ul li ul").css({display:"list-item",color:"#000","z-index":100})}),u.on("click",function(e){var t=$(".timeline-event-track .primary_nav_wrap ul li");t===e.target||t.has(e.target).length||($(".timeline-event-track .primary_nav_wrap ul li ul").hide({display:"none",color:"#333",background:"#333","z-index":100}),$(".timeline-event-track img").removeClass(),$(".timeline-event-track img").addClass("caret01"))}),e.changeSponser=function(t){$(".timeline-event-sponser .primary_nav_wrap ul li ul").hide({display:"none",color:"#333",background:"#333","z-index":100}),$(".sponsertitle").show(),""==t?(e.sponsertitle=t,$(".sponsertitle").text("Select sponser")):(e.sponsertitle=t.sponsor_code,e.sponserInfo=t,console.log(t.name),c(function(){$(".sponsertitle").text(t.name).addClass("color-black")},50))},$(document).on("click",".timeline-event-sponser .primary_nav_wrap ul li",function(){$(".timeline-event-sponser img").removeClass(),$(".timeline-event-sponser img").addClass("caret02"),$(".timeline-event-sponser .primary_nav_wrap ul li ul").css({display:"list-item",color:"#333","z-index":100})}),u.on("click",function(e){var t=$(".timeline-event-sponser .primary_nav_wrap ul li");t===e.target||t.has(e.target).length||($(".timeline-event-sponser .primary_nav_wrap ul li ul").hide({display:"none",color:"#333","z-index":100}),$(".timeline-event-sponser img").removeClass(),$(".timeline-event-sponser img").addClass("caret01"))}),e.noSpeaker=!0,e.selectspeaker=function(t,o){e.noSpeaker=!1,$("#loading").show();var a={item:"sp",day_id:t,track_code:o};s.eventDayAccessories(a).then(function(t){if(1==t.result){$("#loading").hide(),$("#container").fadeIn(),e.SpkData=t.sp_data;var o=[];if(0==e.SpkData.length&&(e.noSpeaker=!0),e.addedSpeker=[],"true"==localStorage.getItem("editSession")&&void 0!=e.editSessInfo&&e.SpkData.length>0){angular.forEach(e.SpkData,function(t,a){angular.forEach(e.editSessInfo.speakers,function(t,n){e.editSessInfo.speakers[n].speaker_code==e.SpkData[a].delegate_code&&(e.addedSpeker.push(e.SpkData[a]),o.push(a))})});for(var a=o.length-1;a>=0;a--)e.SpkData.splice(o[a],1)}}})},e.changeSubtype=function(t){if($(".timeline-event-day .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".subtitle").show(),""==t)e.subtitle=t,$(".subtitle").text("Select Event Day");else{e.showTime=!0,e.selectedDayinfo=t,e.subtitle=t.dayTitle,e.EvtEnd=e.setOffset(t.endTime,e.currentval.eo);var o=e.setOffset(t.startTime,e.currentval.eo),a=e.setOffset(e.localTimeNow,0);if(o<a){var n=new Date(a).setMinutes(a.getMinutes()+5);n=new Date(n),n<e.EvtEnd?(e.starttime=e.Bstarttime=n,e.EvtStart=n):(e.starttime=e.Bstarttime=a,e.EvtStart=a)}else e.starttime=e.Bstarttime=o,e.EvtStart=o;e.endtime=e.Bendtime=e.setOffset(t.endTime,e.currentval.eo),$(".subtitle").text(t.dayTitle),e.sessionform.starttime.$untouched=!1,e.sessionform.endtime.$untouched=!1}},$(document).on("click",".timeline-event-day .primary_nav_wrap ul li",function(){$(".timeline-event-day img").removeClass(),$(".timeline-event-day img").addClass("caret02"),$(".timeline-event-day .primary_nav_wrap ul li ul").css({display:"list-item",color:"#000","z-index":100})}),u.on("click",function(e){var t=$(".timeline-event-day .primary_nav_wrap ul li");t===e.target||t.has(e.target).length||"none"==$(".subtitlesearch").css("display")||($(".timeline-event-day .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".timeline-event-day img").removeClass(),$(".timeline-event-day img").addClass("caret01"))}),e.addtrack=function(t){e.invalidTrack=!1;var n=/^track[1-9][0-9]*$/,i=/^track[^a-zA-Z0-9][0-9][0-9]*$/,r=e.trackname.toLowerCase();if("track"==e.trackname.toLowerCase()?(e.invalidTrack=!0,$("#loading").hide(),$("#container").fadeIn()):(n.test(r)||i.test(r))&&(e.invalidTrack=!0,$("#loading").hide(),$("#container").fadeIn()),0==e.invalidTrack){var l=[];l.push(e.trackname),a({method:"POST",url:o.url+"/track/",data:{event_code:e.currentval.event_code,name:l,track_based:1}}).then(function(t){e.trackdata=t.data,1==e.trackdata.result?(e.trackname="",e.SelDaysTrack=[],e.getTracks(e.eventDaysInfo[0].dayID),$("#add-new-track").modal("hide")):0==e.trackdata.result?(e.errormsgtrack=!0,e.errdata=e.trackdata.message,e.already_exist=!0):(e.errormsgtrack=!0,e.data.error=s.errorMsg[1])},function(t){e.trackdata={},e.errormsgtrack=!0,t.status==-1||null==t.data?(e.trackdata.error=s.errorMsg[0],0==m.online?e.trackdata.error=s.errorMsg[0]:e.trackdata.error=s.errorMsg[1]):e.trackdata.error=s.errorMsg[1]})}},e.addSession=function(){var t=[];angular.forEach(e.addedSpeker,function(o,a){t.push(e.addedSpeker[a].delegate_code)}),e.existLocation=0,e.showLoc&&angular.forEach(e.evtLoc,function(t,o){e.evtLoc[o].location.toLowerCase()===e.spoLocation.toLowerCase()&&(e.existLocation=1,e.locationCode=e.evtLoc[o].location_code)});var n=e.spoLocation;1==e.existLocation&&(n=e.locationCode);var i=!1;1==e.speakerEngage&&(i=!0);var r,l=[];void 0!=e.sponserInfo&&(r=e.sponserInfo.sponsor_code,l.push(r)),"true"==localStorage.getItem("editSession")?a({method:"POST",url:o.url+"/session_edit/",data:{event_code:e.currentval.event_code,tittle:e.stitle,speakers:t,track:e.trackInfo.track_code,location:n,is_location_exist:e.existLocation,start_time:moment(e.starttime).format("YYYY-MM-DD HH:mm"),end_time:moment(e.endtime).format("YYYY-MM-DD HH:mm"),description:e.sDesc,sponsors:l,speaker_engage:i,session_code:e.editSessInfo.session_code,day_id:e.selectedDayinfo.dayID,opp:"Edit"}}).then(function(t){1==t.data.result?(localStorage.removeItem("bsession"),localStorage.removeItem("session"),window.location="/event/schedule"):0==t.data.result&&(e.errormsg=!0,e.showerror=t.data.message,$("#loading").hide(),$("#container").fadeIn())},function(t){e.data={},console.log(t),e.errormsg=!0,$("#loading").hide(),$("#container").fadeIn(),(t.status==-1||null==t.data)&&0==m.online?e.showerror=s.errorMsg[0]:e.showerror=s.errorMsg[1]}):a({method:"POST",url:o.url+"/session/",data:{event_code:e.currentval.event_code,tittle:e.stitle,speakers:t,track:e.trackInfo.track_code,location:n,is_location_exist:e.existLocation,start_time:moment(e.starttime).format("YYYY-MM-DD HH:mm"),end_time:moment(e.endtime).format("YYYY-MM-DD HH:mm"),description:e.sDesc,sponsors:l,speaker_engage:i,day_id:e.selectedDayinfo.dayID}}).then(function(t){console.log(t),1==t.data.result?(localStorage.removeItem("bsession"),localStorage.removeItem("session"),window.location="/event/schedule",localStorage.setItem("tabcode",e.selectedDayinfo.dayID)):0==t.data.result&&(e.errormsg=!0,e.showerror=t.data.message,$("#loading").hide(),$("#container").fadeIn())},function(t){e.data={},e.errormsg=!0,$("#loading").hide(),$("#container").fadeIn(),(t.status==-1||null==t.data)&&0==m.online?e.showerror=s.errorMsg[0]:e.showerror=s.errorMsg[1]})},e.getSponsor=function(){s.getSponsors(e.currentval.event_code).then(function(t){if(1==t.result&&(e.SPdata=t.data,console.log(e.SPdata),"true"==localStorage.getItem("editSession")&&void 0!=e.editSessInfo))for(var o=e.SPdata.length-1;o>=0;o--)if(e.editSessInfo.sponsors[0].sponsor_code==e.SPdata[o].sponsor_code){e.changeSponser(e.SPdata[o]);break}})},e.locationClick=function(t){console.log(t),e.spoLocation=t.location,e.showLoclist=!1},e.isValidLoc=!1,e.locValidation=function(t){e.req=!1,e.isValidLoc=!1,e.isValidLoc=s.validateLocation(t)},e.eventLocations=function(){e.showLoc=!1,s.getEventlocations(e.currentval.event_code).then(function(t){1==t.result?(e.evtLoc=t.data,e.evtLoc.length>0&&(e.showLoc=!0,"true"==localStorage.getItem("editSession")&&void 0!=e.editSessInfo&&angular.forEach(e.evtLoc,function(t,o){e.editSessInfo.location.location_code==e.evtLoc[o].location_code&&(e.locationClick(e.evtLoc[o]),e.starttime=e.setOffset(e.editSessInfo.start_time,e.currentval.eo),e.endtime=e.setOffset(e.editSessInfo.end_time,e.currentval.eo))}))):e.showLoc=!1})},e.getTracks=function(){s.getTracks(e.currentval.event_code).then(function(t){1==t.result&&(e.tracks=t.tracks,"true"==localStorage.getItem("editSession")&&void 0!=e.editSessInfo&&angular.forEach(e.tracks,function(t,o){e.editSessInfo.track.track_code==e.tracks[o].track_code&&e.changeTrack(e.tracks[o])}))})},e.addedSpeker=[],e.speakerAdd=function(t,o){e.showSp=!1,e.addedSpeker.push(t),e.SpkData.splice(o,1)},e.removeSpeaker=function(t,o){e.SpkData.push(t),e.addedSpeker.splice(o,1)},e.errorScroll=function(){$("#loading").show(),0==e.addedSpeker.length&&e.sessionform.$valid?r.scrollJquery("speaker_id"):""==e.subtitle&&r.scrollJquery("subtitleerr")},e.displayError=function(){e.submitted=!0,$("#loading").hide(),$("#container").fadeIn()},e.speakertitle="",e.SelSpeaker=[],e.addSpeaker=function(){var e={delegate:!1,speaker:!0,bulk:!1};localStorage.setItem("redirectionInfo",angular.toJson(e)),sessionStorage.setItem("redirect","/event/schedule-session"),window.location.replace("/event/add-speaker")},e.dstapp=!1,e.$watchCollection("[starttime,endtime]",function(t){var o=Math.round(new Date(e.starttime).getTime()/1e3),a=e.currentval.latitude,n=e.currentval.longitude,i="https://maps.googleapis.com/maps/api/timezone/json?location="+a+","+n+"&timestamp="+o+"&key=AIzaSyDtW9biEk-bn7LFG-l9yO1ilKLLhRRv8Oo";$.getJSON(i,function(t){console.log(t),0!=t.dstOffset&&void 0!=t.dstOffset&&(e.dstapp=!0)})}),e.$watchCollection("[selectedDayinfo,trackInfo]",function(t){console.log(e.selectedDayinfo),console.log(e.trackInfo),void 0!=e.selectedDayinfo&&void 0!=e.trackInfo&&e.selectspeaker(e.selectedDayinfo.dayID,e.trackInfo.track_code)}),e.$watchCollection("[selectedDayinfo,starttime,endtime,spoLocation,stitle,addedSpeker.length,trackInfo]",function(t){if(e.notimeDiff=!1,e.notimeDiff1=!1,e.endtime>e.EvtEnd&&(e.endtime=e.EvtEnd),void 0!=e.selectedDayinfo&&0==e.sessionform.starttime.$untouched&&0==e.sessionform.endtime.$untouched)if(e.starttime.getHours()==e.endtime.getHours()){var n=e.endtime.getMinutes()-e.starttime.getMinutes();n<0?e.notimeDiff1=!0:n<5&&n>=0&&(e.notimeDiff=!0)}else e.starttime.getHours()>e.endtime.getHours()&&(e.notimeDiff1=!0);e.locationExist=0,e.locCode="",void 0!=e.spoLocation&&angular.forEach(e.evtLoc,function(t,o){e.evtLoc[o].location.toLowerCase()===e.spoLocation.toLowerCase()&&(e.locationExist=1,e.locCode=e.evtLoc[o].location_code)});var l=[];if(angular.forEach(e.addedSpeker,function(t,o){l.push(e.addedSpeker[o].delegate_code)}),void 0!=e.selectedDayinfo&&0==e.sessionform.starttime.$untouched&&0==e.sessionform.endtime.$untouched&&void 0!=e.stitle&&void 0!=e.trackInfo&&e.addedSpeker.length>0){if($("#loading").show(),"true"==localStorage.getItem("editSession"))var d=Number(localStorage.getItem("sessId"));else var d=localStorage.getItem("sessId");e.pastTime=0,e.sessionSttime=i("date")(e.starttime,"hh:mm a"),e.sessionEndtime=i("date")(e.endtime,"hh:mm a"),a({method:"POST",url:o.url+"/location_validate/",data:{event_code:e.currentval.event_code,session_name:e.stitle.toLowerCase(),location_code:e.locCode,start_time:moment(e.starttime).format("YYYY-MM-DD HH:mm"),end_time:moment(e.endtime).format("YYYY-MM-DD HH:mm"),for:"Session",speaker_code:l,track_code:e.trackInfo.track_code,session_code:d,day_id:e.selectedDayinfo.dayID}}).then(function(t){$("#loading").hide(),$("#container").fadeIn(),1==t.data.result?(e.speakers_conflict=t.data.speakers_conflict,e.location_conflicts=t.data.location_conflicts,e.session_duplicate=t.data.session_duplicate,e.pastTime=t.data.time_conflict,c(function(){e.location_conflicts.length>0?r.scrollJquery("locationdupe_id"):1==e.session_duplicate&&r.scrollJquery("sessiondupe_id")},300)):0==t.data.result&&(e.speakers_conflict=t.data.speakers_conflict,e.location_conflicts=t.data.location_conflicts,e.session_duplicate=t.data.session_duplicate,e.pastTime=t.data.time_conflict,e.showerror=t.data.message,c(function(){1==e.pastTime?r.scrollJquery("timesec"):1==e.session_duplicate?r.scrollJquery("sessiondupe_id"):void 0!=e.location_conflicts&&e.location_conflicts.length>0&&r.scrollJquery("locationdupe_id")},300))},function(t){e.data={},e.errormsg=!0,(t.status==-1||null==t.data)&&0==m.online?e.showerror=s.errorMsg[0]:e.showerror=s.errorMsg[1]})}}),$(window).click(function(){1==e.showLoclist&&(e.showLoclist=!1,$("#locationdropdown").hide()),1==e.showSp&&(e.showSp=!1,$("#speakerdropdown").hide())}),$("#location_id").click(function(e){e.stopPropagation(),$("#locationdropdown").show()}),$("#locationinputid").on("input",function(){$("#locationdropdown").show()}),$("#speakerid").click(function(e){e.stopPropagation(),$("#speakerdropdown").show()}),$("#speakerinputid").on("input",function(){$("#speakerdropdown").show()}),e.cancelSessionCreation=function(){localStorage.removeItem("bsession"),localStorage.removeItem("session"),window.location="/event/schedule"},e.addSponser=function(){window.location="/event/sponsor"},e.getSessionRequirements=function(){s.eventLocalTz({tz:e.currentval.event_timezone}).then(function(t){$("#loading").show(),1==t.result&&(e.localTimeNow=t.local_time_now,s.getTracks(e.currentval.event_code).then(function(t){if(1==t.result){if(e.tracks=t.tracks,e.dateset=JSON.parse(localStorage.getItem("eventdayid")),null!=e.dateset&&void 0!=e.dateset||(window.location="/event/schedule"),"true"==localStorage.getItem("editSession")){var o={session_code:localStorage.getItem("sessId"),event_code:e.currentval.event_code};s.getSessionInfo(o).then(function(t){1==t.result&&(e.editSessInfo=t.sessions[0],e.stitle=e.editSessInfo.tittle,e.sDesc=e.editSessInfo.description,e.speakerEngage=e.editSessInfo.is_speaker_engage,window.setTimeout(function(){$("textarea").height($("textarea")[0].scrollHeight)},500),angular.forEach(e.currentval.days,function(t,o){e.currentval.days[o].dayID==e.editSessInfo.day_id&&e.changeSubtype(e.currentval.days[o])}),angular.forEach(e.tracks,function(t,o){e.editSessInfo.track.track_code==e.tracks[o].track_code&&(console.log(e.editSessInfo.track.track_code),console.log(e.tracks[o].track_code),e.changeTrack(e.tracks[o]))}),e.eventLocations(),e.getSponsor(),e.btnName="Update Session")})}else angular.forEach(e.currentval.days,function(t,o){e.currentval.days[o].dayID==e.dateset.dayID&&e.changeSubtype(e.currentval.days[o])}),e.eventLocations(),e.getSponsor();$("#loading").hide(),$("#container").fadeIn()}}))})},e.getSessionRequirements(),0==m.online&&alert("You are not connected to internet")}]),app.controller("SaveNewEventController",["$scope","fileReader","YaraBaseUrl","$http","$location","$filter","APPService","GetDataService","$mdpTimePicker","$interval","$timeout","NgMap","$rootScope",function(e,t,o,a,n,i,r,s,l,d,c,u,m){e.epData=angular.fromJson(localStorage.getItem("epData")),null==e.epData&&(window.location="/events");var f=angular.fromJson(localStorage.getItem("redirectionInfo"));(f.locPlace||f.locManual)&&f.eventDetails&&f.eventInfo&&!f.eventConfirm||(window.location="/dashboard"),e.timeformat=localStorage.getItem("is_time_format_24"),"true"==e.timeformat?(e.is_time_format_24=!0,e.timeformaType="HH:mm"):(e.is_time_format_24=!1,e.timeformaType="hh:mm A"),e.editEventDetails=function(e){"location"==e?(f.locPlace&&(f.editlocPlace=!0,localStorage.setItem("redirectionInfo",JSON.stringify(f)),window.location="/create-event-location"),f.locManual&&(f.locmanualPlace=!0,localStorage.setItem("redirectionInfo",JSON.stringify(f)),window.location="/create-event-set-location-manually")):"info"==e?f.eventInfo&&(f.editeventInfo=!0,localStorage.setItem("redirectionInfo",JSON.stringify(f)),window.location="/create-event-info"):"details"==e&&f.eventDetails&&(f.editeventDetails=!0,localStorage.setItem("redirectionInfo",JSON.stringify(f)),window.location="/create-event-details")},e.eventInformation=[];var v,p=window.indexedDB.open("yaraDB9.db",1);p.onsuccess=function(t){v=t.target.result,e.getAllinfo()},p.onerror=function(e){console.log("error")},p.onupgradeneeded=function(e){v=e.target.result,v.createObjectStore("locInfo",{keyPath:"itemId"})},e.getAllinfo=function(){var t=v.transaction(["locInfo"],"readonly");t.objectStore("locInfo").openCursor().onsuccess=function(t){var o=t.target.result;o&&(e.eventInformation.push(o.value),o.continue())},t.oncomplete=function(t){e.locInfo=e.eventInformation[2].location,e.eventInfo=e.eventInformation[1].evntinfo,e.creatingEventdetails=e.eventInformation[0].evntdetails,e.displayInfo()}},e.displayInfo=function(){e.eventime=angular.fromJson(e.creatingEventdetails.eventtime),console.log(e.eventime),e.listDatetime=[],angular.forEach(e.creatingEventdetails.dates,function(t,o){console.log(e.eventime[t].starttime);var a={date:moment(t).format("dddd")+" "+moment(t).format("Do")+" "+moment(t).format("MMMM YYYY")+", From "+s.timeTo12HrFormat(e.eventime[t].starttime,e.is_time_format_24)+" to "+s.timeTo12HrFormat(e.eventime[t].endtime,e.is_time_format_24)};e.listDatetime.push(a)}),u.getMap().then(function(t){for(var o=[],a=0;a<1;a++){o[a]=new google.maps.Marker({title:"Marker: "+a});var n=e.locInfo.geoloc.lat,i=e.locInfo.geoloc.lng,r=new google.maps.LatLng(n,i);o[a].setPosition(r),o[a].setMap(t)}},1e3);var t=e.creatingEventdetails.eventdays.length;e.creatingEventdetails.eventdays[0].start_time,e.creatingEventdetails.eventdays[t-1].end_time},e.saveNewevent=function(){e.timeZone=angular.fromJson(localStorage.getItem("timeZone")),$("#loading").show(),localStorage.removeItem("phonInfo"),e.CreatedEventInfo={};var t=new FormData;t.append("name",e.creatingEventdetails.eventname),e.CreatedEventInfo.eventname=e.creatingEventdetails.eventname,t.append("short_name",e.creatingEventdetails.eventshrtname),t.append("event_type_id",e.eventInfo.type_id),t.append("event_sub_type",e.eventInfo.subtitle),t.append("description",e.creatingEventdetails.eventdesc),e.CreatedEventInfo.desc=e.creatingEventdetails.eventdesc;var n=e.creatingEventdetails.eventdays.length,i=e.creatingEventdetails.eventdays[0].start_time,r=e.creatingEventdetails.eventdays[n-1].end_time;t.append("start_date",i),t.append("end_date",r),t.append("days",JSON.stringify(e.creatingEventdetails.eventdays)),t.append("venue",e.locInfo.venu),e.CreatedEventInfo.venue=e.locInfo.venu,t.append("address_line1",e.locInfo.addLine1),t.append("address_line2",e.locInfo.addLine2),t.append("city",e.locInfo.city),t.append("state",e.locInfo.state);var l=0;l=1==e.eventInfo.isEventPrvt?1:0,t.append("is_private",l),t.append("frequency",e.eventInfo.evntfreq),t.append("country",e.locInfo.country),t.append("zip",e.locInfo.zipCode),e.event_logoo=e.creatingEventdetails.event_logo,t.append("event_logo",s.dataURItoBlob(e.creatingEventdetails.event_logo)),e.CreatedEventInfo.event_logo=e.creatingEventdetails.event_logo,""!=e.creatingEventdetails.coverimg?t.append("agenda_image",s.dataURItoBlob(e.creatingEventdetails.coverimg)):t.append("agenda_image",""),t.append("phone_number",e.creatingEventdetails.contact.phone_number),t.append("email",e.creatingEventdetails.contact.eventemail),1==e.eventInfo.isEventPrvt?(t.append("website",""),t.append("facebook",""),t.append("twitter","")):(t.append("website",e.creatingEventdetails.contact.eventweb),t.append("facebook",e.creatingEventdetails.contact.eventfb),t.append("twitter",e.creatingEventdetails.contact.eventtwitter)),t.append("longitude",e.locInfo.geoloc.lng),t.append("latitude",e.locInfo.geoloc.lat),t.append("event_map","https://maps.googleapis.com/maps/api/staticmap?center="+e.locInfo.geoloc.lat+","+e.locInfo.geoloc.lng+"&zoom=15&size=600x600&markers="+e.locInfo.geoloc.lat+","+e.locInfo.geoloc.lng+"&format=jpg"),t.append("ep_code",e.epData.ep_code),t.append("timezone",e.timeZone.timezone),e.errormsg=!1,a({method:"POST",url:o.url+"/event/",data:t,transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(t){if(e.data=t.data,1==e.data.result){var o={eventready:!1,tracks:!1,gk:!1,promote:!1,pin:!1};localStorage.setItem("selectedEventId",e.data.event_code),localStorage.setItem("eventReadyRedirection",angular.toJson(o)),localStorage.removeItem("epData"),window.location="/event-ready"}else 0==e.data.result&&(e.errormsg=!0,e.errmsg=e.data.message,$("#loading").hide(),$("#container").fadeIn())},function(t){e.errormsg=!0,(t.status==-1||null==t.data)&&0==m.online?e.errmsg=s.errorMsg[0]:e.errmsg=s.errorMsg[1],$("#loading").hide(),$("#container").fadeIn()})},e.pad=function(e){return e<10?"0"+e.toString():e.toString()},e.cancelNewevent=function(){function e(){v.transaction(["locInfo"],"readwrite").objectStore("locInfo").clear().onsuccess=function(e){}}var t=window.indexedDB.open("yaraDB9.db",1);t.onsuccess=function(t){v=t.target.result,e()},t.onerror=function(e){console.log("error")},t.onupgradeneeded=function(e){v=e.target.result,v.createObjectStore("locInfo",{keyPath:"itemId"})},window.location="/dashboard"},0==m.online&&alert("You are not connected to internet")}]),app.controller("ManualLocationController",["$scope","$document","APPService","fileReader","$location","$anchorScroll","$timeout","$http","YaraBaseUrl","$filter","GetDataService","$mdpDatePicker","$mdpTimePicker","$window","NgMap","$rootScope",function(e,t,o,a,n,i,r,l,d,c,u,m,f,v,p,g){void 0!=localStorage.getItem("epData")&&""!=localStorage.getItem("epData")?(e.EPdata=localStorage.getItem("epData"),e.EPdata=angular.fromJson(e.EPdata).ep_code):window.location.replace("/packages"),i();var y=angular.fromJson(localStorage.getItem("redirectionInfo"));if(e.s=o,e.showCountrylist=!1,e.disableFeilds=!0,e.saveLocationManually=function(){function t(e){i.transaction(["locInfo"],"readwrite").objectStore("locInfo").put({itemId:"location",location:e}).onsuccess=function(e){window.location.href="/create-event-info"}}var o,a;1==e.showMap?(o=e.eventLoc.geoloc.lat,a=e.eventLoc.geoloc.lng):(o=e.searchloc.latitude,a=e.searchloc.longitude);var n={venu:e.venu,addLine1:e.addrline1,addLine2:e.addrline2,city:e.venucity,state:e.state,country:e.country.name,country_code:e.country.country_code,zipCode:e.venupincode,geoloc:{lat:o,lng:a}};localStorage.setItem("latandLong",JSON.stringify({lat:o,lng:a})),localStorage.setItem("lat",e.searchloc.latitude),localStorage.setItem("lng",a),localStorage.setItem("country",e.country.name),y.locManual=!0,y.locManual&&y.locmanualPlace&&(y.editeventInfo=!0),localStorage.setItem("redirectionInfo",angular.toJson(y));var i,r=window.indexedDB.open("yaraDB9.db",1);r.onsuccess=function(e){i=e.target.result,t(n)},r.onerror=function(e){console.log("error")},r.onupgradeneeded=function(e){i=e.target.result,i.createObjectStore("locInfo",{keyPath:"itemId"})}},e.getCountries=function(){e.countries=[],l({method:"GET",url:d.url+"/location_track/"}).then(function(t){1==t.data.result&&(e.countries=t.data.countries,$("#loading").hide(),$("#container").fadeIn())})},e.getDialCode=function(){l({method:"GET",url:"../dial_code_json"}).then(function(t){e.dailcode=t.data})},e.countrySelection=function(t){if(""==t)e.showCountrylist=!1,e.searchCountry="",e.showStatelist=!1,t={},e.country=t,e.states=[];else{""==e.dailcode[e.countries[e.countries.indexOf(t)].country_code]?e.phdialreq=!1:e.phdialreq=!0,e.dailcode[e.countries[e.countries.indexOf(t)].country_code].indexOf("and")<0?e.phDailCode=e.dailcode[e.countries[e.countries.indexOf(t)].country_code]:e.phDailCode=e.dailcode[e.countries[e.countries.indexOf(t)].country_code].split("and")[0],""!=e.phDailCode&&e.phDailCode.indexOf("+")<0&&(e.phDailCode="+"+e.phDailCode);var o={phDailCode:e.phDailCode,phdialreq:e.phdialreq};localStorage.setItem("phonInfo",JSON.stringify(o)),e.showCountrylist=!1,e.searchCountry=t.name,e.showStatelist=!1,e.disableFeilds=!1,e.country=t,l({method:"GET",url:d.url+"/location_track/",params:{country:t.name}}).then(function(t){e.states=t.data.occasions})}0==e.showMap&&(e.addrline1="",e.addrline2="",e.venucity="",e.venupincode="",e.searchState="",e.state="");var a=[];a.push(e.venu),a.push(e.addrline1),a.push(e.addrline2),a.push(e.venucity),a.push(e.state),a.push(e.country.name),a.push(e.venupincode),e.maploction(a)},e.afterSelection=function(t){if(void 0!=e.country.name&&"c"==t){e.addrline1="",e.addrline2="",e.venucity="",e.venupincode="",e.state="",e.searchState="";var o=[];o.push(e.venu),o.push(e.addrline1),o.push(e.addrline2),o.push(e.venucity),o.push(e.state),o.push(e.country.name),o.push(e.venupincode),e.maploction(o)}if(void 0!=e.state&&"s"==t){e.addrline1="",e.addrline2="",e.venucity="",e.venupincode="";var o=[];o.push(e.venu),o.push(e.addrline1),o.push(e.addrline2),o.push(e.venucity),o.push(e.state),o.push(e.country.name),o.push(e.venupincode),e.maploction(o)}},e.stateSelection=function(t){""==t?(s={},e.state=s,e.searchstate=""):0==e.showMap?(e.showStatelist=!1,e.disableFeilds=!1,e.searchState=t,e.state=t,e.addrline1="",e.addrline2="",e.venucity="",e.venupincode=""):(e.searchState=t,e.state=t);var o=[];o.push(e.venu),o.push(e.addrline1),o.push(e.addrline2),o.push(e.venucity),o.push(e.state),o.push(e.country.name),o.push(e.venupincode),e.maploction(o)},$(window).click(function(){1==e.showCountrylist&&(void 0==e.country&&(e.searchCountry=""),e.showCountrylist=!1),1==e.showStatelist&&void 0==e.state&&(e.searchState=""),$("#countrydropdown").hide(),$("#statedropdown").hide()}),$("#menucontainercountry").click(function(e){e.stopPropagation(),$("#countrydropdown").show(),$("#statedropdown").hide()}),$("#menucontainerstate").click(function(e){e.stopPropagation(),$("#statedropdown").show()}),$("#countryId").on("input",function(){$("#countrydropdown").show(),$("#statedropdown").hide()}),$("#countryId").on("input",function(){$("#countrydropdown").show(),$("#statedropdown").hide()}),$("#stateId").on("input",function(){$("#countrydropdown").hide(),$("#statedropdown").show()}),e.country={},e.phDailCode="",e.phDailCode="",e.phdialreq=!0,e.startsWith=function(e,t){return 0===(e+"").toLowerCase().indexOf(t.toLowerCase())},e.states=[],e.changingLoc=function(){e.showMap&&(e.showMap=!1)},e.state="",e.countrySearch=function(){return e.countrysearch},e.getCountries(),e.getDialCode(),e.errorScroll=function(){void 0!=e.venu&&r(function(){void 0==e.country.name?o.scrollJquery("venu"):""==e.state||void 0==e.state?o.scrollJquery("state_id"):0!=e.states.length||""!=e.state&&void 0!=e.state||o.scrollJquery("state_id1")},100)},e.searchloc={latitude:"12.9290985",longitude:"77.6210238"},e.mapenable=!1,e.maploction=function(t){e.address="";for(var o=0,a=0;a<t.length;a++)void 0!=t[a]&&""!=t[a]&&(o++,e.address=e.address+t[a]+",");void 0!=e.addrline2&&""!=e.addrline2&&null!=e.addrline2||o++,e.states.length<=0&&(""==e.state||void 0==e.state)&&o++,o<7?e.mapenable=!0:o>=7&&(e.mapenable=!0),e.mapenable&&(e.geocoder=new google.maps.Geocoder,e.geocoder.geocode({address:e.address},function(t,o){o==google.maps.GeocoderStatus.OK&&(e.searchloc={latitude:t[0].geometry.location.lat(),longitude:t[0].geometry.location.lng(),zoom:15})}))},e.$watchCollection("[venu,addrline1,addrline2,venucity,state,venupincode]",function(t){var o=[];o.push(e.venu),o.push(e.addrline1),o.push(e.addrline2),o.push(e.venucity),o.push(e.state),o.push(e.country.name),o.push(e.venupincode),e.maploction(o)}),null!=y&&y.locManual&&!y.locmanualPlace)window.location="/dashboard";else if(null!=y&&y.locManual&&y.locmanualPlace){e.showMap=!0,e.eventInformation=[],e.keyVal=[];var h=function(){e.timeInMs+=500,r(h,500)};r(h,500);var _=window.indexedDB.open("yaraDB9.db",1);_.onsuccess=function(t){e.db=t.target.result,e.getAllinfo()},_.onerror=function(e){console.log("error")},_.onupgradeneeded=function(t){e.db=t.target.result,e.db.createObjectStore("locInfo",{keyPath:"itemId",autoIncrement:!0})}}else e.showMap=!1,r(function(){$("#venu").focus()},500);e.getAllinfo=function(){var t=e.db.transaction(["locInfo"],"readonly");t.objectStore("locInfo").openCursor().onsuccess=function(t){var o=t.target.result;o&&(e.eventInformation.push(o.value),o.continue())},t.oncomplete=function(t){e.eventLoc=e.eventInformation[2].location,e.displayInfo()}},e.displayInfo=function(){e.countrydata=c("custom")(e.countries,e.eventLoc.country),e.country=e.eventLoc.country;for(var t=(e.eventLoc.country,e.eventLoc.country_code,e.countries.length-1);t>=0;t--)if(e.countries[t].name==e.eventLoc.country){e.countrySelection(e.countries[t]);break}e.stateSelection(e.eventLoc.state),e.addrline1=e.eventLoc.addLine1,e.addrline2=e.eventLoc.addLine2,e.venucity=e.eventLoc.city,
e.venupincode=e.eventLoc.zipCode,e.venu=e.eventLoc.venu,p.getMap().then(function(t){console.log("reach map");for(var o=[],a=0;a<1;a++){o[a]=new google.maps.Marker({title:"Marker: "+a});var n=e.eventLoc.geoloc.lat,i=e.eventLoc.geoloc.lng,r=new google.maps.LatLng(n,i);o[a].setPosition(r),o[a].setMap(t)}},1e3)},0==g.online&&alert("You are not connected to internet")}]),app.controller("BreakSessionController",["$scope","$document","APPService","fileReader","$location","$anchorScroll","$timeout","$http","YaraBaseUrl","$filter","GetDataService","$mdpDatePicker","$mdpTimePicker","$window","NgMap","$rootScope",function(e,t,o,a,n,i,r,s,l,d,c,u,m,f,v,p){void 0==localStorage.getItem("bsession")&&(window.location="/events");var g=localStorage.getItem("selectedEventId");void 0!==g&&null!==g||window.location.replace("/events"),e.selevntdata=localStorage.getItem("selEventsData"),e.currentval=angular.fromJson(e.selevntdata),e.btnName="Add Break Session",e.timeformat=localStorage.getItem("is_time_format_24"),"true"==e.timeformat?(e.is_time_format_24=!0,e.timeformaType="HH:mm"):(e.is_time_format_24=!1,e.timeformaType="hh:mm A"),e.setOffset=function(e,t){return c.userOffsetTime(e,t)},document.title="YARA - "+e.currentval.short_name+" - Schedule",e.selevntdata=localStorage.getItem("selEventsData"),e.currentval=angular.fromJson(e.selevntdata),e.notimeDiff=!1,e.showTime=!1,e.foodCpnEnable=1;var y=e.setOffset(e.currentval.start_date,e.currentval.eo),h=e.setOffset(e.currentval.end_date,e.currentval.eo),_=d("date")(y,"yyyy-MM-dd");d("date")(h,"yyyy-MM-dd");e.dates={},e.dayscount=Object.keys(e.currentval.days).length;var w=o.Dateslist(_,e.dayscount);e.service=o,e.eventDaysInfo=[],angular.forEach(e.currentval.days,function(t,o){var a={dayID:e.currentval.days[o].dayID,dayTitle:e.currentval.days[o].dayTitle,dstOffset:e.currentval.days[o].dstOffset,isDayActive:e.currentval.days[o].is_day_active,endTime:e.setOffset(e.currentval.days[o].endTime,e.currentval.eo),startTime:e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),date:d("date")(e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),"yyyy-MM-dd")};e.eventDaysInfo.push(a)}),angular.forEach(w,function(t){angular.forEach(e.eventDaysInfo,function(o,a){t==e.eventDaysInfo[a].date&&(e.dates[t]=e.eventDaysInfo[a])})});var I,S;angular.forEach(e.currentval.days,function(t,o){e.currentval.start_date==e.currentval.days[o].startTime&&(I=e.currentval.days[o].startTime,S=e.currentval.days[o].endTime)}),e.EvtStart=e.setOffset(I,e.currentval.eo),e.EvtEnd=e.setOffset(S,e.currentval.eo),e.getTickets=function(){$("#loading").show(),c.getTickets(e.currentval.event_code).then(function(t){1==t.result&&(e.ticketsdata=t.tickets,e.firsTicketname=e.ticketsdata[0].name)}),$("#loading").hide(),$("#container").fadeIn()},e.breakType="",e.changeBreakType=function(t){$(".timeline-break-type .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".breakType").show(),""==t?(e.breakType=t,$(".breakType").text("Select Break Type")):(console.log(t),e.breakType=t.type_title,e.breakTypeInfo=t,$(".breakType").text(t.type_title))},$(document).on("click",".timeline-break-type .primary_nav_wrap ul li",function(){$(".timeline-break-type img").removeClass(),$(".timeline-break-type img").addClass("caret02"),$(".timeline-break-type .primary_nav_wrap ul li ul").css({display:"list-item",color:"#000","z-index":100})}),t.on("click",function(e){var t=$(".timeline-break-type .primary_nav_wrap ul li");t===e.target||t.has(e.target).length||($(".timeline-break-type .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".timeline-break-type img").removeClass(),$(".timeline-break-type img").addClass("caret01"))}),e.eventLocations=function(){e.showLoc=!1,c.getEventlocations(e.currentval.event_code).then(function(t){1==t.result?($("#loading").hide(),$("#container").fadeIn(),e.evtLoc=t.data,console.log(e.evtLoc),e.evtLoc.length>0&&(e.showLoc=!0,"true"==localStorage.getItem("editSession")&&void 0!=e.editSessInfo&&angular.forEach(e.evtLoc,function(t,o){e.editSessInfo.location.location_code==e.evtLoc[o].location_code&&(e.locationClick(e.evtLoc[o]),e.Bstarttime=e.setOffset(e.editSessInfo.start_time,e.currentval.eo),e.Bendtime=e.setOffset(e.editSessInfo.end_time,e.currentval.eo))}))):($("#loading").hide(),$("#container").fadeIn(),e.evtLoc=[],e.showLoc=!1)})},e.eventLocations(),e.locationClick=function(t){e.spoLocation=t.location,e.showLoclist=!1},e.isValidLoc=!1,e.locValidation=function(t){e.isValidLoc=!1,e.isValidLoc=c.validateLocation(t)},e.createBreakSession=function(){$("#loading").show(),e.existLocation=0,e.showLoc&&angular.forEach(e.evtLoc,function(t,o){e.evtLoc[o].location.toLowerCase()===e.spoLocation.toLowerCase()&&(e.existLocation=1,e.locationCode=e.evtLoc[o].location_code)});var t=e.spoLocation;1==e.existLocation&&(t=e.locationCode),15==e.breakTypeInfo.type_id&&(e.foodCpn=!1),"true"==localStorage.getItem("editSession")&&void 0!=e.editSessInfo?s({method:"POST",url:l.url+"/break_session_edit/",data:{event_code:e.currentval.event_code,tittle:e.breakTypeInfo.type_id,location:t,is_location_exist:e.existLocation,start_time:moment(e.Bstarttime).format("YYYY-MM-DD HH:mm"),end_time:moment(e.Bendtime).format("YYYY-MM-DD HH:mm"),include_coupon:e.foodCpn,session_code:e.editSessInfo.break_session_code,opp:"Edit",day_id:e.dayInfo.dayID}}).then(function(t){e.data=t.data,null==e.data.result||void 0==e.data.result?(e.errormsg=!0,e.data.error=c.errorMsg[1]):0==e.data.result?(e.errormsg=!0,e.data.error=e.data.message,$("#loading").hide(),$("#container").fadeIn()):1==e.data.result&&(window.location="/event/schedule",localStorage.setItem("tabcode",e.dayInfo.dayID))},function(t){e.data={},e.errormsg=!0,(t.status==-1||null==t.data)&&0==p.online?e.data.error=c.errorMsg[0]:e.data.error=c.errorMsg[1],$("#loading").hide(),$("#container").fadeIn()}):s({method:"POST",url:l.url+"/break_session/",data:{event_code:e.currentval.event_code,tittle:e.breakTypeInfo.type_id,location:t,is_location_exist:e.existLocation,start_time:moment(e.Bstarttime).format("YYYY-MM-DD HH:mm"),end_time:moment(e.Bendtime).format("YYYY-MM-DD HH:mm"),include_coupon:e.foodCpn,day_id:e.dayInfo.dayID}}).then(function(t){e.data=t.data,null==e.data.result||void 0==e.data.result?(e.errormsg=!0,e.data.error=c.errorMsg[1]):0==e.data.result?(e.errormsg=!0,e.data.error=e.data.message,$("#loading").hide(),$("#container").fadeIn()):1==e.data.result&&(window.location="/event/schedule",localStorage.setItem("tabcode",e.dayInfo.dayID))},function(t){e.data={},e.errormsg=!0,(t.status==-1||null==t.data)&&0==p.online?e.data.error=c.errorMsg[0]:e.data.error=c.errorMsg[1],$("#loading").hide(),$("#container").fadeIn()})},e.changeSubtype=function(t){if($(".timeline-event-day .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".subtitle").show(),""==t)e.subtitle=t,$(".subtitle").text("Select Event Day");else{e.showTime=!0,e.subtitle=t.dayTitle,e.dayInfo=t,e.bsessionform.starttime.$untouched=!1,e.bsessionform.endtime.$untouched=!1,e.EvtEnd=e.setOffset(t.endTime,e.currentval.eo);var o=e.setOffset(t.startTime,e.currentval.eo),a=e.setOffset(e.localTimeNow,0);if(o<a){var n=new Date(a).setMinutes(a.getMinutes()+5);n=new Date(n),n<e.EvtEnd?(e.starttime=e.Bstarttime=n,e.EvtStart=n):(e.starttime=e.Bstarttime=a,e.EvtStart=a)}else e.starttime=e.Bstarttime=o,e.EvtStart=o;e.endtime=e.Bendtime=e.setOffset(t.endTime,e.currentval.eo),$(".subtitle").text(t.dayTitle)}},e.createSubtype=function(t){if($(".timeline-event-day .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".subtitle").show(),""==t)e.subtitle=t,$(".subtitle").text("Select Event Day");else{e.showTime=!0,e.subtitle=t.dayTitle,e.dayInfo=t;var o=new Date(t.startTime),a=new Date(t.endTime);e.starttime=e.Bstarttime=o,e.endtime=e.Bendtime=a,e.EvtStart=o,e.EvtEnd=a,$(".subtitle").text(t.dayTitle)}},$(document).on("click",".timeline-event-day .primary_nav_wrap ul li",function(){$(".timeline-event-day img").removeClass(),$(".timeline-event-day img").addClass("caret02"),$(".timeline-event-day .primary_nav_wrap ul li ul").css({display:"list-item",color:"#000","z-index":100})}),t.on("click",function(e){var t=$(".timeline-event-day .primary_nav_wrap ul li");t===e.target||t.has(e.target).length||"none"==$(".subtitlesearch").css("display")||($(".timeline-event-day .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".timeline-event-day img").removeClass(),$(".timeline-event-day img").addClass("caret01"))}),e.errorScroll=function(){e.reqEndtime=!1,e.reqStarttime=!1,e.notimeDiff=!1,r(function(){""==e.subtitle||void 0==e.subtitle?o.scrollJquery("subtitleerr"):e.bsessionform.starttime.$untouched?(e.reqStarttime=!0,o.scrollJquery("starttime")):e.bsessionform.endtime.$untouched&&(e.reqEndtime=!0,o.scrollJquery("endtime"))},100)},e.dstapp=!1,e.$watchCollection("[Bstarttime,Bendtime]",function(t){var o=Math.round(new Date(e.Bstarttime).getTime()/1e3),a=e.currentval.latitude,n=e.currentval.longitude,i="https://maps.googleapis.com/maps/api/timezone/json?location="+a+","+n+"&timestamp="+o+"&key=AIzaSyDtW9biEk-bn7LFG-l9yO1ilKLLhRRv8Oo";if($.getJSON(i,function(t){console.log(t),0!=t.dstOffset&&void 0!=t.dstOffset&&(e.dstapp=!0)}),void 0==localStorage.getItem("editSession"))for(var r=e.breakTypes.length-1;r>=0;r--)if(null!=e.breakTypes[r].start_time&&null!=e.breakTypes[r].end_time){var s=e.breakTypes[r].start_time.split(":"),l=e.breakTypes[r].end_time.split(":");if(60*e.Bstarttime.getHours()+e.Bstarttime.getMinutes()>=60*parseInt(s[0])+parseInt(s[1])&&60*e.Bendtime.getHours()+e.Bendtime.getMinutes()<=60*parseInt(l[0])+parseInt(l[1])){console.log(e.breakTypes[r]),e.changeBreakType(e.breakTypes[r]);break}}}),e.$watchCollection("[dayInfo,Bstarttime,Bendtime,spoLocation,breakType]",function(t){if(e.locationExist=0,e.time_conflict=0,e.locCode="",e.Bendtime>e.EvtEnd&&(e.Bendtime=e.EvtEnd),void 0!=e.spoLocation&&angular.forEach(e.evtLoc,function(t,o){e.evtLoc[o].location.toLowerCase()===e.spoLocation.toLowerCase()&&(e.locationExist=1,e.locCode=e.evtLoc[o].location_code)}),e.notimeDiff=!1,e.notimeDiff1=!1,void 0!=e.dayInfo&&0==e.bsessionform.starttime.$untouched&&0==e.bsessionform.endtime.$untouched)if(e.Bstarttime.getHours()==e.Bendtime.getHours()){var o=e.Bendtime.getMinutes()-e.Bstarttime.getMinutes();o<0?e.notimeDiff1=!0:o<5&&o>=0&&(e.notimeDiff=!0)}else e.Bstarttime.getHours()>e.Bendtime.getHours()&&(e.notimeDiff1=!0);if(void 0!=e.dayInfo&&0==e.bsessionform.starttime.$untouched&&0==e.bsessionform.endtime.$untouched){e.Bstarttime.getHours(),e.Bstarttime.getMinutes(),e.Bendtime.getHours(),e.Bendtime.getMinutes()}if(1==e.locationExist&&void 0!=e.dayInfo&&0==e.bsessionform.starttime.$untouched&&0==e.bsessionform.endtime.$untouched&&void 0!=e.breakType){$("#loading").show();var a=null;void 0!=localStorage.getItem("sessId")&&(a=localStorage.getItem("sessId")),s({method:"POST",url:l.url+"/location_validate/",data:{event_code:e.currentval.event_code,location_code:e.locCode,start_time:moment(e.Bstarttime).format("YYYY-MM-DD HH:mm"),end_time:moment(e.Bendtime).format("YYYY-MM-DD HH:mm"),for:"Break_Session",break_session_code:a,day_id:e.dayInfo.dayID}}).then(function(t){$("#loading").hide(),$("#container").fadeIn(),1==t.data.result?e.location_conflicts=t.data.location_conflicts:0==t.data.result&&(e.time_conflict=t.data.time_conflict,e.showerror=t.data.message)},function(t){e.data={},e.errormsg=!0,(t.status==-1||null==t.data)&&0==p.online?e.showerror=c.errorMsg[0]:e.showerror=c.errorMsg[1]})}}),e.cancelSessionCreation=function(){localStorage.removeItem("bsession"),localStorage.removeItem("session"),window.location="/event/schedule"},$(window).click(function(){1==e.showLoclist&&(e.showLoclist=!1,$("#locationdropdown").hide())}),$("#location_id").click(function(e){e.stopPropagation(),$("#locationdropdown").show()}),$("#locationinputid").on("input",function(){$("#locationdropdown").show()}),e.addFoodCoupon=function(t){void 0!=t&&(e.foodCpnEnable=t),1==e.foodCpnEnable?(e.foodCpnEnable=0,e.foodCpn=!1):(e.foodCpnEnable=1,e.foodCpn=!0)},e.getBsessionRequirements=function(){c.eventLocalTz({tz:e.currentval.event_timezone}).then(function(t){$("#loading").show(),1==t.result&&(e.localTimeNow=t.local_time_now,c.getBreaktypes().then(function(t){if(1==t.result)if(e.breakTypes=t.break_types,e.dateset=JSON.parse(localStorage.getItem("eventdayid")),null!=e.dateset&&void 0!=e.dateset||(window.location="/event/schedule"),"true"==localStorage.getItem("editSession")){var o={session_code:localStorage.getItem("sessId"),event_code:e.currentval.event_code};c.getbrkSessionInfo(o).then(function(t){1==t.result&&(e.editSessInfo=t.break_sessions,1==e.editSessInfo.include_coupon?e.foodCpnEnable=0:e.foodCpnEnable=1,e.addFoodCoupon(e.foodCpnEnable),angular.forEach(e.currentval.days,function(t,o){e.currentval.days[o].dayID==e.editSessInfo.day_id&&e.changeSubtype(e.currentval.days[o])}),"true"==localStorage.getItem("editSession")&&void 0!=e.editSessInfo&&angular.forEach(e.breakTypes,function(t,o){e.editSessInfo.tittle.toLowerCase()==e.breakTypes[o].type_title.toLowerCase()&&e.changeBreakType(e.breakTypes[o])}),e.eventLocations(),e.btnName="Update Break Session")})}else e.addFoodCoupon(),angular.forEach(e.currentval.days,function(t,o){e.currentval.days[o].dayID==e.dateset.dayID&&e.changeSubtype(e.currentval.days[o])}),e.eventLocations()}))})},e.getBsessionRequirements(),0==p.online&&alert("You are not connected to internet")}]),app.controller("CollabratorScheduleController",["$scope","fileReader","YaraBaseUrl","$http","$location","$filter","APPService","GetDataService","$mdpDatePicker","$mdpTimePicker","$interval","$timeout","$rootScope","$anchorScroll",function(e,t,o,a,n,i,r,s,l,d,c,u,m,f){e.dashboardsUrl=s.dashboardUrl(),e.headerTitle="Schedule";var v=localStorage.getItem("selectedEventId");e.timeformat=localStorage.getItem("is_time_format_24"),"true"==e.timeformat?e.is_time_format_24=!0:e.is_time_format_24=!1,void 0!==v&&null!==v||window.location.replace("/collaborator-dashboard"),e.selevntdata=localStorage.getItem("selEventsData"),e.currentval=angular.fromJson(e.selevntdata),e.checkdate=function(e,t,o){return s.startend(e,t,o)},localStorage.removeItem("sessId"),localStorage.removeItem("editSession"),e.setTitle=function(t){document.title="YARA - "+e.currentval.short_name+" - "+t},e.setOffset=function(e,t){return s.userOffsetTime(e,t)},e.getLocaltime=function(){s.eventLocalTz({tz:e.currentval.event_timezone}).then(function(t){1==t.result&&(e.localTimeNow=t.local_time_now)})},e.getLocaltime();var p=e.setOffset(e.currentval.start_date,e.currentval.eo),g=e.setOffset(e.currentval.end_date,e.currentval.eo),y=i("date")(p,"yyyy-MM-dd"),h=i("date")(g,"yyyy-MM-dd");e.dayscount=r.dateDiffInDays(new Date(y),new Date(h)),e.dates=r.Dateslist(y,e.dayscount),e.days={},e.eventDaysInfo=[],angular.forEach(e.currentval.days,function(t,o){var a={dayID:e.currentval.days[o].dayID,dayTitle:e.currentval.days[o].dayTitle,dstOffset:e.currentval.days[o].dstOffset,is_day_active:e.currentval.days[o].is_day_active,endTime:e.setOffset(e.currentval.days[o].endTime,e.currentval.eo),startTime:e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),date:i("date")(e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),"yyyy-MM-dd")};e.eventDaysInfo.push(a)}),e.dbutton=e.eventDaysInfo.length-3,u(function(){$(".slider").length>0&&$(".slider").diyslider({width:"100%",height:"51px",minSlides:2,loop:!1,moveSlides:1})},100),e.setDayInfo=function(){angular.forEach(e.dates,function(t){angular.forEach(e.eventDaysInfo,function(o,a){t==e.eventDaysInfo[a].date&&(e.days[t]=e.eventDaysInfo[a])})})},e.setDayInfo(),e.dates={},e.dayscount=Object.keys(e.currentval.days).length;var _=r.Dateslist(y,e.dayscount);if(e.service=r,angular.forEach(_,function(t){e.dates[t]=e.currentval.days[t]}),e.sessionData=[],e.exScope=e,e.listallSessions=function(){$("#loading").show();var t={bs:1,event_code:e.currentval.event_code};s.getallSessions(t).then(function(t){if(e.sessionList=[],1==t.result){e.eo=t.eo;var o=t.sessions;angular.forEach(o,function(t,a){if(1==o[a].session_type){var n={created_at:o[a].created_at,created_by:o[a].created_by,day_id:o[a].day_id,description:o[a].description,end_time:o[a].end_time,eo:o[a].eo,file_bank:o[a].file_bank,is_speaker_engage:o[a].is_speaker_engage,like_count:o[a].like_count,location:o[a].location,session_code:o[a].session_code,session_type:o[a].session_type,speakers:o[a].speakers,sponsors:o[a].sponsors,start_time:o[a].start_time,tittle:o[a].tittle,is_started:o[a].is_started,track:o[a].track,uploaded_file_size:o[a].uploaded_file_size,sDate:i("date")(e.setOffset(o[a].start_time,e.currentval.eo),"EEEE,  MMMM d  y"),timeFrom:e.is_time_format_24?i("date")(e.setOffset(o[a].start_time,e.currentval.eo),"H:mm"):i("date")(e.setOffset(o[a].start_time,e.currentval.eo),"h:mm a"),timeTo:e.is_time_format_24?i("date")(e.setOffset(o[a].end_time,e.currentval.eo),"H:mm"):i("date")(e.setOffset(o[a].end_time,e.currentval.eo),"h:mm a")};e.sessionList.push(n)}else{var n={created_at:o[a].created_at,created_by:o[a].created_by,day_id:o[a].day_id,end_time:o[a].end_time,include_coupon:o[a].include_coupon,location:o[a].location,session_code:o[a].session_code,session_type:o[a].session_type,speakers:o[a].speakers,sponsors:o[a].sponsors,start_time:o[a].start_time,tittle:o[a].tittle,is_started:o[a].is_started,sDate:i("date")(e.setOffset(o[a].start_time,e.currentval.eo),"EEEE,  MMMM d  y"),timeFrom:e.is_time_format_24?i("date")(e.setOffset(o[a].start_time,e.currentval.eo),"H:mm"):i("date")(e.setOffset(o[a].start_time,e.currentval.eo),"h:mm a"),timeTo:e.is_time_format_24?i("date")(e.setOffset(o[a].end_time,e.currentval.eo),"H:mm"):i("date")(e.setOffset(o[a].end_time,e.currentval.eo),"h:mm a")};e.sessionList.push(n)}}),$("#loading").hide(),$("#container").fadeIn()}})},e.listallSessions(),e.sort="",e.sorting=function(t){0==t?(e.sort="",f()):(e.sort="tittle",f())},e.popUp=function(t,o){e.sessionInfo=t,e.sType=o},e.sessiondelete=function(t,o,a){e.sessioncode=t,e.sessiontype=o,e.sessiontitle=a},e.breaksession=function(t,o,a){e.sessioncode=t,e.sessiontype=o,e.sessiontitle=a},e.removeSession=function(){1==e.sessiontype?($("#loading").show(),a({method:"POST",url:o.url+"/session_edit/",data:{session_code:e.sessioncode,opp:"Delete"}}).then(function(t){console.log(t),1==t.data.result?($("#schedule-revoke").modal("hide"),e.listallSessions(),$("#loading").hide(),$("#container").fadeIn()):t.data.result},function(t){e.data={},e.errormsg=!0,(t.status==-1||null==t.data)&&0==m.online?e.showerror=s.errorMsg[0]:e.showerror=s.errorMsg[1]})):0==e.sessiontype&&($("#loading").show(),a({method:"POST",url:o.url+"/break_session_edit/",data:{session_code:e.sessioncode,opp:"Delete"}}).then(function(t){1==t.data.result?($("#loading").hide(),$("#container").fadeIn(),e.listallSessions(),$("#schedule-revoke").modal("hide")):t.data.result},function(t){e.data={},e.errormsg=!0,(t.status==-1||null==t.data)&&0==m.online?e.showerror=s.errorMsg[0]:e.showerror=s.errorMsg[1]}),$("#loading").hide(),$("#container").fadeIn())},e.selecttab=function(t){$("#loading").show(),e.seltab=t.dayID,e.expday=t.is_day_active,localStorage.setItem("eventdayid",JSON.stringify(t)),u(function(){$("#loading").hide(),$("#container").fadeIn()},1500)},void 0!=localStorage.getItem("eventdayid")){var w=JSON.parse(localStorage.getItem("eventdayid"));e.seldat=!1;for(var I=0;I<e.eventDaysInfo.length;I++)e.eventDaysInfo[I].dayID==w.dayID&&(e.selecttab(w),e.seldat=!0,e.movebutton=I);u(function(){if(e.ddbt=e.movebutton+1,e.ddbt>3){e.forl=e.ddbt-3;for(var t=0;t<e.forl;t++)$(".slider").diyslider("move","forth"),e.dbutton--}},100),(e.seldat=!1)&&(e.seltab=e.eventDaysInfo[0].dayID,e.expday=e.eventDaysInfo[0].is_day_active)}else e.seltab=e.eventDaysInfo[0].dayID,e.expday=e.eventDaysInfo[0].is_day_active,localStorage.setItem("eventdayid",JSON.stringify(e.eventDaysInfo[0]));e.editSessionInfo=function(e,t){localStorage.setItem("sessId",e.session_code),localStorage.setItem("editSession",!0),1==t?(localStorage.setItem("session",!0),window.location="/collaborator/schedule-session"):0==t&&(localStorage.setItem("bsession",!0),window.location="/collaborator/schedule-break-session")},e.getTracks=function(){s.getTracks().then(function(t){1==t.result&&(e.tracks=t.tracks)})},e.sessionAdd=function(e){1==e?(localStorage.removeItem("bsession"),localStorage.setItem("session",!0),window.location="/collaborator/schedule-session"):(localStorage.removeItem("session"),localStorage.setItem("bsession",!0),window.location="/collaborator/schedule-break-session")},e.getTickets=function(){s.getTickets(e.currentval.event_code).then(function(t){1==t.result&&(e.ticketsdata=t.tickets,e.firsTicketname=e.ticketsdata[0].name)})},e.getTickets(),0==m.online&&alert("You are not connected to internet")}]),app.controller("CollabratorBreakSessionController",["$scope","$document","APPService","fileReader","$location","$anchorScroll","$timeout","$http","YaraBaseUrl","$filter","GetDataService","$mdpDatePicker","$mdpTimePicker","$window","NgMap","$rootScope",function(e,t,o,a,n,i,r,s,l,d,c,u,m,f,v,p){var g=localStorage.getItem("selectedEventId");void 0!==g&&null!==g||window.location.replace("/collaborator-dashboard"),e.selevntdata=localStorage.getItem("selEventsData"),e.currentval=angular.fromJson(e.selevntdata),e.btnName="Add Break Session",e.timeformat=localStorage.getItem("is_time_format_24"),"true"==e.timeformat?(e.is_time_format_24=!0,e.timeformaType="HH:mm"):(e.is_time_format_24=!1,e.timeformaType="hh:mm A"),e.setOffset=function(e,t){return c.userOffsetTime(e,t)},document.title="YARA - "+e.currentval.short_name+" - Schedule",e.selevntdata=localStorage.getItem("selEventsData"),e.currentval=angular.fromJson(e.selevntdata),e.notimeDiff=!1,e.showTime=!1,e.foodCpnEnable=1;var y=e.setOffset(e.currentval.start_date,e.currentval.eo),h=e.setOffset(e.currentval.end_date,e.currentval.eo),_=d("date")(y,"yyyy-MM-dd");d("date")(h,"yyyy-MM-dd");e.dates={},e.dayscount=Object.keys(e.currentval.days).length;var w=o.Dateslist(_,e.dayscount);e.service=o,e.eventDaysInfo=[],angular.forEach(e.currentval.days,function(t,o){var a={dayID:e.currentval.days[o].dayID,dayTitle:e.currentval.days[o].dayTitle,dstOffset:e.currentval.days[o].dstOffset,isDayActive:e.currentval.days[o].is_day_active,endTime:e.setOffset(e.currentval.days[o].endTime,e.currentval.eo),startTime:e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),date:d("date")(e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),"yyyy-MM-dd")};e.eventDaysInfo.push(a)}),angular.forEach(w,function(t){angular.forEach(e.eventDaysInfo,function(o,a){t==e.eventDaysInfo[a].date&&(e.dates[t]=e.eventDaysInfo[a])})});var I,S;angular.forEach(e.currentval.days,function(t,o){e.currentval.start_date==e.currentval.days[o].startTime&&(I=e.currentval.days[o].startTime,S=e.currentval.days[o].endTime)}),e.EvtStart=e.setOffset(I,e.currentval.eo),e.EvtEnd=e.setOffset(S,e.currentval.eo),e.getTickets=function(){$("#loading").show(),c.getTickets(e.currentval.event_code).then(function(t){1==t.result&&(e.ticketsdata=t.tickets,e.firsTicketname=e.ticketsdata[0].name)}),$("#loading").hide(),$("#container").fadeIn()},e.breakType="",e.changeBreakType=function(t){$(".timeline-break-type .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".breakType").show(),""==t?(e.breakType=t,$(".breakType").text("Select Break Type")):(console.log(t),e.breakType=t.type_title,e.breakTypeInfo=t,$(".breakType").text(t.type_title))},$(document).on("click",".timeline-break-type .primary_nav_wrap ul li",function(){$(".timeline-break-type img").removeClass(),$(".timeline-break-type img").addClass("caret02"),$(".timeline-break-type .primary_nav_wrap ul li ul").css({display:"list-item",color:"#000","z-index":100})}),t.on("click",function(e){var t=$(".timeline-break-type .primary_nav_wrap ul li");t===e.target||t.has(e.target).length||($(".timeline-break-type .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".timeline-break-type img").removeClass(),$(".timeline-break-type img").addClass("caret01"))}),e.eventLocations=function(){e.showLoc=!1,c.getEventlocations(e.currentval.event_code).then(function(t){1==t.result?($("#loading").hide(),$("#container").fadeIn(),e.evtLoc=t.data,console.log(e.evtLoc),e.evtLoc.length>0&&(e.showLoc=!0,"true"==localStorage.getItem("editSession")&&void 0!=e.editSessInfo&&angular.forEach(e.evtLoc,function(t,o){e.editSessInfo.location.location_code==e.evtLoc[o].location_code&&(e.locationClick(e.evtLoc[o]),e.Bstarttime=e.setOffset(e.editSessInfo.start_time,e.currentval.eo),e.Bendtime=e.setOffset(e.editSessInfo.end_time,e.currentval.eo))}))):(e.showLoc=!1,e.evtLoc=[],$("#loading").hide(),$("#container").fadeIn())})},e.eventLocations(),e.locationClick=function(t){e.spoLocation=t.location,e.showLoclist=!1},e.isValidLoc=!1,e.locValidation=function(t){e.isValidLoc=!1,e.isValidLoc=c.validateLocation(t)},e.createBreakSession=function(){$("#loading").show(),e.existLocation=0,e.showLoc&&angular.forEach(e.evtLoc,function(t,o){e.evtLoc[o].location.toLowerCase()===e.spoLocation.toLowerCase()&&(e.existLocation=1,e.locationCode=e.evtLoc[o].location_code)});var t=e.spoLocation;1==e.existLocation&&(t=e.locationCode),15==e.breakTypeInfo.type_id&&(e.foodCpn=!1),"true"==localStorage.getItem("editSession")&&void 0!=e.editSessInfo?s({method:"POST",url:l.url+"/break_session_edit/",data:{event_code:e.currentval.event_code,tittle:e.breakTypeInfo.type_id,location:t,is_location_exist:e.existLocation,start_time:moment(e.Bstarttime).format("YYYY-MM-DD HH:mm"),end_time:moment(e.Bendtime).format("YYYY-MM-DD HH:mm"),include_coupon:e.foodCpn,session_code:e.editSessInfo.break_session_code,opp:"Edit",day_id:e.dayInfo.dayID}}).then(function(t){e.data=t.data,null==e.data.result||void 0==e.data.result?(e.errormsg=!0,e.data.error=c.errorMsg[1]):0==e.data.result?(e.errormsg=!0,e.data.error=e.data.message,$("#loading").hide(),$("#container").fadeIn()):1==e.data.result&&(window.location="/collaborator/schedule",localStorage.setItem("tabcode",e.dayInfo.dayID))},function(t){e.data={},e.errormsg=!0,(t.status==-1||null==t.data)&&0==p.online?e.data.error=c.errorMsg[0]:e.data.error=c.errorMsg[1],$("#loading").hide(),$("#container").fadeIn()}):s({method:"POST",url:l.url+"/break_session/",data:{event_code:e.currentval.event_code,tittle:e.breakTypeInfo.type_id,location:t,is_location_exist:e.existLocation,start_time:moment(e.Bstarttime).format("YYYY-MM-DD HH:mm"),end_time:moment(e.Bendtime).format("YYYY-MM-DD HH:mm"),include_coupon:e.foodCpn,day_id:e.dayInfo.dayID}}).then(function(t){e.data=t.data,null==e.data.result||void 0==e.data.result?(e.errormsg=!0,e.data.error=c.errorMsg[1]):0==e.data.result?(e.errormsg=!0,e.data.error=e.data.message,$("#loading").hide(),$("#container").fadeIn()):1==e.data.result&&(window.location="/collaborator/schedule",localStorage.setItem("tabcode",e.dayInfo.dayID))},function(t){e.data={},e.errormsg=!0,(t.status==-1||null==t.data)&&0==p.online?e.data.error=c.errorMsg[0]:e.data.error=c.errorMsg[1],$("#loading").hide(),$("#container").fadeIn()})},e.changeSubtype=function(t){if($(".timeline-event-day .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".subtitle").show(),""==t)e.subtitle=t,$(".subtitle").text("Select Event Day");else{e.showTime=!0,e.subtitle=t.dayTitle,e.dayInfo=t,e.bsessionform.starttime.$untouched=!1,e.bsessionform.endtime.$untouched=!1,e.EvtEnd=e.setOffset(t.endTime,e.currentval.eo);var o=e.setOffset(t.startTime,e.currentval.eo),a=e.setOffset(e.localTimeNow,0);if(o<a){var n=new Date(a).setMinutes(a.getMinutes()+5);n=new Date(n),n<e.EvtEnd?(e.starttime=e.Bstarttime=n,e.EvtStart=n):(e.starttime=e.Bstarttime=a,e.EvtStart=a)}else e.starttime=e.Bstarttime=o,e.EvtStart=o;e.endtime=e.Bendtime=e.setOffset(t.endTime,e.currentval.eo),$(".subtitle").text(t.dayTitle)}},e.createSubtype=function(t){if($(".timeline-event-day .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".subtitle").show(),""==t)e.subtitle=t,$(".subtitle").text("Select Event Day");else{e.showTime=!0,e.subtitle=t.dayTitle,e.dayInfo=t;var o=new Date(t.startTime),a=new Date(t.endTime);e.starttime=e.Bstarttime=o,e.endtime=e.Bendtime=a,e.EvtStart=o,e.EvtEnd=a,$(".subtitle").text(t.dayTitle)}},$(document).on("click",".timeline-event-day .primary_nav_wrap ul li",function(){$(".timeline-event-day img").removeClass(),$(".timeline-event-day img").addClass("caret02"),$(".timeline-event-day .primary_nav_wrap ul li ul").css({display:"list-item",color:"#000","z-index":100})}),t.on("click",function(e){var t=$(".timeline-event-day .primary_nav_wrap ul li");t===e.target||t.has(e.target).length||"none"==$(".subtitlesearch").css("display")||($(".timeline-event-day .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".timeline-event-day img").removeClass(),$(".timeline-event-day img").addClass("caret01"))}),e.errorScroll=function(){e.reqEndtime=!1,e.reqStarttime=!1,e.notimeDiff=!1,r(function(){""==e.subtitle||void 0==e.subtitle?o.scrollJquery("subtitleerr"):e.bsessionform.starttime.$untouched?(e.reqStarttime=!0,o.scrollJquery("starttime")):e.bsessionform.endtime.$untouched&&(e.reqEndtime=!0,o.scrollJquery("endtime"))},100)},e.dstapp=!1,e.$watchCollection("[Bstarttime,Bendtime]",function(t){var o=Math.round(new Date(e.Bstarttime).getTime()/1e3),a=e.currentval.latitude,n=e.currentval.longitude,i="https://maps.googleapis.com/maps/api/timezone/json?location="+a+","+n+"&timestamp="+o+"&key=AIzaSyDtW9biEk-bn7LFG-l9yO1ilKLLhRRv8Oo";if($.getJSON(i,function(t){console.log(t),0!=t.dstOffset&&void 0!=t.dstOffset&&(e.dstapp=!0)}),void 0==localStorage.getItem("editSession"))for(var r=e.breakTypes.length-1;r>=0;r--)if(null!=e.breakTypes[r].start_time&&null!=e.breakTypes[r].end_time){var s=e.breakTypes[r].start_time.split(":"),l=e.breakTypes[r].end_time.split(":");if(60*e.Bstarttime.getHours()+e.Bstarttime.getMinutes()>=60*parseInt(s[0])+parseInt(s[1])&&60*e.Bendtime.getHours()+e.Bendtime.getMinutes()<=60*parseInt(l[0])+parseInt(l[1])){console.log(e.breakTypes[r]),e.changeBreakType(e.breakTypes[r]);break}}}),e.$watchCollection("[dayInfo,Bstarttime,Bendtime,spoLocation,breakType]",function(t){if(e.locationExist=0,e.time_conflict=0,e.locCode="",e.Bendtime>e.EvtEnd&&(e.Bendtime=e.EvtEnd),void 0!=e.spoLocation&&angular.forEach(e.evtLoc,function(t,o){e.evtLoc[o].location.toLowerCase()===e.spoLocation.toLowerCase()&&(e.locationExist=1,e.locCode=e.evtLoc[o].location_code)}),e.notimeDiff=!1,e.notimeDiff1=!1,void 0!=e.dayInfo&&0==e.bsessionform.starttime.$untouched&&0==e.bsessionform.endtime.$untouched)if(e.Bstarttime.getHours()==e.Bendtime.getHours()){var o=e.Bendtime.getMinutes()-e.Bstarttime.getMinutes();o<0?e.notimeDiff1=!0:o<5&&o>=0&&(e.notimeDiff=!0)}else e.Bstarttime.getHours()>e.Bendtime.getHours()&&(e.notimeDiff1=!0);if(void 0!=e.dayInfo&&0==e.bsessionform.starttime.$untouched&&0==e.bsessionform.endtime.$untouched){e.Bstarttime.getHours(),e.Bstarttime.getMinutes(),e.Bendtime.getHours(),e.Bendtime.getMinutes()}if(1==e.locationExist&&void 0!=e.dayInfo&&0==e.bsessionform.starttime.$untouched&&0==e.bsessionform.endtime.$untouched&&void 0!=e.breakType){var a=null;$("#loading").show(),void 0!=localStorage.getItem("sessId")&&(a=localStorage.getItem("sessId")),s({method:"POST",url:l.url+"/location_validate/",data:{event_code:e.currentval.event_code,location_code:e.locCode,start_time:moment(e.Bstarttime).format("YYYY-MM-DD HH:mm"),end_time:moment(e.Bendtime).format("YYYY-MM-DD HH:mm"),for:"Break_Session",break_session_code:a,day_id:e.dayInfo.dayID}}).then(function(t){$("#loading").hide(),$("#container").fadeIn(),
1==t.data.result?e.location_conflicts=t.data.location_conflicts:0==t.data.result&&(e.time_conflict=t.data.time_conflict,e.showerror=t.data.message)},function(t){e.data={},e.errormsg=!0,(t.status==-1||null==t.data)&&0==p.online?e.showerror=c.errorMsg[0]:e.showerror=c.errorMsg[1]})}}),e.cancelSessionCreation=function(){localStorage.removeItem("bsession"),localStorage.removeItem("session"),window.location="/collaborator/schedule"},$(window).click(function(){1==e.showLoclist&&(e.showLoclist=!1,$("#locationdropdown").hide())}),$("#location_id").click(function(e){e.stopPropagation(),$("#locationdropdown").show()}),$("#locationinputid").on("input",function(){$("#locationdropdown").show()}),e.addFoodCoupon=function(t){void 0!=t&&(e.foodCpnEnable=t),1==e.foodCpnEnable?(e.foodCpnEnable=0,e.foodCpn=!1):(e.foodCpnEnable=1,e.foodCpn=!0)},e.getBsessionRequirements=function(){c.eventLocalTz({tz:e.currentval.event_timezone}).then(function(t){$("#loading").show(),1==t.result&&(e.localTimeNow=t.local_time_now,c.getBreaktypes().then(function(t){if(1==t.result)if(e.breakTypes=t.break_types,e.dateset=JSON.parse(localStorage.getItem("eventdayid")),null!=e.dateset&&void 0!=e.dateset||(window.location="/collaborator/schedule"),"true"==localStorage.getItem("editSession")){var o={session_code:localStorage.getItem("sessId"),event_code:e.currentval.event_code};c.getbrkSessionInfo(o).then(function(t){1==t.result&&(e.editSessInfo=t.break_sessions,1==e.editSessInfo.include_coupon?e.foodCpnEnable=0:e.foodCpnEnable=1,angular.forEach(e.currentval.days,function(t,o){e.currentval.days[o].dayID==e.editSessInfo.day_id&&e.changeSubtype(e.currentval.days[o])}),"true"==localStorage.getItem("editSession")&&void 0!=e.editSessInfo&&angular.forEach(e.breakTypes,function(t,o){e.editSessInfo.tittle.toLowerCase()==e.breakTypes[o].type_title.toLowerCase()&&e.changeBreakType(e.breakTypes[o])}),e.eventLocations(),e.btnName="Update Break Session")})}else e.addFoodCoupon(),angular.forEach(e.currentval.days,function(t,o){e.currentval.days[o].dayID==e.dateset.dayID&&e.changeSubtype(e.currentval.days[o])}),e.eventLocations()}))})},e.getBsessionRequirements(),0==p.online&&alert("You are not connected to internet")}]),app.controller("CollabratorSessionController",["$scope","fileReader","YaraBaseUrl","$http","$location","$filter","APPService","GetDataService","$mdpTimePicker","$interval","$timeout","$document","$rootScope",function(e,t,o,a,n,i,r,s,l,d,c,u,m){void 0==localStorage.getItem("session")&&(window.location="/collaborator-dashboard");var f=localStorage.getItem("selectedEventId");void 0!==f&&null!==f||(window.location="/collaborator-dashboard"),e.selevntdata=localStorage.getItem("selEventsData"),e.currentval=angular.fromJson(e.selevntdata),e.btnName="Add Session",e.timeformat=localStorage.getItem("is_time_format_24"),"true"==e.timeformat?(e.is_time_format_24=!0,e.timeformaType="HH:mm"):(e.is_time_format_24=!1,e.timeformaType="hh:mm A"),e.setOffset=function(e,t){return s.userOffsetTime(e,t)},e.selectedPermission=angular.fromJson(localStorage.getItem("selectedPermission")),e.peopleMange=!1,e.sponserMangae=!1;for(var v=e.selectedPermission.length-1;v>=0;v--)"People"==e.selectedPermission[v].name&&(e.peopleMange=!0),"Sponsors"==e.selectedPermission[v].name&&(e.sponserMangae=!0);e.specPeople=e.currentval.sp_people,e.convertingPeoplelist=e.specPeople,document.title="YARA - "+e.currentval.short_name+" - Schedule";var p=e.setOffset(e.currentval.start_date,e.currentval.eo),g=e.setOffset(e.currentval.end_date,e.currentval.eo),y=i("date")(p,"yyyy-MM-dd");i("date")(g,"yyyy-MM-dd");e.dates={},e.dayscount=Object.keys(e.currentval.days).length;var h=r.Dateslist(y,e.dayscount);e.service=r,e.speakerEngage=!1,e.notimeDiff=!1,e.showTime=!1,e.eventDaysInfo=[],angular.forEach(e.currentval.days,function(t,o){var a={dayID:e.currentval.days[o].dayID,dayTitle:e.currentval.days[o].dayTitle,dstOffset:e.currentval.days[o].dstOffset,endTime:e.setOffset(e.currentval.days[o].endTime,e.currentval.eo),startTime:e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),date:i("date")(e.setOffset(e.currentval.days[o].startTime,e.currentval.eo),"yyyy-MM-dd")};e.eventDaysInfo.push(a)}),angular.forEach(h,function(t){angular.forEach(e.eventDaysInfo,function(o,a){t==e.eventDaysInfo[a].date&&(e.dates[t]=e.eventDaysInfo[a])})});var _,w;angular.forEach(e.currentval.days,function(t,o){e.currentval.start_date==e.currentval.days[o].startTime&&(_=e.currentval.days[o].startTime,w=e.currentval.days[o].endTime)}),e.EvtStart=e.setOffset(_,e.currentval.eo),e.EvtEnd=e.setOffset(w,e.currentval.eo),e.subtitle="",e.tracktitle="",e.trackSelected=!1,e.changeTrack=function(t){$(".timeline-event-track .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".tracktitle").show(),""==t?(e.tracktitle=t,$(".tracktitle").text("Select Track")):(e.tracktitle=t.track_code,e.trackInfo=t,e.trackSelected=!0,$(".tracktitle").text(t.name))},$(document).on("click",".timeline-event-track .primary_nav_wrap ul li",function(){$(".timeline-event-track img").removeClass(),$(".timeline-event-track img").addClass("caret02"),$(".timeline-event-track .primary_nav_wrap ul li ul").css({display:"list-item",color:"#000","z-index":100})}),u.on("click",function(e){var t=$(".timeline-event-track .primary_nav_wrap ul li");t===e.target||t.has(e.target).length||($(".timeline-event-track .primary_nav_wrap ul li ul").hide({display:"none",color:"#333",background:"#333","z-index":100}),$(".timeline-event-track img").removeClass(),$(".timeline-event-track img").addClass("caret01"))}),e.changeSponser=function(t){$(".timeline-event-sponser .primary_nav_wrap ul li ul").hide({display:"none",color:"#333",background:"#333","z-index":100}),$(".sponsertitle").show(),""==t?(e.sponsertitle=t,$(".sponsertitle").text("Select sponser")):(e.sponsertitle=t.sponsor_code,e.sponserInfo=t,console.log(t.name),c(function(){$(".sponsertitle").text(t.name).addClass("color-black")},50))},$(document).on("click",".timeline-event-sponser .primary_nav_wrap ul li",function(){$(".timeline-event-sponser img").removeClass(),$(".timeline-event-sponser img").addClass("caret02"),$(".timeline-event-sponser .primary_nav_wrap ul li ul").css({display:"list-item",color:"#333","z-index":100})}),u.on("click",function(e){var t=$(".timeline-event-sponser .primary_nav_wrap ul li");t===e.target||t.has(e.target).length||($(".timeline-event-sponser .primary_nav_wrap ul li ul").hide({display:"none",color:"#333","z-index":100}),$(".timeline-event-sponser img").removeClass(),$(".timeline-event-sponser img").addClass("caret01"))}),e.noSpeaker=!1,e.selectspeaker=function(t,o){e.noSpeaker=!1,$("#loading").show();var a={item:"sp",day_id:t,track_code:o};s.eventDayAccessories(a).then(function(t){if(1==t.result){$("#loading").hide(),$("#container").fadeIn(),e.SpkData=t.sp_data;var o=[];if(0==e.SpkData.length&&(e.noSpeaker=!0),e.addedSpeker=[],"true"==localStorage.getItem("editSession")&&void 0!=e.editSessInfo&&e.SpkData.length>0){angular.forEach(e.SpkData,function(t,a){angular.forEach(e.editSessInfo.speakers,function(t,n){e.editSessInfo.speakers[n].speaker_code==e.SpkData[a].delegate_code&&(e.addedSpeker.push(e.SpkData[a]),o.push(a))})});for(var a=o.length-1;a>=0;a--)e.SpkData.splice(o[a],1)}}})},e.changeSubtype=function(t){if($(".timeline-event-day .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".subtitle").show(),""==t)e.subtitle=t,$(".subtitle").text("Select Event Day");else{e.showTime=!0,e.selectedDayinfo=t,e.subtitle=t.dayTitle,e.EvtEnd=e.setOffset(t.endTime,e.currentval.eo);var o=e.setOffset(t.startTime,e.currentval.eo),a=e.setOffset(e.localTimeNow,0);if(o<a){var n=new Date(a).setMinutes(a.getMinutes()+5);n=new Date(n),n<e.EvtEnd?(e.starttime=e.Bstarttime=n,e.EvtStart=n):(e.starttime=e.Bstarttime=a,e.EvtStart=a)}else e.starttime=e.Bstarttime=o,e.EvtStart=o;e.endtime=e.Bendtime=e.setOffset(t.endTime,e.currentval.eo),$(".subtitle").text(t.dayTitle),e.sessionform.starttime.$untouched=!1,e.sessionform.endtime.$untouched=!1}},$(document).on("click",".timeline-event-day .primary_nav_wrap ul li",function(){$(".timeline-event-day img").removeClass(),$(".timeline-event-day img").addClass("caret02"),$(".timeline-event-day .primary_nav_wrap ul li ul").css({display:"list-item",color:"#000","z-index":100})}),u.on("click",function(e){var t=$(".timeline-event-day .primary_nav_wrap ul li");t===e.target||t.has(e.target).length||"none"==$(".subtitlesearch").css("display")||($(".timeline-event-day .primary_nav_wrap ul li ul").hide({display:"none",color:"none",background:"#fff","z-index":100}),$(".timeline-event-day img").removeClass(),$(".timeline-event-day img").addClass("caret01"))}),e.addtrack=function(t){e.invalidTrack=!1;var n=/^track[1-9][0-9]*$/,i=/^track[^a-zA-Z0-9][0-9][0-9]*$/,r=e.trackname.toLowerCase();if("track"==e.trackname.toLowerCase()?(e.invalidTrack=!0,$("#loading").hide(),$("#container").fadeIn()):(n.test(r)||i.test(r))&&(e.invalidTrack=!0,$("#loading").hide(),$("#container").fadeIn()),0==e.invalidTrack){var l=[];l.push(e.trackname),a({method:"POST",url:o.url+"/track/",data:{event_code:e.currentval.event_code,name:l,track_based:1}}).then(function(t){e.trackdata=t.data,1==e.trackdata.result?(e.trackname="",e.SelDaysTrack=[],e.getTracks(e.eventDaysInfo[0].dayID),$("#add-new-track").modal("hide")):0==e.trackdata.result?(e.errormsgtrack=!0,e.errdata=e.trackdata.message,e.already_exist=!0):(e.errormsgtrack=!0,e.data.error=s.errorMsg[1])},function(t){e.trackdata={},e.errormsgtrack=!0,t.status==-1||null==t.data?(e.trackdata.error=s.errorMsg[0],0==m.online?e.trackdata.error=s.errorMsg[0]:e.trackdata.error=s.errorMsg[1]):e.trackdata.error=s.errorMsg[1]})}},e.addSession=function(){var t=[];angular.forEach(e.addedSpeker,function(o,a){t.push(e.addedSpeker[a].delegate_code)}),e.existLocation=0,e.showLoc&&angular.forEach(e.evtLoc,function(t,o){e.evtLoc[o].location.toLowerCase()===e.spoLocation.toLowerCase()&&(e.existLocation=1,e.locationCode=e.evtLoc[o].location_code)});var n=e.spoLocation;1==e.existLocation&&(n=e.locationCode);var i=!1;1==e.speakerEngage&&(i=!0);var r,l=[];void 0!=e.sponserInfo&&(r=e.sponserInfo.sponsor_code,l.push(r)),"true"==localStorage.getItem("editSession")?a({method:"POST",url:o.url+"/session_edit/",data:{event_code:e.currentval.event_code,tittle:e.stitle,speakers:t,track:e.trackInfo.track_code,location:n,is_location_exist:e.existLocation,start_time:moment(e.starttime).format("YYYY-MM-DD HH:mm"),end_time:moment(e.endtime).format("YYYY-MM-DD HH:mm"),description:e.sDesc,sponsors:l,speaker_engage:i,session_code:e.editSessInfo.session_code,day_id:e.selectedDayinfo.dayID,opp:"Edit"}}).then(function(t){1==t.data.result?(localStorage.removeItem("bsession"),localStorage.removeItem("session"),window.location="/collaborator/schedule"):0==t.data.result&&(e.errormsg=!0,e.showerror=t.data.message,$("#loading").hide(),$("#container").fadeIn())},function(t){e.data={},console.log(t),e.errormsg=!0,$("#loading").hide(),$("#container").fadeIn(),(t.status==-1||null==t.data)&&0==m.online?e.showerror=s.errorMsg[0]:e.showerror=s.errorMsg[1]}):a({method:"POST",url:o.url+"/session/",data:{event_code:e.currentval.event_code,tittle:e.stitle,speakers:t,track:e.trackInfo.track_code,location:n,is_location_exist:e.existLocation,start_time:moment(e.starttime).format("YYYY-MM-DD HH:mm"),end_time:moment(e.endtime).format("YYYY-MM-DD HH:mm"),description:e.sDesc,sponsors:l,speaker_engage:i,day_id:e.selectedDayinfo.dayID}}).then(function(t){console.log(t),1==t.data.result?(localStorage.removeItem("bsession"),localStorage.removeItem("session"),window.location="/collaborator/schedule",localStorage.setItem("tabcode",e.selectedDayinfo.dayID)):0==t.data.result&&(e.errormsg=!0,e.showerror=t.data.message,$("#loading").hide(),$("#container").fadeIn())},function(t){e.data={},e.errormsg=!0,$("#loading").hide(),$("#container").fadeIn(),(t.status==-1||null==t.data)&&0==m.online?e.showerror=s.errorMsg[0]:e.showerror=s.errorMsg[1]})},e.getSponsor=function(){s.getSponsors(e.currentval.event_code).then(function(t){if(1==t.result&&(e.SPdata=t.data,console.log(e.SPdata),"true"==localStorage.getItem("editSession")&&void 0!=e.editSessInfo))for(var o=e.SPdata.length-1;o>=0;o--)if(e.editSessInfo.sponsors[0].sponsor_code==e.SPdata[o].sponsor_code){e.changeSponser(e.SPdata[o]);break}})},e.locationClick=function(t){e.spoLocation=t.location,e.showLoclist=!1},e.isValidLoc=!1,e.locValidation=function(t){e.isValidLoc=!1,e.isValidLoc=s.validateLocation(t)},e.eventLocations=function(){e.showLoc=!1,s.getEventlocations(e.currentval.event_code).then(function(t){1==t.result?(e.evtLoc=t.data,e.evtLoc.length>0&&(e.showLoc=!0,"true"==localStorage.getItem("editSession")&&void 0!=e.editSessInfo&&angular.forEach(e.evtLoc,function(t,o){e.editSessInfo.location.location_code==e.evtLoc[o].location_code&&(e.locationClick(e.evtLoc[o]),e.starttime=e.setOffset(e.editSessInfo.start_time,e.currentval.eo),e.endtime=e.setOffset(e.editSessInfo.end_time,e.currentval.eo))}))):e.showLoc=!1})},e.getTracks=function(){s.getTracks(e.currentval.event_code).then(function(t){1==t.result&&(e.tracks=t.tracks,"true"==localStorage.getItem("editSession")&&void 0!=e.editSessInfo&&angular.forEach(e.tracks,function(t,o){e.editSessInfo.track.track_code==e.tracks[o].track_code&&e.changeTrack(e.tracks[o])}))})},e.addedSpeker=[],e.speakerAdd=function(t,o){e.showSp=!1,e.addedSpeker.push(t),e.SpkData.splice(o,1)},e.removeSpeaker=function(t,o){e.SpkData.push(t),e.addedSpeker.splice(o,1)},e.errorScroll=function(){console.log("reach"),$("#loading").show(),0==e.addedSpeker.length&&e.sessionform.$valid?r.scrollJquery("speaker_id"):""==e.subtitle&&r.scrollJquery("subtitleerr")},e.displayError=function(){e.submitted=!0,$("#loading").hide(),$("#container").fadeIn()},e.speakertitle="",e.SelSpeaker=[],e.addSpeaker=function(){var e={delegate:!1,speaker:!0,bulk:!1};localStorage.setItem("redirectionInfo",angular.toJson(e)),sessionStorage.setItem("redirect","/collaborator/schedule-session"),window.location.replace("/collaborator/add-speaker")},e.dstapp=!1,e.$watchCollection("[starttime,endtime]",function(t){var o=Math.round(new Date(e.starttime).getTime()/1e3),a=e.currentval.latitude,n=e.currentval.longitude,i="https://maps.googleapis.com/maps/api/timezone/json?location="+a+","+n+"&timestamp="+o+"&key=AIzaSyDtW9biEk-bn7LFG-l9yO1ilKLLhRRv8Oo";$.getJSON(i,function(t){console.log(t),0!=t.dstOffset&&void 0!=t.dstOffset&&(e.dstapp=!0)})}),e.$watchCollection("[selectedDayinfo,trackInfo]",function(t){console.log(e.selectedDayinfo),console.log(e.trackInfo),void 0!=e.selectedDayinfo&&void 0!=e.trackInfo&&e.selectspeaker(e.selectedDayinfo.dayID,e.trackInfo.track_code)}),e.$watchCollection("[selectedDayinfo,starttime,endtime,spoLocation,stitle,addedSpeker.length,trackInfo]",function(t){if(e.notimeDiff=!1,e.notimeDiff1=!1,e.endtime>e.EvtEnd&&(e.endtime=e.EvtEnd),void 0!=e.selectedDayinfo&&0==e.sessionform.starttime.$untouched&&0==e.sessionform.endtime.$untouched)if(e.starttime.getHours()==e.endtime.getHours()){var n=e.endtime.getMinutes()-e.starttime.getMinutes();n<0?e.notimeDiff1=!0:n<5&&n>=0&&(e.notimeDiff=!0)}else e.starttime.getHours()>e.endtime.getHours()&&(e.notimeDiff1=!0);e.locationExist=0,e.locCode="",void 0!=e.spoLocation&&angular.forEach(e.evtLoc,function(t,o){e.evtLoc[o].location.toLowerCase()===e.spoLocation.toLowerCase()&&(e.locationExist=1,e.locCode=e.evtLoc[o].location_code)});var l=[];if(angular.forEach(e.addedSpeker,function(t,o){l.push(e.addedSpeker[o].delegate_code)}),void 0!=e.selectedDayinfo&&0==e.sessionform.starttime.$untouched&&0==e.sessionform.endtime.$untouched&&void 0!=e.stitle&&void 0!=e.trackInfo&&e.addedSpeker.length>0){if($("#loading").show(),"true"==localStorage.getItem("editSession"))var d=Number(localStorage.getItem("sessId"));else var d=localStorage.getItem("sessId");e.pastTime=0,e.sessionSttime=i("date")(e.starttime,"hh:mm a"),e.sessionEndtime=i("date")(e.endtime,"hh:mm a"),a({method:"POST",url:o.url+"/location_validate/",data:{event_code:e.currentval.event_code,session_name:e.stitle.toLowerCase(),location_code:e.locCode,start_time:moment(e.starttime).format("YYYY-MM-DD HH:mm"),end_time:moment(e.endtime).format("YYYY-MM-DD HH:mm"),for:"Session",speaker_code:l,track_code:e.trackInfo.track_code,session_code:d,day_id:e.selectedDayinfo.dayID}}).then(function(t){$("#loading").hide(),$("#container").fadeIn(),1==t.data.result?(e.speakers_conflict=t.data.speakers_conflict,e.location_conflicts=t.data.location_conflicts,e.session_duplicate=t.data.session_duplicate,e.pastTime=t.data.time_conflict,c(function(){e.location_conflicts.length>0?r.scrollJquery("locationdupe_id"):1==e.session_duplicate&&r.scrollJquery("sessiondupe_id")},300)):0==t.data.result&&(e.speakers_conflict=t.data.speakers_conflict,e.location_conflicts=t.data.location_conflicts,e.session_duplicate=t.data.session_duplicate,e.pastTime=t.data.time_conflict,e.showerror=t.data.message,c(function(){1==e.pastTime?r.scrollJquery("timesec"):1==e.session_duplicate?r.scrollJquery("sessiondupe_id"):void 0!=e.location_conflicts&&e.location_conflicts.length>0&&r.scrollJquery("locationdupe_id")},300))},function(t){e.data={},e.errormsg=!0,(t.status==-1||null==t.data)&&0==m.online?e.showerror=s.errorMsg[0]:e.showerror=s.errorMsg[1]})}}),$(window).click(function(){1==e.showLoclist&&(e.showLoclist=!1,$("#locationdropdown").hide()),1==e.showSp&&(e.showSp=!1,$("#speakerdropdown").hide())}),$("#location_id").click(function(e){e.stopPropagation(),$("#locationdropdown").show()}),$("#locationinputid").on("input",function(){$("#locationdropdown").show()}),$("#speakerid").click(function(e){e.stopPropagation(),$("#speakerdropdown").show()}),$("#speakerinputid").on("input",function(){$("#speakerdropdown").show()}),e.cancelSessionCreation=function(){localStorage.removeItem("bsession"),localStorage.removeItem("session"),window.location="/collaborator/schedule"},e.addSponser=function(){window.location="/collaborator/sponsor"},e.getSessionRequirements=function(){s.eventLocalTz({tz:e.currentval.event_timezone}).then(function(t){$("#loading").show(),1==t.result&&(e.localTimeNow=t.local_time_now,s.getTracks(e.currentval.event_code).then(function(t){if(1==t.result){if(e.tracks=t.tracks,"true"==localStorage.getItem("editSession")&&void 0!=e.editSessInfo&&angular.forEach(e.tracks,function(t,o){e.editSessInfo.track.track_code==e.tracks[o].track_code&&e.changeTrack(e.tracks[o])}),e.dateset=JSON.parse(localStorage.getItem("eventdayid")),null!=e.dateset&&void 0!=e.dateset||(window.location="/collaborator/schedule"),"true"==localStorage.getItem("editSession")){var o={session_code:localStorage.getItem("sessId"),event_code:e.currentval.event_code};s.getSessionInfo(o).then(function(t){1==t.result&&(e.editSessInfo=t.sessions[0],e.stitle=e.editSessInfo.tittle,e.sDesc=e.editSessInfo.description,e.speakerEngage=e.editSessInfo.is_speaker_engage,window.setTimeout(function(){$("textarea").height($("textarea")[0].scrollHeight)},500),angular.forEach(e.currentval.days,function(t,o){e.currentval.days[o].dayID==e.editSessInfo.day_id&&e.changeSubtype(e.currentval.days[o])}),angular.forEach(e.tracks,function(t,o){e.editSessInfo.track.track_code==e.tracks[o].track_code&&e.changeTrack(e.tracks[o])}),e.eventLocations(),e.getSponsor(),e.btnName="Update Session")})}else angular.forEach(e.currentval.days,function(t,o){e.currentval.days[o].dayID==e.dateset.dayID&&e.changeSubtype(e.currentval.days[o])}),e.eventLocations(),e.getSponsor();$("#loading").hide(),$("#container").fadeIn()}}))})},e.getSessionRequirements(),0==m.online&&alert("You are not connected to internet")}]),app.controller("DeskController",["$scope","fileReader","YaraBaseUrl","$http","$location","$filter","APPService","GetDataService","$mdpTimePicker","$interval","$timeout","$document","$rootScope","$anchorScroll",function(e,t,o,a,n,i,r,s,l,d,c,u,m,f){e.Logout=function(){s.Signout().then(function(e){1==e.result&&(localStorage.clear(),window.location="/sign-in")})},e.loginInfo=angular.fromJson(localStorage.getItem("Logininfo")),"Admin"!=e.loginInfo.role&&e.Logout(),e.timeformat=localStorage.getItem("is_time_format_24"),"true"==e.timeformat?e.is_time_format_24=!0:e.is_time_format_24=!1,e.getAllIssues=function(){s.getAllIssues().then(function(t){1==t.result&&(e.issues=t.issues,e.userOffset=t.uo,e.setOffset=function(e,t){return s.userOffsetTime(e,t)},e.inView&&angular.forEach(e.issues,function(t){t.issue_code==e.valView.issue_code&&(e.valView=t)}))})},e.getAllIssues(),e.inView=!1,e.redirectpage=function(t){e.inView=!0,e.valView=t,f()},e.scrollanchar=function(){f()},e.replyForm=function(){e.replyRes={},a({method:"POST",url:o.url+"/happy_help/admin_responds/",data:{issue_code:e.valView.issue_code,responds:e.posttxt}}).then(function(t){e.replyRes=t.data,1==e.replyRes.result?($("#happyReply").modal("hide"),e.posttxt="",e.getAllIssues(),e.replySubmitted=!1):0==e.replyRes.result?(e.replyRes.result=0,e.replyRes.error=e.replyRes.message):(e.replyRes.result=0,e.replyRes.error=s.errorMsg[1])},function(t){e.replyRes.result=0,(t.status==-1||null==t.data)&&0==m.online?e.replyRes.error=s.errorMsg[0]:e.replyRes.error=s.errorMsg[1]})},e.issueClosed=function(t){a({method:"POST",url:o.url+"/happy_help/update_issue/",data:{issue_code:e.valView.issue_code,status:t}}).then(function(t){1==t.data.result&&e.getAllIssues()})},0==m.online&&alert("You are not connected to internet")}]);