function activateWebcam(){$("#captureImg").removeClass("display-none"),webcamera(window)}var webcamera=function(e){function t(){console.log("1");var e=Error.apply(this,arguments);e.name=this.name="FlashError",this.stack=e.stack,this.message=e.message}function a(){console.log("2");var e=Error.apply(this,arguments);e.name=this.name="WebcamError",this.stack=e.stack,this.message=e.message}var s;IntermediateInheritor=function(){},IntermediateInheritor.prototype=Error.prototype,t.prototype=new IntermediateInheritor,a.prototype=new IntermediateInheritor;var i={version:"1.0.16",protocol:location.protocol.match(/https/i)?"https":"http",loaded:!1,live:!1,userMedia:!0,params:{width:0,height:0,dest_width:0,dest_height:0,image_format:"jpeg",jpeg_quality:90,enable_flash:!0,force_flash:!1,flip_horiz:!1,fps:30,upload_name:"webcam",constraints:null,swfURL:"",flashNotDetectedText:"ERROR: No Adobe Flash Player detected.  Webcam.js relies on Flash for browsers that do not support getUserMedia (like yours).",noInterfaceFoundText:"No supported webcam interface found.",unfreeze_snap:!0},errors:{FlashError:t,WebcamError:a},hooks:{},init:function(){console.log("3");var t=this;this.mediaDevices=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices:navigator.mozGetUserMedia||navigator.webkitGetUserMedia?{getUserMedia:function(e){return new Promise(function(t,a){(navigator.mozGetUserMedia||navigator.webkitGetUserMedia).call(navigator,e,t,a)})}}:null,e.URL=e.URL||e.webkitURL||e.mozURL||e.msURL,this.userMedia=this.userMedia&&!!this.mediaDevices&&!!e.URL,navigator.userAgent.match(/Firefox\D+(\d+)/)&&parseInt(RegExp.$1,10)<21&&(this.userMedia=null),this.userMedia&&e.addEventListener("beforeunload",function(e){t.reset()})},attach:function(t){if(console.log("4"),"string"==typeof t&&(t=document.getElementById(t)||document.querySelector(t)),!t)return this.dispatch("error",new a("Could not locate DOM element to attach to."));this.container=t,t.innerHTML="";var o=document.createElement("div");if(t.appendChild(o),this.peg=o,this.params.width||(this.params.width=t.offsetWidth),this.params.height||(this.params.height=t.offsetHeight),!this.params.width||!this.params.height)return this.dispatch("error",new a("No width and/or height for webcam.  Please call set() first, or attach to a visible element."));this.params.dest_width||(this.params.dest_width=this.params.width),this.params.dest_height||(this.params.dest_height=this.params.height),this.userMedia=void 0===s?this.userMedia:s,this.params.force_flash&&(s=this.userMedia,this.userMedia=null),"number"!=typeof this.params.fps&&(this.params.fps=30);var r=this.params.width/this.params.dest_width,n=this.params.height/this.params.dest_height;if(this.userMedia){var h=document.createElement("video");h.setAttribute("autoplay","autoplay"),h.style.width=this.params.dest_width+"px",h.style.height=this.params.dest_height+"px",1==r&&1==n||(t.style.overflow="hidden",h.style.webkitTransformOrigin="0px 0px",h.style.mozTransformOrigin="0px 0px",h.style.msTransformOrigin="0px 0px",h.style.oTransformOrigin="0px 0px",h.style.transformOrigin="0px 0px",h.style.webkitTransform="scaleX("+r+") scaleY("+n+")",h.style.mozTransform="scaleX("+r+") scaleY("+n+")",h.style.msTransform="scaleX("+r+") scaleY("+n+")",h.style.oTransform="scaleX("+r+") scaleY("+n+")",h.style.transform="scaleX("+r+") scaleY("+n+")"),t.appendChild(h),this.video=h;var l=this;this.mediaDevices.getUserMedia({audio:!1,video:this.params.constraints||{mandatory:{minWidth:this.params.dest_width,minHeight:this.params.dest_height}}}).then(function(t){h.onloadedmetadata=function(e){l.stream=t,l.loaded=!0,l.live=!0,l.dispatch("load"),l.dispatch("live"),l.flip()},h.src=e.URL.createObjectURL(t)||t}).catch(function(e){l.params.enable_flash&&l.detectFlash()?setTimeout(function(){l.params.force_flash=1,l.attach(t)},1):l.dispatch("error",e)})}else if(this.params.enable_flash&&this.detectFlash()){e.Webcam=i;var c=document.createElement("div");c.innerHTML=this.getSWFHTML(),t.appendChild(c)}else this.dispatch("error",new a(this.params.noInterfaceFoundText));if(this.params.crop_width&&this.params.crop_height){var m=Math.floor(this.params.crop_width*r),p=Math.floor(this.params.crop_height*n);t.style.width=m+"px",t.style.height=p+"px",t.style.overflow="hidden",t.scrollLeft=Math.floor(this.params.width/2-m/2),t.scrollTop=Math.floor(this.params.height/2-p/2)}else t.style.width=this.params.width+"px",t.style.height=this.params.height+"px"},reset:function(){if(console.log("5"),this.preview_active&&this.unfreeze(),this.unflip(),this.userMedia){if(this.stream)if(this.stream.getVideoTracks){var e=this.stream.getVideoTracks();e&&e[0]&&e[0].stop&&e[0].stop()}else this.stream.stop&&this.stream.stop();delete this.stream,delete this.video}if(this.userMedia!==!0){var t=this.getMovie();t&&t._releaseCamera&&t._releaseCamera()}this.container&&(this.container.innerHTML="",delete this.container),this.loaded=!1,this.live=!1},set:function(){if(console.log("6"),1==arguments.length)for(var e in arguments[0])this.params[e]=arguments[0][e];else this.params[arguments[0]]=arguments[1]},on:function(e,t){console.log("7"),e=e.replace(/^on/i,"").toLowerCase(),this.hooks[e]||(this.hooks[e]=[]),this.hooks[e].push(t),console.log("camear2")},off:function(e,t){if(console.log("8"),e=e.replace(/^on/i,"").toLowerCase(),this.hooks[e])if(t){var a=this.hooks[e].indexOf(t);a>-1&&this.hooks[e].splice(a,1)}else this.hooks[e]=[]},dispatch:function(){console.log("9"),$("#captureImg").show();var s=arguments[0].replace(/^on/i,"").toLowerCase(),i=Array.prototype.slice.call(arguments,1);if(this.hooks[s]&&this.hooks[s].length){for(var o=0,r=this.hooks[s].length;o<r;o++){var n=this.hooks[s][o];"function"==typeof n?n.apply(this,i):"object"==typeof n&&2==n.length?n[0][n[1]].apply(n[0],i):e[n]&&e[n].apply(e,i)}return console.log("9-131"),!0}return"error"==s&&($("#captureImg").hide(),$("#cam-notsupport").modal("show"),i[0]instanceof t||i[0]instanceof a?message=i[0].message:message="Could not access webcam: "+i[0].name+": "+i[0].message+" "+i[0].toString(),console.log("camear1")),!1},setSWFLocation:function(e){console.log("10"),this.set("swfURL",e)},detectFlash:function(){console.log("11");var t=e,a=navigator,s=!1;if(void 0!==a.plugins&&"object"==typeof a.plugins["Shockwave Flash"]){var i=a.plugins["Shockwave Flash"].description;console.log("11-1"),i&&void 0!==a.mimeTypes&&a.mimeTypes["application/x-shockwave-flash"]&&a.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&(s=!0,console.log("11-1-1"))}else if(void 0!==t.ActiveXObject){console.log("11-2");try{var o=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(o){console.log("11-2-1");var r=o.GetVariable("$version");r&&(s=!0)}}catch(e){}}return console.log(s+"11-3"),s},getSWFHTML:function(){console.log("12");var a="",s=this.params.swfURL;if(location.protocol.match(/file/))return console.log("12-1"),this.dispatch("error",new t("Flash does not work from local disk.  Please run from a web server.")),'<h3 style="color:red">ERROR: the Webcam.js Flash fallback does not work from local disk.  Please run it from a web server.</h3>';if(!this.detectFlash())return console.log("12-2"),this.dispatch("error",new t("Adobe Flash Player not found.  Please install from get.adobe.com/flashplayer and try again.")),'<h3 style="color:red">'+this.params.flashNotDetectedText+"</h3>";if(!s){console.log("12-3"),$("#take-picture").modal("show");for(var i="",o=document.getElementsByTagName("script"),r=0,n=o.length;r<n;r++){var h=o[r].getAttribute("src");h&&h.match(/\/webcam(\.min)?\.js/)&&(i=h.replace(/\/webcam(\.min)?\.js.*$/,""),r=n)}s=i?i+"/webcam.swf":"webcam.swf"}e.localStorage&&!localStorage.getItem("visited")&&(console.log("12-4"),this.params.new_user=1,localStorage.setItem("visited",1));var l="";for(var c in this.params)l&&(l+="&"),l+=c+"="+escape(this.params[c]);return a+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" type="application/x-shockwave-flash" codebase="'+this.protocol+'://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+this.params.width+'" height="'+this.params.height+'" id="webcam_movie_obj" align="middle"><param name="wmode" value="opaque" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+s+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+l+'"/><embed id="webcam_movie_embed" src="'+s+'" wmode="opaque" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+this.params.width+'" height="'+this.params.height+'" name="webcam_movie_embed" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+l+'"></embed></object>'},getMovie:function(){if(console.log("13"),!this.loaded)return this.dispatch("error",new t("Flash Movie is not loaded yet"));var e=document.getElementById("webcam_movie_obj");return e&&e._snap||(e=document.getElementById("webcam_movie_embed")),e||this.dispatch("error",new t("Cannot locate Flash movie in DOM")),e},freeze:function(){console.log("14");var e=this,t=this.params;this.preview_active&&this.unfreeze();var a=this.params.width/this.params.dest_width,s=this.params.height/this.params.dest_height;this.unflip();var i=t.crop_width||t.dest_width,o=t.crop_height||t.dest_height,r=document.createElement("canvas");r.width=i,r.height=o;var n=r.getContext("2d");this.preview_canvas=r,this.preview_context=n,1==a&&1==s||(r.style.webkitTransformOrigin="0px 0px",r.style.mozTransformOrigin="0px 0px",r.style.msTransformOrigin="0px 0px",r.style.oTransformOrigin="0px 0px",r.style.transformOrigin="0px 0px",r.style.webkitTransform="scaleX("+a+") scaleY("+s+")",r.style.mozTransform="scaleX("+a+") scaleY("+s+")",r.style.msTransform="scaleX("+a+") scaleY("+s+")",r.style.oTransform="scaleX("+a+") scaleY("+s+")",r.style.transform="scaleX("+a+") scaleY("+s+")"),this.snap(function(){r.style.position="relative",r.style.left=e.container.scrollLeft+"px",r.style.top=e.container.scrollTop+"px",e.container.insertBefore(r,e.peg),e.container.style.overflow="hidden",e.preview_active=!0},r)},unfreeze:function(){this.preview_active&&(this.container.removeChild(this.preview_canvas),delete this.preview_context,delete this.preview_canvas,this.preview_active=!1,this.flip())},flip:function(){if(this.params.flip_horiz){var e=this.container.style;e.webkitTransform="scaleX(-1)",e.mozTransform="scaleX(-1)",e.msTransform="scaleX(-1)",e.oTransform="scaleX(-1)",e.transform="scaleX(-1)",e.filter="FlipH",e.msFilter="FlipH"}},unflip:function(){if(this.params.flip_horiz){var e=this.container.style;e.webkitTransform="scaleX(1)",e.mozTransform="scaleX(1)",e.msTransform="scaleX(1)",e.oTransform="scaleX(1)",e.transform="scaleX(1)",e.filter="",e.msFilter=""}},savePreview:function(e,t){var a=this.params,s=this.preview_canvas,i=this.preview_context;if(t){t.getContext("2d").drawImage(s,0,0)}e(t?null:s.toDataURL("image/"+a.image_format,a.jpeg_quality/100),s,i),this.params.unfreeze_snap&&this.unfreeze()},snap:function(e,t){console.log("15");var s=this.params;if(!this.loaded)return this.dispatch("error",new a("Webcam is not loaded yet"));if(!e)return this.dispatch("error",new a("Please provide a callback function or canvas to snap()"));if(this.preview_active)return this.savePreview(e,t),null;var i=document.createElement("canvas");i.width=this.params.dest_width,i.height=this.params.dest_height;var o=i.getContext("2d");this.params.flip_horiz&&(o.translate(s.dest_width,0),o.scale(-1,1));var r=function(){if(this.src&&this.width&&this.height&&o.drawImage(this,0,0,s.dest_width,s.dest_height),s.crop_width&&s.crop_height){var a=document.createElement("canvas");a.width=s.crop_width,a.height=s.crop_height;var r=a.getContext("2d");r.drawImage(i,Math.floor(s.dest_width/2-s.crop_width/2),Math.floor(s.dest_height/2-s.crop_height/2),s.crop_width,s.crop_height,0,0,s.crop_width,s.crop_height),o=r,i=a}if(t){t.getContext("2d").drawImage(i,0,0)}e(t?null:i.toDataURL("image/"+s.image_format,s.jpeg_quality/100),i,o)};if(this.userMedia)o.drawImage(this.video,0,0,this.params.dest_width,this.params.dest_height),r();else{var n=this.getMovie()._snap(),h=new Image;h.onload=r,h.src="data:image/"+this.params.image_format+";base64,"+n}return null},configure:function(e){console.log("16"),e||(e="camera"),this.getMovie()._configure(e)},flashNotify:function(e,a){switch(e){case"flashLoadComplete":this.loaded=!0,this.dispatch("load");break;case"cameraLive":this.live=!0,this.dispatch("live");break;case"error":this.dispatch("error",new t(a))}},b64ToUint6:function(e){return e>64&&e<91?e-65:e>96&&e<123?e-71:e>47&&e<58?e+4:43===e?62:47===e?63:0},base64DecToArr:function(e,t){for(var a,s,i=e.replace(/[^A-Za-z0-9\+\/]/g,""),o=i.length,r=t?Math.ceil((3*o+1>>2)/t)*t:3*o+1>>2,n=new Uint8Array(r),h=0,l=0,c=0;c<o;c++)if(s=3&c,h|=this.b64ToUint6(i.charCodeAt(c))<<18-6*s,3===s||o-c==1){for(a=0;a<3&&l<r;a++,l++)n[l]=h>>>(16>>>a&24)&255;h=0}return n},upload:function(e,t,a){var s=this.params.upload_name||"webcam",o="";if(!e.match(/^data\:image\/(\w+)/))throw"Cannot locate image format in Data URI";o=RegExp.$1;var r=e.replace(/^data\:image\/\w+\;base64\,/,""),n=new XMLHttpRequest;n.open("POST",t,!0),n.upload&&n.upload.addEventListener&&n.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/e.total;i.dispatch("uploadProgress",t,e)}},!1);var h=this;n.onload=function(){a&&a.apply(h,[n.status,n.responseText,n.statusText]),i.dispatch("uploadComplete",n.status,n.responseText,n.statusText)};var l=new Blob([this.base64DecToArr(r)],{type:"image/"+o}),c=new FormData;c.append(s,l,s+"."+o.replace(/e/,"")),n.send(c)}};i.init(),i.set({width:480,height:360,dest_width:480,dest_height:360,crop_width:360,crop_height:360,image_format:"jpeg",jpeg_quality:90}),i.attach("#my_camera"),"function"==typeof define&&define.amd?define(function(){return i}):"object"==typeof module&&module.exports?module.exports=i:e.Webcam=i};