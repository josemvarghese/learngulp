!function(e){"use strict";e.module("datepicker",[]).directive("datepicker",["$window","$compile","$locale","$filter","$interpolate",function(a,t,n,i,r){return{restrict:"AEC",scope:{dateSet:"@",dateMinLimit:"@",dateMaxLimit:"@",dateMonthTitle:"@",dateYearTitle:"@",buttonNextTitle:"@",buttonPrevTitle:"@"},link:function(d,s,l){d.dateMonthTitle=d.dateMonthTitle||"Select month",d.dateYearTitle=d.dateYearTitle||"Select year",d.buttonNextTitle=d.buttonNextTitle||"Next",d.buttonPrevTitle=d.buttonPrevTitle||"Prev";var c,o,m,u,h=l.selector,p=e.element(h?s[0].querySelector("."+h):s[0].children[0]),b=l.buttonPrev||'<b class="datepicker-default-button">&lang;</b>',y=l.buttonNext||'<b class="datepicker-default-button">&rang;</b>',g=l.dateFormat,M=new Date,v=!1,f=!1,D=n.DATETIME_FORMATS,N='<div class="datepicker-calendar" ng-blur="hideCalendar()"><div class="datepicker-calendar-header" ng-hide="isMobile()"><div class="datepicker-calendar-header-left"><a href="javascript:void(0)" ng-click="prevMonth()" title="{{buttonPrevTitle}}">'+b+'</a></div><div class="datepicker-calendar-header-middle datepicker-calendar-month">{{month}} <a href="javascript:void(0)" ng-click="showYearsPagination = !showYearsPagination"><span>{{year}} <i ng-if="!showYearsPagination">&dtrif;</i> <i ng-if="showYearsPagination">&urtri;</i> </span> </a></div><div class="datepicker-calendar-header-right"><a href="javascript:void(0)" ng-click="nextMonth()" title="{{buttonNextTitle}}">'+y+'</a></div></div><div class="datepicker-calendar-header" ng-show="isMobile()"><div class="datepicker-calendar-header-middle datepicker-mobile-item datepicker-calendar-month"><select ng-model="month" title="{{dateMonthTitle}}" ng-change="selectedMonthHandle(month)"><option ng-repeat="item in months" ng-selected="month === item" ng-disabled=\'!isSelectableMaxDate(item + " " + day + ", " + year) || !isSelectableMinDate(item + " " + day + ", " + year)\' ng-value="item">{{item}}</option></select></div></div><div class="datepicker-calendar-header" ng-show="isMobile()"><div class="datepicker-calendar-header-middle datepicker-mobile-item datepicker-calendar-month"><select ng-model="mobileYear" title="{{dateYearTitle}}" ng-change="setNewYear(mobileYear)"><option ng-repeat="item in paginationYears" ng-selected="year === item" ng-value="item" ng-disabled="!isSelectableMinYear(item) || !isSelectableMaxYear(item)">{{item}}</option></select></div></div><div class="datepicker-calendar-header" ng-show="showYearsPagination"><div class="datepicker-calendar-years-pagination"><a ng-class="{\'datepicker-active\': y === year, \'datepicker-disabled\': !isSelectableMaxYear(y) || !isSelectableMinYear(y)}" href="javascript:void(0)" ng-click="setNewYear(y)" ng-repeat="y in paginationYears">{{y}}</a></div><div class="datepicker-calendar-years-pagination-pages"><a href="javascript:void(0)" ng-click="paginateYears(paginationYears[0])" ng-class="{\'datepicker-item-hidden\': paginationYearsPrevDisabled}">'+b+'</a><a href="javascript:void(0)" ng-click="paginateYears(paginationYears[paginationYears.length -1 ])" ng-class="{\'datepicker-item-hidden\': paginationYearsNextDisabled}">'+y+'</a></div></div><div class="datepicker-calendar-days-header"><div ng-repeat="d in daysInString"> {{d}} </div> </div><div class="datepicker-calendar-body"><a href="javascript:void(0)" ng-repeat="px in prevMonthDays" class="datepicker-calendar-day datepicker-disabled">{{px}}</a><a href="javascript:void(0)" ng-repeat="item in days" ng-click="setDatepickerDay(item)" ng-class="{\'datepicker-active\': day === item, \'datepicker-disabled\': !isSelectableMinDate(year + \'/\' + monthNumber + \'/\' + item ) || !isSelectableMaxDate(year + \'/\' + monthNumber + \'/\' + item)}" class="datepicker-calendar-day">{{item}}</a><a href="javascript:void(0)" ng-repeat="nx in nextMonthDays" class="datepicker-calendar-day datepicker-disabled">{{nx}}</a></div></div></div>';N=N.replace(/{{/g,r.startSymbol()).replace(/}}/g,r.endSymbol()),d.$watch("dateSet",function(e){e&&(M=new Date(e),d.month=i("date")(M,"MMMM"),d.monthNumber=Number(i("date")(M,"MM")),d.day=Number(i("date")(M,"dd")),d.year=Number(i("date")(M,"yyyy")),d.setDaysInMonth(d.monthNumber,d.year),d.setInputValue())}),d.$watch("dateMinLimit",function(e){e&&(o=e)}),d.$watch("dateMaxLimit",function(e){e&&(m=e)}),d.month=i("date")(M,"MMMM"),d.monthNumber=Number(i("date")(M,"MM")),d.day=Number(i("date")(M,"dd")),d.dateMaxLimit?d.year=Number(i("date")(new Date(d.dateMaxLimit),"yyyy")):d.year=Number(i("date")(M,"yyyy")),d.months=D.MONTH,d.daysInString=["0","1","2","3","4","5","6"].map(function(e){return i("date")(new Date(new Date("06/08/2014").valueOf()+864e5*e),"EEE")}),p.after(t(e.element(N))(d)),c=s[0].querySelector(".datepicker-calendar"),p.bind("focus click",function(){f=!0,d.showCalendar()}),p.bind("focusout blur",function(){f=!1}),e.element(c).bind("mouseenter",function(){v=!0}),e.element(c).bind("mouseleave",function(){v=!1}),e.element(c).bind("focusin",function(){v=!0}),e.element(a).bind("click focus",function(){v||f||!c||d.hideCalendar()}),d.isMobile=function(){if(navigator.userAgent&&(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)))return!0},d.resetToMinDate=function(){d.month=i("date")(new Date(o),"MMMM"),d.monthNumber=Number(i("date")(new Date(o),"MM")),d.day=Number(i("date")(new Date(o),"dd")),d.year=Number(i("date")(new Date(o),"yyyy"))},d.resetToMaxDate=function(){d.month=i("date")(new Date(m),"MMMM"),d.monthNumber=Number(i("date")(new Date(m),"MM")),d.day=Number(i("date")(new Date(m),"dd")),d.year=Number(i("date")(new Date(m),"yyyy"))},d.nextMonth=function(){12===d.monthNumber?(d.monthNumber=1,d.nextYear()):d.monthNumber+=1,d.month=i("date")(new Date(d.year,d.monthNumber-1),"MMMM"),d.setDaysInMonth(d.monthNumber,d.year),m&&(d.isSelectableMaxDate(d.year+"/"+d.monthNumber+"/"+d.day)||d.resetToMaxDate()),d.day=void 0},d.selectedMonthHandle=function(e){d.monthNumber=Number(i("date")(new Date("01 "+e+" 2000"),"MM")),d.setDaysInMonth(d.monthNumber,d.year),d.setInputValue()},d.prevMonth=function(){1===d.monthNumber?(d.monthNumber=12,d.prevYear()):d.monthNumber-=1,d.month=i("date")(new Date(d.year,d.monthNumber-1),"MMMM"),d.setDaysInMonth(d.monthNumber,d.year),o&&(d.isSelectableMinDate(d.year+"/"+d.monthNumber+"/"+d.day)||d.resetToMinDate()),d.day=void 0},d.setNewYear=function(e){if(d.day=void 0,m&&d.year<Number(e)){if(!d.isSelectableMaxYear(e))return}else if(o&&d.year>Number(e)&&!d.isSelectableMinYear(e))return;d.year=Number(e),d.setDaysInMonth(d.monthNumber,d.year),d.paginateYears(e)},d.nextYear=function(){d.year=Number(d.year)+1},d.prevYear=function(){d.year=Number(d.year)-1},d.setInputValue=function(){if(!d.isSelectableMinDate(d.year+"/"+d.monthNumber+"/"+d.day)||!d.isSelectableMaxDate(d.year+"/"+d.monthNumber+"/"+d.day))return!1;var e=new Date(d.year+"/"+d.monthNumber+"/"+d.day);l.dateFormat?jQuery(p).val(i("date")(e,g)):p.val(e),p.triggerHandler("input"),p.triggerHandler("change")},d.classHelper={add:function(e,a){if(!(e.className.indexOf(a)>-1)){var t=e.className.split(" ");t.push(a),e.className=t.join(" ")}},remove:function(e,a){var t,n;if(e.className.indexOf(a)!==-1){for(n=e.className.split(" "),t=0;t<n.length;t+=1)if(n[t]===a){n=n.slice(0,t).concat(n.slice(t+1));break}e.className=n.join(" ")}}},d.showCalendar=function(){u=a.document.getElementsByClassName("datepicker-calendar"),e.forEach(u,function(e,a){u[a].classList?u[a].classList.remove("datepicker-open"):d.classHelper.remove(u[a],"datepicker-open")}),c.classList?c.classList.add("datepicker-open"):d.classHelper.add(c,"datepicker-open")},d.hideCalendar=function(){c.classList?c.classList.remove("datepicker-open"):d.classHelper.remove(c,"datepicker-open")},d.setDaysInMonth=function(e,a){var t,n,i,r,s=new Date(a,e,0).getDate(),l=new Date(a+"/"+e+"/1").getDay(),c=new Date(a+"/"+e+"/"+s).getDay(),o=[],m=[];for(d.days=[],t=1;t<=s;t+=1)d.days.push(t);if(0!==l){for(i=l,r=1===Number(e)?12:e-1,t=1;t<=new Date(a,r,0).getDate();t+=1)o.push(t);d.prevMonthDays=o.slice(-i)}else d.prevMonthDays=[];if(c<6){for(n=6-c,t=1;t<=n;t+=1)m.push(t);d.nextMonthDays=m}else d.nextMonthDays=[]},d.setDatepickerDay=function(e){d.day=Number(e),d.setInputValue(),d.hideCalendar()},d.paginateYears=function(e){d.paginationYears=[];var a,t=[],n=10,i=10;for(d.isMobile()&&(n=50,i=50,d.dateMinLimit&&d.dateMaxLimit&&(e=new Date(d.dateMaxLimit).getFullYear(),n=e-new Date(d.dateMinLimit).getFullYear(),i=1)),a=n;a>0;a-=1)t.push(Number(e)-a);for(a=0;a<i;a+=1)t.push(Number(e)+a);m&&t&&t.length&&!d.isSelectableMaxYear(Number(t[t.length-1])+1)?d.paginationYearsNextDisabled=!0:d.paginationYearsNextDisabled=!1,o&&t&&t.length&&!d.isSelectableMinYear(Number(t[0])-1)?d.paginationYearsPrevDisabled=!0:d.paginationYearsPrevDisabled=!1,d.paginationYears=t},d.isSelectableMinDate=function(e){return!(o&&new Date(o)&&new Date(e).getTime()<new Date(o).getTime())},d.isSelectableMaxDate=function(e){return!(m&&new Date(m)&&new Date(e).getTime()>new Date(m).getTime())},d.isSelectableMaxYear=function(e){return!(m&&e>new Date(m).getFullYear())},d.isSelectableMinYear=function(e){return!(o&&e<new Date(o).getFullYear())},o&&!d.isSelectableMinYear(d.year)&&d.resetToMinDate(),m&&!d.isSelectableMaxYear(d.year)&&d.resetToMaxDate(),d.paginateYears(d.year),d.setDaysInMonth(d.monthNumber,d.year)}}}])}(angular);